"use strict";(self.webpackChunkgraduation=self.webpackChunkgraduation||[]).push([[848],{5776:(hc,Vr,G)=>{G.d(Vr,{u7:()=>uc,Jj:()=>Ht,IX:()=>C_,my:()=>ce,xU:()=>wn,Lz:()=>Zt,WA:()=>v,F8:()=>co,$q:()=>ji,W:()=>Rn,EK:()=>se,PU:()=>Cf,l7:()=>Lt,Ky:()=>C,Xb:()=>re,Cf:()=>z,K9:()=>ym,Me:()=>Jm,yq:()=>Ue,Wi:()=>af,ET:()=>fy,Ab:()=>Cy,vr:()=>xy,Fc:()=>N_,hJ:()=>R_,B$:()=>P_,at:()=>df,oe:()=>dy,AK:()=>Sy,TF:()=>M_,JU:()=>ff,ST:()=>D_,fH:()=>b_,Ix:()=>F_,Wu:()=>X_,Lx:()=>Y_,qY:()=>le,GL:()=>Sr,QT:()=>iy,kl:()=>sy,Xk:()=>oy,PL:()=>ay,UQ:()=>uy,zN:()=>cy,nP:()=>Dy,b9:()=>W_,vh:()=>H_,Pb:()=>O_,L$:()=>L_,cf:()=>my,sc:()=>gy,Xo:()=>Q_,IO:()=>j_,iE:()=>Ju,Eo:()=>S_,i3:()=>Py,Bt:()=>Vy,pl:()=>ly,Ub:()=>_m,qK:()=>ry,TQ:()=>J_,e0:()=>Z_,r7:()=>hy,Mx:()=>k_,ar:()=>$_});var V,y=G(5861),$=G(534),Re=G(4537),Pe=G(7879),U=G(9058),xr=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},me={},Me=Me||{},M=xr||self;function St(n){var e=typeof n;return"array"==(e="object"!=e?e:n?Array.isArray(n)?"array":e:"null")||"object"==e&&"number"==typeof n.length}function Xt(n){var e=typeof n;return"object"==e&&null!=n||"function"==e}var Be="closure_uid_"+(1e9*Math.random()>>>0),Dr=0;function Eo(n,e,t){return n.call.apply(n.bind,arguments)}function $i(n,e,t){if(!n)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var i=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(i,r),n.apply(e,i)}}return function(){return n.apply(e,arguments)}}function Se(n,e,t){return(Se=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?Eo:$i).apply(null,arguments)}function Pn(n,e){var t=Array.prototype.slice.call(arguments,1);return function(){var r=t.slice();return r.push.apply(r,arguments),n.apply(this,r)}}function T(n,e){function t(){}t.prototype=e.prototype,n.$=e.prototype,n.prototype=new t,n.prototype.constructor=n,n.ac=function(r,i,s){for(var o=Array(arguments.length-2),a=2;a<arguments.length;a++)o[a-2]=arguments[a];return e.prototype[i].apply(r,o)}}function Je(){this.s=this.s,this.o=this.o}Je.prototype.s=!1,Je.prototype.sa=function(){!this.s&&(this.s=!0,this.N(),0)&&function Cr(n){Object.prototype.hasOwnProperty.call(n,Be)&&n[Be]||(n[Be]=++Dr)}(this)},Je.prototype.N=function(){if(this.o)for(;this.o.length;)this.o.shift()()};const Qi=Array.prototype.indexOf?function(n,e){return Array.prototype.indexOf.call(n,e,void 0)}:function(n,e){if("string"==typeof n)return"string"!=typeof e||1!=e.length?-1:n.indexOf(e,0);for(let t=0;t<n.length;t++)if(t in n&&n[t]===e)return t;return-1};function br(n){const e=n.length;if(0<e){const t=Array(e);for(let r=0;r<e;r++)t[r]=n[r];return t}return[]}function Sn(n,e){for(let t=1;t<arguments.length;t++){const r=arguments[t];if(St(r)){const i=n.length||0,s=r.length||0;n.length=i+s;for(let o=0;o<s;o++)n[i+o]=r[o]}else n.push(r)}}function ge(n,e){this.type=n,this.g=this.target=e,this.defaultPrevented=!1}ge.prototype.h=function(){this.defaultPrevented=!0};var Wi=function(){if(!M.addEventListener||!Object.defineProperty)return!1;var n=!1,e=Object.defineProperty({},"passive",{get:function(){n=!0}});try{const t=()=>{};M.addEventListener("test",t,e),M.removeEventListener("test",t,e)}catch{}return n}();function Ye(n){return/^[\s\xa0]*$/.test(n)}function Vt(){var n=M.navigator;return n&&(n=n.userAgent)?n:""}function Qe(n){return-1!=Vt().indexOf(n)}function Nr(n){return Nr[" "](n),n}Nr[" "]=function(){};var Cn,n,Vn=Qe("Opera"),xt=Qe("Trident")||Qe("MSIE"),kr=Qe("Edge"),xn=kr||xt,nt=Qe("Gecko")&&!(-1!=Vt().toLowerCase().indexOf("webkit")&&!Qe("Edge"))&&!(Qe("Trident")||Qe("MSIE"))&&!Qe("Edge"),qe=-1!=Vt().toLowerCase().indexOf("webkit")&&!Qe("Edge");function Ee(){var n=M.document;return n?n.documentMode:void 0}e:{var Dn="",dt=(n=Vt(),nt?/rv:([^\);]+)(\)|;)/.exec(n):kr?/Edge\/([\d\.]+)/.exec(n):xt?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(n):qe?/WebKit\/(\S+)/.exec(n):Vn?/(?:Version)[ \/]?(\S+)/.exec(n):void 0);if(dt&&(Dn=dt?dt[1]:""),xt){var ft=Ee();if(null!=ft&&ft>parseFloat(Dn)){Cn=String(ft);break e}}Cn=Dn}var Fr=M.document&&xt&&(Ee()||parseInt(Cn,10))||void 0;function We(n,e){if(ge.call(this,n?n.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,n){var t=this.type=n.type,r=n.changedTouches&&n.changedTouches.length?n.changedTouches[0]:null;if(this.target=n.target||n.srcElement,this.g=e,e=n.relatedTarget){if(nt){e:{try{Nr(e.nodeName);var i=!0;break e}catch{}i=!1}i||(e=null)}}else"mouseover"==t?e=n.fromElement:"mouseout"==t&&(e=n.toElement);this.relatedTarget=e,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==n.clientX?n.clientX:n.pageX,this.clientY=void 0!==n.clientY?n.clientY:n.pageY,this.screenX=n.screenX||0,this.screenY=n.screenY||0),this.button=n.button,this.key=n.key||"",this.ctrlKey=n.ctrlKey,this.altKey=n.altKey,this.shiftKey=n.shiftKey,this.metaKey=n.metaKey,this.pointerId=n.pointerId||0,this.pointerType="string"==typeof n.pointerType?n.pointerType:mt[n.pointerType]||"",this.state=n.state,this.i=n,n.defaultPrevented&&We.$.h.call(this)}}T(We,ge);var mt={2:"touch",3:"pen",4:"mouse"};We.prototype.h=function(){We.$.h.call(this);var n=this.i;n.preventDefault?n.preventDefault():n.returnValue=!1};var gt="closure_listenable_"+(1e6*Math.random()|0),pt=0;function Ao(n,e,t,r,i){this.listener=n,this.proxy=null,this.src=e,this.type=t,this.capture=!!r,this.la=i,this.key=++pt,this.fa=this.ia=!1}function bn(n){n.fa=!0,n.listener=null,n.proxy=null,n.src=null,n.la=null}function Mr(n,e,t){for(const r in n)e.call(t,n[r],r,n)}function Ji(n){const e={};for(const t in n)e[t]=n[t];return e}const Or="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function Yi(n,e){let t,r;for(let i=1;i<arguments.length;i++){for(t in r=arguments[i],r)n[t]=r[t];for(let s=0;s<Or.length;s++)t=Or[s],Object.prototype.hasOwnProperty.call(r,t)&&(n[t]=r[t])}}function Ct(n){this.src=n,this.g={},this.h=0}function Nn(n,e){var t=e.type;if(t in n.g){var s,r=n.g[t],i=Qi(r,e);(s=0<=i)&&Array.prototype.splice.call(r,i,1),s&&(bn(e),0==n.g[t].length&&(delete n.g[t],n.h--))}}function Dt(n,e,t,r){for(var i=0;i<n.length;++i){var s=n[i];if(!s.fa&&s.listener==e&&s.capture==!!t&&s.la==r)return i}return-1}Ct.prototype.add=function(n,e,t,r,i){var s=n.toString();(n=this.g[s])||(n=this.g[s]=[],this.h++);var o=Dt(n,e,r,i);return-1<o?(e=n[o],t||(e.ia=!1)):((e=new Ao(e,this.src,s,!!r,i)).ia=t,n.push(e)),e};var kn="closure_lm_"+(1e6*Math.random()|0),Lr={};function Fn(n,e,t,r,i){if(r&&r.once)return Br(n,e,t,r,i);if(Array.isArray(e)){for(var s=0;s<e.length;s++)Fn(n,e[s],t,r,i);return null}return t=Gr(t),n&&n[gt]?n.O(e,t,Xt(r)?!!r.capture:!!r,i):Xi(n,e,t,!1,r,i)}function Xi(n,e,t,r,i,s){if(!e)throw Error("Invalid event type");var o=Xt(i)?!!i.capture:!!i,a=Ur(n);if(a||(n[kn]=a=new Ct(n)),(t=a.add(e,t,r,o,s)).proxy)return t;if(r=function es(){const e=wo;return function n(t){return e.call(n.src,n.listener,t)}}(),t.proxy=r,r.src=n,r.listener=t,n.addEventListener)Wi||(i=o),void 0===i&&(i=!1),n.addEventListener(e.toString(),r,i);else if(n.attachEvent)n.attachEvent(ns(e.toString()),r);else{if(!n.addListener||!n.removeListener)throw Error("addEventListener and attachEvent are unavailable.");n.addListener(r)}return t}function Br(n,e,t,r,i){if(Array.isArray(e)){for(var s=0;s<e.length;s++)Br(n,e[s],t,r,i);return null}return t=Gr(t),n&&n[gt]?n.P(e,t,Xt(r)?!!r.capture:!!r,i):Xi(n,e,t,!0,r,i)}function ts(n,e,t,r,i){if(Array.isArray(e))for(var s=0;s<e.length;s++)ts(n,e[s],t,r,i);else r=Xt(r)?!!r.capture:!!r,t=Gr(t),n&&n[gt]?(n=n.i,(e=String(e).toString())in n.g&&-1<(t=Dt(s=n.g[e],t,r,i))&&(bn(s[t]),Array.prototype.splice.call(s,t,1),0==s.length&&(delete n.g[e],n.h--))):n&&(n=Ur(n))&&(e=n.g[e.toString()],n=-1,e&&(n=Dt(e,t,r,i)),(t=-1<n?e[n]:null)&&qr(t))}function qr(n){if("number"!=typeof n&&n&&!n.fa){var e=n.src;if(e&&e[gt])Nn(e.i,n);else{var t=n.type,r=n.proxy;e.removeEventListener?e.removeEventListener(t,r,n.capture):e.detachEvent?e.detachEvent(ns(t),r):e.addListener&&e.removeListener&&e.removeListener(r),(t=Ur(e))?(Nn(t,n),0==t.h&&(t.src=null,e[kn]=null)):bn(n)}}}function ns(n){return n in Lr?Lr[n]:Lr[n]="on"+n}function wo(n,e){if(n.fa)n=!0;else{e=new We(e,this);var t=n.listener,r=n.la||n.src;n.ia&&qr(n),n=t.call(r,e)}return n}function Ur(n){return(n=n[kn])instanceof Ct?n:null}var Mn="__closure_events_fn_"+(1e9*Math.random()>>>0);function Gr(n){return"function"==typeof n?n:(n[Mn]||(n[Mn]=function(e){return n.handleEvent(e)}),n[Mn])}function _e(){Je.call(this),this.i=new Ct(this),this.S=this,this.J=null}function E(n,e){var t,r=n.J;if(r)for(t=[];r;r=r.J)t.push(r);if(n=n.S,r=e.type||e,"string"==typeof e)e=new ge(e,n);else if(e instanceof ge)e.target=e.target||n;else{var i=e;Yi(e=new ge(r,n),i)}if(i=!0,t)for(var s=t.length-1;0<=s;s--){var o=e.g=t[s];i=h(o,r,!0,e)&&i}if(i=h(o=e.g=n,r,!0,e)&&i,i=h(o,r,!1,e)&&i,t)for(s=0;s<t.length;s++)i=h(o=e.g=t[s],r,!1,e)&&i}function h(n,e,t,r){if(!(e=n.i.g[String(e)]))return!0;e=e.concat();for(var i=!0,s=0;s<e.length;++s){var o=e[s];if(o&&!o.fa&&o.capture==t){var a=o.listener,u=o.la||o.src;o.ia&&Nn(n.i,o),i=!1!==a.call(u,r)&&i}}return i&&!r.defaultPrevented}T(_e,Je),_e.prototype[gt]=!0,_e.prototype.removeEventListener=function(n,e,t,r){ts(this,n,e,t,r)},_e.prototype.N=function(){if(_e.$.N.call(this),this.i){var e,n=this.i;for(e in n.g){for(var t=n.g[e],r=0;r<t.length;r++)bn(t[r]);delete n.g[e],n.h--}}this.J=null},_e.prototype.O=function(n,e,t,r){return this.i.add(String(n),e,!1,t,r)},_e.prototype.P=function(n,e,t,r){return this.i.add(String(n),e,!0,t,r)};var f=M.JSON.stringify;function P(){var n=zr;let e=null;return n.g&&(e=n.g,n.g=n.g.next,n.g||(n.h=null),e.next=null),e}var Xe=new class I{constructor(e,t){this.i=e,this.j=t,this.h=0,this.g=null}get(){let e;return 0<this.h?(this.h--,e=this.g,this.g=e.next,e.next=null):e=this.i(),e}}(()=>new Ve,n=>n.reset());class Ve{constructor(){this.next=this.g=this.h=null}set(e,t){this.h=e,this.g=t,this.next=null}reset(){this.next=this.g=this.h=null}}function On(n){var e=1;n=n.split(":");const t=[];for(;0<e&&n.length;)t.push(n.shift()),e--;return n.length&&t.push(n.join(":")),t}function en(n){M.setTimeout(()=>{throw n},0)}let rt,et=!1,zr=new class W{constructor(){this.h=this.g=null}add(e,t){const r=Xe.get();r.set(e,t),this.h?this.h.next=r:this.g=r,this.h=r}},rs=()=>{const n=M.Promise.resolve(void 0);rt=()=>{n.then(Ro)}};var Ro=()=>{for(var n;n=P();){try{n.h.call(n.g)}catch(t){en(t)}var e=Xe;e.j(n),100>e.h&&(e.h++,n.next=e.g,e.g=n)}et=!1};function Ln(n,e){_e.call(this),this.h=n||1,this.g=e||M,this.j=Se(this.qb,this),this.l=Date.now()}function Kr(n){n.ga=!1,n.T&&(n.g.clearTimeout(n.T),n.T=null)}function jr(n,e,t){if("function"==typeof n)t&&(n=Se(n,t));else{if(!n||"function"!=typeof n.handleEvent)throw Error("Invalid listener argument");n=Se(n.handleEvent,n)}return 2147483647<Number(e)?-1:M.setTimeout(n,e||0)}function Po(n){n.g=jr(()=>{n.g=null,n.i&&(n.i=!1,Po(n))},n.j);const e=n.h;n.h=null,n.m.apply(null,e)}T(Ln,_e),(V=Ln.prototype).ga=!1,V.T=null,V.qb=function(){if(this.ga){var n=Date.now()-this.l;0<n&&n<.8*this.h?this.T=this.g.setTimeout(this.j,this.h-n):(this.T&&(this.g.clearTimeout(this.T),this.T=null),E(this,"tick"),this.ga&&(Kr(this),this.start()))}},V.start=function(){this.ga=!0,this.T||(this.T=this.g.setTimeout(this.j,this.h),this.l=Date.now())},V.N=function(){Ln.$.N.call(this),Kr(this),delete this.g};class Bn extends Je{constructor(e,t){super(),this.m=e,this.j=t,this.h=null,this.i=!1,this.g=null}l(e){this.h=arguments,this.g?this.i=!0:Po(this)}N(){super.N(),this.g&&(M.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function _t(n){Je.call(this),this.h=n,this.g={}}T(_t,Je);var bt=[];function is(n,e,t,r){Array.isArray(t)||(t&&(bt[0]=t.toString()),t=bt);for(var i=0;i<t.length;i++){var s=Fn(e,t[i],r||n.handleEvent,!1,n.h||n);if(!s)break;n.g[s.key]=s}}function ss(n){Mr(n.g,function(e,t){this.g.hasOwnProperty(t)&&qr(e)},n),n.g={}}function os(){this.g=!0}function qn(n,e,t,r){n.info(function(){return"XMLHTTP TEXT ("+e+"): "+function Lf(n,e){if(!n.g)return e;if(!e)return null;try{var t=JSON.parse(e);if(t)for(n=0;n<t.length;n++)if(Array.isArray(t[n])){var r=t[n];if(!(2>r.length)){var i=r[1];if(Array.isArray(i)&&!(1>i.length)){var s=i[0];if("noop"!=s&&"stop"!=s&&"close"!=s)for(var o=1;o<i.length;o++)i[o]=""}}}return f(t)}catch{return e}}(n,t)+(r?" "+r:"")})}_t.prototype.N=function(){_t.$.N.call(this),ss(this)},_t.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},os.prototype.Ea=function(){this.g=!1},os.prototype.info=function(){};var tn={},fc=null;function as(){return fc=fc||new _e}function mc(n){ge.call(this,tn.Ta,n)}function $r(n){const e=as();E(e,new mc(e))}function gc(n,e){ge.call(this,tn.STAT_EVENT,n),this.stat=e}function Oe(n){const e=as();E(e,new gc(e,n))}function pc(n,e){ge.call(this,tn.Ua,n),this.size=e}function Qr(n,e){if("function"!=typeof n)throw Error("Fn must not be null and must be a function");return M.setTimeout(function(){n()},e)}tn.Ta="serverreachability",T(mc,ge),tn.STAT_EVENT="statevent",T(gc,ge),tn.Ua="timingevent",T(pc,ge);var us={NO_ERROR:0,rb:1,Eb:2,Db:3,yb:4,Cb:5,Fb:6,Qa:7,TIMEOUT:8,Ib:9},_c={wb:"complete",Sb:"success",Ra:"error",Qa:"abort",Kb:"ready",Lb:"readystatechange",TIMEOUT:"timeout",Gb:"incrementaldata",Jb:"progress",zb:"downloadprogress",$b:"uploadprogress"};function So(){}function Ic(){}So.prototype.h=null;var Co,Wr={OPEN:"a",vb:"b",Ra:"c",Hb:"d"};function Vo(){ge.call(this,"d")}function xo(){ge.call(this,"c")}function cs(){}function Hr(n,e,t,r){this.l=n,this.j=e,this.m=t,this.W=r||1,this.U=new _t(this),this.P=Bf,this.V=new Ln(n=xn?125:void 0),this.I=null,this.i=!1,this.u=this.B=this.A=this.L=this.G=this.Y=this.C=null,this.F=[],this.g=null,this.o=0,this.s=this.v=null,this.ca=-1,this.J=!1,this.O=0,this.M=null,this.ba=this.K=this.aa=this.S=!1,this.h=new Tc}function Tc(){this.i=null,this.g="",this.h=!1}T(Vo,ge),T(xo,ge),T(cs,So),cs.prototype.g=function(){return new XMLHttpRequest},cs.prototype.i=function(){return{}},Co=new cs;var Bf=45e3,Ec={},Do={};function bo(n,e,t){n.L=1,n.A=fs(yt(e)),n.u=t,n.S=!0,vc(n,null)}function vc(n,e){n.G=Date.now(),Zr(n),n.B=yt(n.A);var t=n.B,r=n.W;Array.isArray(r)||(r=[String(r)]),bc(t.i,"t",r),n.o=0,t=n.l.J,n.h=new Tc,n.g=nl(n.l,t?e:null,!n.u),0<n.O&&(n.M=new Bn(Se(n.Pa,n,n.g),n.O)),is(n.U,n.g,"readystatechange",n.nb),e=n.I?Ji(n.I):{},n.u?(n.v||(n.v="POST"),e["Content-Type"]="application/x-www-form-urlencoded",n.g.ha(n.B,n.v,n.u,e)):(n.v="GET",n.g.ha(n.B,n.v,null,e)),$r(),function Ff(n,e,t,r,i,s){n.info(function(){if(n.g)if(s)for(var o="",a=s.split("&"),u=0;u<a.length;u++){var c=a[u].split("=");if(1<c.length){var l=c[0];c=c[1];var d=l.split("_");o=2<=d.length&&"type"==d[1]?o+(l+"=")+c+"&":o+(l+"=redacted&")}}else o=null;else o=s;return"XMLHTTP REQ ("+r+") [attempt "+i+"]: "+e+"\n"+t+"\n"+o})}(n.j,n.v,n.B,n.m,n.W,n.u)}function Ac(n){return!!n.g&&"GET"==n.v&&2!=n.L&&n.l.Ha}function wc(n,e,t){let i,r=!0;for(;!n.J&&n.o<t.length;){if(i=qf(n,t),i==Do){4==e&&(n.s=4,Oe(14),r=!1),qn(n.j,n.m,null,"[Incomplete Response]");break}if(i==Ec){n.s=4,Oe(15),qn(n.j,n.m,t,"[Invalid Chunk]"),r=!1;break}qn(n.j,n.m,i,null),No(n,i)}Ac(n)&&0!=n.o&&(n.h.g=n.h.g.slice(n.o),n.o=0),4!=e||0!=t.length||n.h.h||(n.s=1,Oe(16),r=!1),n.i=n.i&&r,r?0<t.length&&!n.ba&&(n.ba=!0,(e=n.l).g==n&&e.ca&&!e.M&&(e.l.info("Great, no buffering proxy detected. Bytes received: "+t.length),qo(e),e.M=!0,Oe(11))):(qn(n.j,n.m,t,"[Invalid Chunked Response]"),nn(n),Jr(n))}function qf(n,e){var t=n.o,r=e.indexOf("\n",t);return-1==r?Do:(t=Number(e.substring(t,r)),isNaN(t)?Ec:(r+=1)+t>e.length?Do:(e=e.slice(r,r+t),n.o=r+t,e))}function Zr(n){n.Y=Date.now()+n.P,Rc(n,n.P)}function Rc(n,e){if(null!=n.C)throw Error("WatchDog timer not null");n.C=Qr(Se(n.lb,n),e)}function ls(n){n.C&&(M.clearTimeout(n.C),n.C=null)}function Jr(n){0==n.l.H||n.J||Yc(n.l,n)}function nn(n){ls(n);var e=n.M;e&&"function"==typeof e.sa&&e.sa(),n.M=null,Kr(n.V),ss(n.U),n.g&&(e=n.g,n.g=null,e.abort(),e.sa())}function No(n,e){try{var t=n.l;if(0!=t.H&&(t.g==n||ko(t.i,n)))if(!n.K&&ko(t.i,n)&&3==t.H){try{var r=t.Ja.g.parse(e)}catch{r=null}if(Array.isArray(r)&&3==r.length){var i=r;if(0==i[0]){e:if(!t.u){if(t.g){if(!(t.g.G+3e3<n.G))break e;Is(t),_s(t)}Bo(t),Oe(18)}}else t.Fa=i[1],0<t.Fa-t.V&&37500>i[2]&&t.G&&0==t.A&&!t.v&&(t.v=Qr(Se(t.ib,t),6e3));if(1>=Fc(t.i)&&t.oa){try{t.oa()}catch{}t.oa=void 0}}else sn(t,11)}else if((n.K||t.g==n)&&Is(t),!Ye(e))for(i=t.Ja.g.parse(e),e=0;e<i.length;e++){let c=i[e];if(t.V=c[0],c=c[1],2==t.H)if("c"==c[0]){t.K=c[1],t.pa=c[2];const l=c[3];null!=l&&(t.ra=l,t.l.info("VER="+t.ra));const d=c[4];null!=d&&(t.Ga=d,t.l.info("SVER="+t.Ga));const m=c[5];null!=m&&"number"==typeof m&&0<m&&(t.L=r=1.5*m,t.l.info("backChannelRequestTimeoutMs_="+r)),r=t;const p=n.g;if(p){const w=p.g?p.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(w){var s=r.i;s.g||-1==w.indexOf("spdy")&&-1==w.indexOf("quic")&&-1==w.indexOf("h2")||(s.j=s.l,s.g=new Set,s.h&&(Fo(s,s.h),s.h=null))}if(r.F){const x=p.g?p.g.getResponseHeader("X-HTTP-Session-Id"):null;x&&(r.Da=x,ne(r.I,r.F,x))}}t.H=3,t.h&&t.h.Ba(),t.ca&&(t.S=Date.now()-n.G,t.l.info("Handshake RTT: "+t.S+"ms"));var o=n;if((r=t).wa=tl(r,r.J?r.pa:null,r.Y),o.K){Mc(r.i,o);var a=o,u=r.L;u&&a.setTimeout(u),a.C&&(ls(a),Zr(a)),r.g=o}else Zc(r);0<t.j.length&&ys(t)}else"stop"!=c[0]&&"close"!=c[0]||sn(t,7);else 3==t.H&&("stop"==c[0]||"close"==c[0]?"stop"==c[0]?sn(t,7):Lo(t):"noop"!=c[0]&&t.h&&t.h.Aa(c),t.A=0)}$r()}catch{}}function Pc(n,e){if(n.forEach&&"function"==typeof n.forEach)n.forEach(e,void 0);else if(St(n)||"string"==typeof n)Array.prototype.forEach.call(n,e,void 0);else for(var t=function Gf(n){if(n.ta&&"function"==typeof n.ta)return n.ta();if(!n.Z||"function"!=typeof n.Z){if(typeof Map<"u"&&n instanceof Map)return Array.from(n.keys());if(!(typeof Set<"u"&&n instanceof Set)){if(St(n)||"string"==typeof n){var e=[];n=n.length;for(var t=0;t<n;t++)e.push(t);return e}e=[],t=0;for(const r in n)e[t++]=r;return e}}}(n),r=function Uf(n){if(n.Z&&"function"==typeof n.Z)return n.Z();if(typeof Map<"u"&&n instanceof Map||typeof Set<"u"&&n instanceof Set)return Array.from(n.values());if("string"==typeof n)return n.split("");if(St(n)){for(var e=[],t=n.length,r=0;r<t;r++)e.push(n[r]);return e}for(r in e=[],t=0,n)e[t++]=n[r];return e}(n),i=r.length,s=0;s<i;s++)e.call(void 0,r[s],t&&t[s],n)}(V=Hr.prototype).setTimeout=function(n){this.P=n},V.nb=function(n){n=n.target;const e=this.M;e&&3==it(n)?e.l():this.Pa(n)},V.Pa=function(n){try{if(n==this.g)e:{const l=it(this.g);var e=this.g.Ia();if(this.g.da(),!(3>l)&&(3!=l||xn||this.g&&(this.h.h||this.g.ja()||Kc(this.g)))){this.J||4!=l||7==e||$r(),ls(this);var t=this.g.da();this.ca=t;t:if(Ac(this)){var r=Kc(this.g);n="";var i=r.length,s=4==it(this.g);if(!this.h.i){if(typeof TextDecoder>"u"){nn(this),Jr(this);var o="";break t}this.h.i=new M.TextDecoder}for(e=0;e<i;e++)this.h.h=!0,n+=this.h.i.decode(r[e],{stream:s&&e==i-1});r.length=0,this.h.g+=n,this.o=0,o=this.h.g}else o=this.g.ja();if(this.i=200==t,function Mf(n,e,t,r,i,s,o){n.info(function(){return"XMLHTTP RESP ("+r+") [ attempt "+i+"]: "+e+"\n"+t+"\n"+s+" "+o})}(this.j,this.v,this.B,this.m,this.W,l,t),this.i){if(this.aa&&!this.K){t:{if(this.g){var a,u=this.g;if((a=u.g?u.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!Ye(a)){var c=a;break t}}c=null}if(!(t=c)){this.i=!1,this.s=3,Oe(12),nn(this),Jr(this);break e}qn(this.j,this.m,t,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,No(this,t)}this.S?(wc(this,l,o),xn&&this.i&&3==l&&(is(this.U,this.V,"tick",this.mb),this.V.start())):(qn(this.j,this.m,o,null),No(this,o)),4==l&&nn(this),this.i&&!this.J&&(4==l?Yc(this.l,this):(this.i=!1,Zr(this)))}else(function om(n){const e={};n=(n.g&&2<=it(n)&&n.g.getAllResponseHeaders()||"").split("\r\n");for(let r=0;r<n.length;r++){if(Ye(n[r]))continue;var t=On(n[r]);const i=t[0];if("string"!=typeof(t=t[1]))continue;t=t.trim();const s=e[i]||[];e[i]=s,s.push(t)}!function dc(n,e){for(const t in n)e.call(void 0,n[t],t,n)}(e,function(r){return r.join(", ")})})(this.g),400==t&&0<o.indexOf("Unknown SID")?(this.s=3,Oe(12)):(this.s=0,Oe(13)),nn(this),Jr(this)}}}catch{}},V.mb=function(){if(this.g){var n=it(this.g),e=this.g.ja();this.o<e.length&&(ls(this),wc(this,n,e),this.i&&4!=n&&Zr(this))}},V.cancel=function(){this.J=!0,nn(this)},V.lb=function(){this.C=null;const n=Date.now();0<=n-this.Y?(function Of(n,e){n.info(function(){return"TIMEOUT: "+e})}(this.j,this.B),2!=this.L&&($r(),Oe(17)),nn(this),this.s=2,Jr(this)):Rc(this,this.Y-n)};var Sc=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function rn(n){if(this.g=this.s=this.j="",this.m=null,this.o=this.l="",this.h=!1,n instanceof rn){this.h=n.h,hs(this,n.j),this.s=n.s,this.g=n.g,ds(this,n.m),this.l=n.l;var e=n.i,t=new ei;t.i=e.i,e.g&&(t.g=new Map(e.g),t.h=e.h),Vc(this,t),this.o=n.o}else n&&(e=String(n).match(Sc))?(this.h=!1,hs(this,e[1]||"",!0),this.s=Yr(e[2]||""),this.g=Yr(e[3]||"",!0),ds(this,e[4]),this.l=Yr(e[5]||"",!0),Vc(this,e[6]||"",!0),this.o=Yr(e[7]||"")):(this.h=!1,this.i=new ei(null,this.h))}function yt(n){return new rn(n)}function hs(n,e,t){n.j=t?Yr(e,!0):e,n.j&&(n.j=n.j.replace(/:$/,""))}function ds(n,e){if(e){if(e=Number(e),isNaN(e)||0>e)throw Error("Bad port number "+e);n.m=e}else n.m=null}function Vc(n,e,t){e instanceof ei?(n.i=e,function Hf(n,e){e&&!n.j&&(Nt(n),n.i=null,n.g.forEach(function(t,r){var i=r.toLowerCase();r!=i&&(Cc(this,r),bc(this,i,t))},n)),n.j=e}(n.i,n.h)):(t||(e=Xr(e,Qf)),n.i=new ei(e,n.h))}function ne(n,e,t){n.i.set(e,t)}function fs(n){return ne(n,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),n}function Yr(n,e){return n?e?decodeURI(n.replace(/%25/g,"%2525")):decodeURIComponent(n):""}function Xr(n,e,t){return"string"==typeof n?(n=encodeURI(n).replace(e,Kf),t&&(n=n.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),n):null}function Kf(n){return"%"+((n=n.charCodeAt(0))>>4&15).toString(16)+(15&n).toString(16)}rn.prototype.toString=function(){var n=[],e=this.j;e&&n.push(Xr(e,xc,!0),":");var t=this.g;return(t||"file"==e)&&(n.push("//"),(e=this.s)&&n.push(Xr(e,xc,!0),"@"),n.push(encodeURIComponent(String(t)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(t=this.m)&&n.push(":",String(t))),(t=this.l)&&(this.g&&"/"!=t.charAt(0)&&n.push("/"),n.push(Xr(t,"/"==t.charAt(0)?$f:jf,!0))),(t=this.i.toString())&&n.push("?",t),(t=this.o)&&n.push("#",Xr(t,Wf)),n.join("")};var xc=/[#\/\?@]/g,jf=/[#\?:]/g,$f=/[#\?]/g,Qf=/[#\?@]/g,Wf=/#/g;function ei(n,e){this.h=this.g=null,this.i=n||null,this.j=!!e}function Nt(n){n.g||(n.g=new Map,n.h=0,n.i&&function zf(n,e){if(n){n=n.split("&");for(var t=0;t<n.length;t++){var r=n[t].indexOf("="),i=null;if(0<=r){var s=n[t].substring(0,r);i=n[t].substring(r+1)}else s=n[t];e(s,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}(n.i,function(e,t){n.add(decodeURIComponent(e.replace(/\+/g," ")),t)}))}function Cc(n,e){Nt(n),e=Un(n,e),n.g.has(e)&&(n.i=null,n.h-=n.g.get(e).length,n.g.delete(e))}function Dc(n,e){return Nt(n),e=Un(n,e),n.g.has(e)}function bc(n,e,t){Cc(n,e),0<t.length&&(n.i=null,n.g.set(Un(n,e),br(t)),n.h+=t.length)}function Un(n,e){return e=String(e),n.j&&(e=e.toLowerCase()),e}function Nc(n){this.l=n||Jf,n=M.PerformanceNavigationTiming?0<(n=M.performance.getEntriesByType("navigation")).length&&("hq"==n[0].nextHopProtocol||"h2"==n[0].nextHopProtocol):!!(M.g&&M.g.Ka&&M.g.Ka()&&M.g.Ka().dc),this.j=n?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}(V=ei.prototype).add=function(n,e){Nt(this),this.i=null,n=Un(this,n);var t=this.g.get(n);return t||this.g.set(n,t=[]),t.push(e),this.h+=1,this},V.forEach=function(n,e){Nt(this),this.g.forEach(function(t,r){t.forEach(function(i){n.call(e,i,r,this)},this)},this)},V.ta=function(){Nt(this);const n=Array.from(this.g.values()),e=Array.from(this.g.keys()),t=[];for(let r=0;r<e.length;r++){const i=n[r];for(let s=0;s<i.length;s++)t.push(e[r])}return t},V.Z=function(n){Nt(this);let e=[];if("string"==typeof n)Dc(this,n)&&(e=e.concat(this.g.get(Un(this,n))));else{n=Array.from(this.g.values());for(let t=0;t<n.length;t++)e=e.concat(n[t])}return e},V.set=function(n,e){return Nt(this),this.i=null,Dc(this,n=Un(this,n))&&(this.h-=this.g.get(n).length),this.g.set(n,[e]),this.h+=1,this},V.get=function(n,e){return n&&0<(n=this.Z(n)).length?String(n[0]):e},V.toString=function(){if(this.i)return this.i;if(!this.g)return"";const n=[],e=Array.from(this.g.keys());for(var t=0;t<e.length;t++){var r=e[t];const s=encodeURIComponent(String(r)),o=this.Z(r);for(r=0;r<o.length;r++){var i=s;""!==o[r]&&(i+="="+encodeURIComponent(String(o[r]))),n.push(i)}}return this.i=n.join("&")};var Jf=10;function kc(n){return!!n.h||!!n.g&&n.g.size>=n.j}function Fc(n){return n.h?1:n.g?n.g.size:0}function ko(n,e){return n.h?n.h==e:!!n.g&&n.g.has(e)}function Fo(n,e){n.g?n.g.add(e):n.h=e}function Mc(n,e){n.h&&n.h==e?n.h=null:n.g&&n.g.has(e)&&n.g.delete(e)}function Oc(n){if(null!=n.h)return n.i.concat(n.h.F);if(null!=n.g&&0!==n.g.size){let e=n.i;for(const t of n.g.values())e=e.concat(t.F);return e}return br(n.i)}Nc.prototype.cancel=function(){if(this.i=Oc(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(const n of this.g.values())n.cancel();this.g.clear()}};var Yf=class{stringify(n){return M.JSON.stringify(n,void 0)}parse(n){return M.JSON.parse(n,void 0)}};function Xf(){this.g=new Yf}function em(n,e,t){const r=t||"";try{Pc(n,function(i,s){let o=i;Xt(i)&&(o=f(i)),e.push(r+s+"="+encodeURIComponent(o))})}catch(i){throw e.push(r+"type="+encodeURIComponent("_badmap")),i}}function ms(n,e,t,r,i){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,i(r)}catch{}}function ti(n){this.l=n.ec||null,this.j=n.ob||!1}function gs(n,e){_e.call(this),this.F=n,this.u=e,this.m=void 0,this.readyState=Mo,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}T(ti,So),ti.prototype.g=function(){return new gs(this.l,this.j)},ti.prototype.i=function(n){return function(){return n}}({}),T(gs,_e);var Mo=0;function Lc(n){n.j.read().then(n.Xa.bind(n)).catch(n.ka.bind(n))}function ni(n){n.readyState=4,n.l=null,n.j=null,n.A=null,ri(n)}function ri(n){n.onreadystatechange&&n.onreadystatechange.call(n)}(V=gs.prototype).open=function(n,e){if(this.readyState!=Mo)throw this.abort(),Error("Error reopening a connection");this.C=n,this.B=e,this.readyState=1,ri(this)},V.send=function(n){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;const e={headers:this.v,method:this.C,credentials:this.m,cache:void 0};n&&(e.body=n),(this.F||M).fetch(new Request(this.B,e)).then(this.$a.bind(this),this.ka.bind(this))},V.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,ni(this)),this.readyState=Mo},V.$a=function(n){if(this.g&&(this.l=n,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=n.headers,this.readyState=2,ri(this)),this.g&&(this.readyState=3,ri(this),this.g)))if("arraybuffer"===this.responseType)n.arrayBuffer().then(this.Ya.bind(this),this.ka.bind(this));else if(typeof M.ReadableStream<"u"&&"body"in n){if(this.j=n.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;Lc(this)}else n.text().then(this.Za.bind(this),this.ka.bind(this))},V.Xa=function(n){if(this.g){if(this.u&&n.value)this.response.push(n.value);else if(!this.u){var e=n.value?n.value:new Uint8Array(0);(e=this.A.decode(e,{stream:!n.done}))&&(this.response=this.responseText+=e)}n.done?ni(this):ri(this),3==this.readyState&&Lc(this)}},V.Za=function(n){this.g&&(this.response=this.responseText=n,ni(this))},V.Ya=function(n){this.g&&(this.response=n,ni(this))},V.ka=function(){this.g&&ni(this)},V.setRequestHeader=function(n,e){this.v.append(n,e)},V.getResponseHeader=function(n){return this.h&&this.h.get(n.toLowerCase())||""},V.getAllResponseHeaders=function(){if(!this.h)return"";const n=[],e=this.h.entries();for(var t=e.next();!t.done;)n.push((t=t.value)[0]+": "+t[1]),t=e.next();return n.join("\r\n")},Object.defineProperty(gs.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(n){this.m=n?"include":"same-origin"}});var nm=M.JSON.parse;function ae(n){_e.call(this),this.headers=new Map,this.u=n||null,this.h=!1,this.C=this.g=null,this.I="",this.m=0,this.j="",this.l=this.G=this.v=this.F=!1,this.B=0,this.A=null,this.K=Bc,this.L=this.M=!1}T(ae,_e);var Bc="",rm=/^https?$/i,im=["POST","PUT"];function qc(n,e){n.h=!1,n.g&&(n.l=!0,n.g.abort(),n.l=!1),n.j=e,n.m=5,Uc(n),ps(n)}function Uc(n){n.F||(n.F=!0,E(n,"complete"),E(n,"error"))}function Gc(n){if(n.h&&typeof Me<"u"&&(!n.C[1]||4!=it(n)||2!=n.da()))if(n.v&&4==it(n))jr(n.La,0,n);else if(E(n,"readystatechange"),4==it(n)){n.h=!1;try{const o=n.da();e:switch(o){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var e=!0;break e;default:e=!1}var t;if(!(t=e)){var r;if(r=0===o){var i=String(n.I).match(Sc)[1]||null;!i&&M.self&&M.self.location&&(i=M.self.location.protocol.slice(0,-1)),r=!rm.test(i?i.toLowerCase():"")}t=r}if(t)E(n,"complete"),E(n,"success");else{n.m=6;try{var s=2<it(n)?n.g.statusText:""}catch{s=""}n.j=s+" ["+n.da()+"]",Uc(n)}}finally{ps(n)}}}function ps(n,e){if(n.g){zc(n);const t=n.g,r=n.C[0]?()=>{}:null;n.g=null,n.C=null,e||E(n,"ready");try{t.onreadystatechange=r}catch{}}}function zc(n){n.g&&n.L&&(n.g.ontimeout=null),n.A&&(M.clearTimeout(n.A),n.A=null)}function it(n){return n.g?n.g.readyState:0}function Kc(n){try{if(!n.g)return null;if("response"in n.g)return n.g.response;switch(n.K){case Bc:case"text":return n.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in n.g)return n.g.mozResponseArrayBuffer}return null}catch{return null}}function jc(n){let e="";return Mr(n,function(t,r){e+=r,e+=":",e+=t,e+="\r\n"}),e}function Oo(n,e,t){e:{for(r in t){var r=!1;break e}r=!0}r||(t=jc(t),"string"==typeof n?null!=t&&encodeURIComponent(String(t)):ne(n,e,t))}function ii(n,e,t){return t&&t.internalChannelParams&&t.internalChannelParams[n]||e}function $c(n){this.Ga=0,this.j=[],this.l=new os,this.pa=this.wa=this.I=this.Y=this.g=this.Da=this.F=this.na=this.o=this.U=this.s=null,this.fb=this.W=0,this.cb=ii("failFast",!1,n),this.G=this.v=this.u=this.m=this.h=null,this.aa=!0,this.Fa=this.V=-1,this.ba=this.A=this.C=0,this.ab=ii("baseRetryDelayMs",5e3,n),this.hb=ii("retryDelaySeedMs",1e4,n),this.eb=ii("forwardChannelMaxRetries",2,n),this.xa=ii("forwardChannelRequestTimeoutMs",2e4,n),this.va=n&&n.xmlHttpFactory||void 0,this.Ha=n&&n.useFetchStreams||!1,this.L=void 0,this.J=n&&n.supportsCrossDomainXhr||!1,this.K="",this.i=new Nc(n&&n.concurrentRequestLimit),this.Ja=new Xf,this.P=n&&n.fastHandshake||!1,this.O=n&&n.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.bb=n&&n.bc||!1,n&&n.Ea&&this.l.Ea(),n&&n.forceLongPolling&&(this.aa=!1),this.ca=!this.P&&this.aa&&n&&n.detectBufferingProxy||!1,this.qa=void 0,n&&n.longPollingTimeout&&0<n.longPollingTimeout&&(this.qa=n.longPollingTimeout),this.oa=void 0,this.S=0,this.M=!1,this.ma=this.B=null}function Lo(n){if(Qc(n),3==n.H){var e=n.W++,t=yt(n.I);if(ne(t,"SID",n.K),ne(t,"RID",e),ne(t,"TYPE","terminate"),si(n,t),(e=new Hr(n,n.l,e)).L=2,e.A=fs(yt(t)),t=!1,M.navigator&&M.navigator.sendBeacon)try{t=M.navigator.sendBeacon(e.A.toString(),"")}catch{}!t&&M.Image&&((new Image).src=e.A,t=!0),t||(e.g=nl(e.l,null),e.g.ha(e.A)),e.G=Date.now(),Zr(e)}el(n)}function _s(n){n.g&&(qo(n),n.g.cancel(),n.g=null)}function Qc(n){_s(n),n.u&&(M.clearTimeout(n.u),n.u=null),Is(n),n.i.cancel(),n.m&&("number"==typeof n.m&&M.clearTimeout(n.m),n.m=null)}function ys(n){if(!kc(n.i)&&!n.m){n.m=!0;var e=n.Na;rt||rs(),et||(rt(),et=!0),zr.add(e,n),n.C=0}}function Wc(n,e){var t;t=e?e.m:n.W++;const r=yt(n.I);ne(r,"SID",n.K),ne(r,"RID",t),ne(r,"AID",n.V),si(n,r),n.o&&n.s&&Oo(r,n.o,n.s),t=new Hr(n,n.l,t,n.C+1),null===n.o&&(t.I=n.s),e&&(n.j=e.F.concat(n.j)),e=Hc(n,t,1e3),t.setTimeout(Math.round(.5*n.xa)+Math.round(.5*n.xa*Math.random())),Fo(n.i,t),bo(t,r,e)}function si(n,e){n.na&&Mr(n.na,function(t,r){ne(e,r,t)}),n.h&&Pc({},function(t,r){ne(e,r,t)})}function Hc(n,e,t){t=Math.min(n.j.length,t);var r=n.h?Se(n.h.Va,n.h,n):null;e:{var i=n.j;let s=-1;for(;;){const o=["count="+t];-1==s?0<t?(s=i[0].g,o.push("ofs="+s)):s=0:o.push("ofs="+s);let a=!0;for(let u=0;u<t;u++){let c=i[u].g;const l=i[u].map;if(c-=s,0>c)s=Math.max(0,i[u].g-100),a=!1;else try{em(l,o,"req"+c+"_")}catch{r&&r(l)}}if(a){r=o.join("&");break e}}}return n=n.j.splice(0,t),e.F=n,r}function Zc(n){if(!n.g&&!n.u){n.ba=1;var e=n.Ma;rt||rs(),et||(rt(),et=!0),zr.add(e,n),n.A=0}}function Bo(n){return!(n.g||n.u||3<=n.A||(n.ba++,n.u=Qr(Se(n.Ma,n),Xc(n,n.A)),n.A++,0))}function qo(n){null!=n.B&&(M.clearTimeout(n.B),n.B=null)}function Jc(n){n.g=new Hr(n,n.l,"rpc",n.ba),null===n.o&&(n.g.I=n.s),n.g.O=0;var e=yt(n.wa);ne(e,"RID","rpc"),ne(e,"SID",n.K),ne(e,"AID",n.V),ne(e,"CI",n.G?"0":"1"),!n.G&&n.qa&&ne(e,"TO",n.qa),ne(e,"TYPE","xmlhttp"),si(n,e),n.o&&n.s&&Oo(e,n.o,n.s),n.L&&n.g.setTimeout(n.L);var t=n.g;n=n.pa,t.L=1,t.A=fs(yt(e)),t.u=null,t.S=!0,vc(t,n)}function Is(n){null!=n.v&&(M.clearTimeout(n.v),n.v=null)}function Yc(n,e){var t=null;if(n.g==e){Is(n),qo(n),n.g=null;var r=2}else{if(!ko(n.i,e))return;t=e.F,Mc(n.i,e),r=1}if(0!=n.H)if(e.i)if(1==r){t=e.u?e.u.length:0,e=Date.now()-e.G;var i=n.C;E(r=as(),new pc(r,t)),ys(n)}else Zc(n);else if(3==(i=e.s)||0==i&&0<e.ca||!(1==r&&function am(n,e){return!(Fc(n.i)>=n.i.j-(n.m?1:0)||(n.m?(n.j=e.F.concat(n.j),0):1==n.H||2==n.H||n.C>=(n.cb?0:n.eb)||(n.m=Qr(Se(n.Na,n,e),Xc(n,n.C)),n.C++,0)))}(n,e)||2==r&&Bo(n)))switch(t&&0<t.length&&(e=n.i,e.i=e.i.concat(t)),i){case 1:sn(n,5);break;case 4:sn(n,10);break;case 3:sn(n,6);break;default:sn(n,2)}}function Xc(n,e){let t=n.ab+Math.floor(Math.random()*n.hb);return n.isActive()||(t*=2),t*e}function sn(n,e){if(n.l.info("Error code "+e),2==e){var t=null;n.h&&(t=null);var r=Se(n.pb,n);t||(t=new rn("//www.google.com/images/cleardot.gif"),M.location&&"http"==M.location.protocol||hs(t,"https"),fs(t)),function tm(n,e){const t=new os;if(M.Image){const r=new Image;r.onload=Pn(ms,t,r,"TestLoadImage: loaded",!0,e),r.onerror=Pn(ms,t,r,"TestLoadImage: error",!1,e),r.onabort=Pn(ms,t,r,"TestLoadImage: abort",!1,e),r.ontimeout=Pn(ms,t,r,"TestLoadImage: timeout",!1,e),M.setTimeout(function(){r.ontimeout&&r.ontimeout()},1e4),r.src=n}else e(!1)}(t.toString(),r)}else Oe(2);n.H=0,n.h&&n.h.za(e),el(n),Qc(n)}function el(n){if(n.H=0,n.ma=[],n.h){const e=Oc(n.i);(0!=e.length||0!=n.j.length)&&(Sn(n.ma,e),Sn(n.ma,n.j),n.i.i.length=0,br(n.j),n.j.length=0),n.h.ya()}}function tl(n,e,t){var r=t instanceof rn?yt(t):new rn(t);if(""!=r.g)e&&(r.g=e+"."+r.g),ds(r,r.m);else{var i=M.location;r=i.protocol,e=e?e+"."+i.hostname:i.hostname,i=+i.port;var s=new rn(null);r&&hs(s,r),e&&(s.g=e),i&&ds(s,i),t&&(s.l=t),r=s}return e=n.Da,(t=n.F)&&e&&ne(r,t,e),ne(r,"VER",n.ra),si(n,r),r}function nl(n,e,t){if(e&&!n.J)throw Error("Can't create secondary domain capable XhrIo object.");return(e=new ae(n.Ha&&!n.va?new ti({ob:t}):n.va)).Oa(n.J),e}function rl(){}function Ts(){if(xt&&!(10<=Number(Fr)))throw Error("Environmental error: no available transport.")}function Ke(n,e){_e.call(this),this.g=new $c(e),this.l=n,this.h=e&&e.messageUrlParams||null,n=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(n?n["X-Client-Protocol"]="webchannel":n={"X-Client-Protocol":"webchannel"}),this.g.s=n,n=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(n?n["X-WebChannel-Content-Type"]=e.messageContentType:n={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.Ca&&(n?n["X-WebChannel-Client-Profile"]=e.Ca:n={"X-WebChannel-Client-Profile":e.Ca}),this.g.U=n,(n=e&&e.cc)&&!Ye(n)&&(this.g.o=n),this.A=e&&e.supportsCrossDomainXhr||!1,this.v=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!Ye(e)&&(this.g.F=e,null!==(n=this.h)&&e in n&&e in(n=this.h)&&delete n[e]),this.j=new Gn(this)}function il(n){Vo.call(this),n.__headers__&&(this.headers=n.__headers__,this.statusCode=n.__status__,delete n.__headers__,delete n.__status__);var e=n.__sm__;if(e){e:{for(const t in e){n=t;break e}n=void 0}(this.i=n)&&(n=this.i,e=null!==e&&n in e?e[n]:void 0),this.data=e}else this.data=n}function sl(){xo.call(this),this.status=1}function Gn(n){this.g=n}function tt(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.m=Array(this.blockSize),this.i=this.h=0,this.reset()}function Uo(n,e,t){t||(t=0);var r=Array(16);if("string"==typeof e)for(var i=0;16>i;++i)r[i]=e.charCodeAt(t++)|e.charCodeAt(t++)<<8|e.charCodeAt(t++)<<16|e.charCodeAt(t++)<<24;else for(i=0;16>i;++i)r[i]=e[t++]|e[t++]<<8|e[t++]<<16|e[t++]<<24;var s=n.g[3],o=(e=n.g[0])+(s^(t=n.g[1])&((i=n.g[2])^s))+r[0]+3614090360&4294967295;o=(t=(i=(s=(e=(t=(i=(s=(e=(t=(i=(s=(e=(t=(i=(s=(e=(t=(i=(s=(e=(t=(i=(s=(e=(t=(i=(s=(e=(t=(i=(s=(e=(t=(i=(s=(e=(t=(i=(s=(e=(t=(i=(s=(e=(t=(i=(s=(e=(t=(i=(s=(e=(t=(i=(s=(e=(t=(i=(s=(e=t+(o<<7&4294967295|o>>>25))+((o=s+(i^e&(t^i))+r[1]+3905402710&4294967295)<<12&4294967295|o>>>20))+((o=i+(t^s&(e^t))+r[2]+606105819&4294967295)<<17&4294967295|o>>>15))+((o=t+(e^i&(s^e))+r[3]+3250441966&4294967295)<<22&4294967295|o>>>10))+((o=e+(s^t&(i^s))+r[4]+4118548399&4294967295)<<7&4294967295|o>>>25))+((o=s+(i^e&(t^i))+r[5]+1200080426&4294967295)<<12&4294967295|o>>>20))+((o=i+(t^s&(e^t))+r[6]+2821735955&4294967295)<<17&4294967295|o>>>15))+((o=t+(e^i&(s^e))+r[7]+4249261313&4294967295)<<22&4294967295|o>>>10))+((o=e+(s^t&(i^s))+r[8]+1770035416&4294967295)<<7&4294967295|o>>>25))+((o=s+(i^e&(t^i))+r[9]+2336552879&4294967295)<<12&4294967295|o>>>20))+((o=i+(t^s&(e^t))+r[10]+4294925233&4294967295)<<17&4294967295|o>>>15))+((o=t+(e^i&(s^e))+r[11]+2304563134&4294967295)<<22&4294967295|o>>>10))+((o=e+(s^t&(i^s))+r[12]+1804603682&4294967295)<<7&4294967295|o>>>25))+((o=s+(i^e&(t^i))+r[13]+4254626195&4294967295)<<12&4294967295|o>>>20))+((o=i+(t^s&(e^t))+r[14]+2792965006&4294967295)<<17&4294967295|o>>>15))+((o=t+(e^i&(s^e))+r[15]+1236535329&4294967295)<<22&4294967295|o>>>10))+((o=e+(i^s&(t^i))+r[1]+4129170786&4294967295)<<5&4294967295|o>>>27))+((o=s+(t^i&(e^t))+r[6]+3225465664&4294967295)<<9&4294967295|o>>>23))+((o=i+(e^t&(s^e))+r[11]+643717713&4294967295)<<14&4294967295|o>>>18))+((o=t+(s^e&(i^s))+r[0]+3921069994&4294967295)<<20&4294967295|o>>>12))+((o=e+(i^s&(t^i))+r[5]+3593408605&4294967295)<<5&4294967295|o>>>27))+((o=s+(t^i&(e^t))+r[10]+38016083&4294967295)<<9&4294967295|o>>>23))+((o=i+(e^t&(s^e))+r[15]+3634488961&4294967295)<<14&4294967295|o>>>18))+((o=t+(s^e&(i^s))+r[4]+3889429448&4294967295)<<20&4294967295|o>>>12))+((o=e+(i^s&(t^i))+r[9]+568446438&4294967295)<<5&4294967295|o>>>27))+((o=s+(t^i&(e^t))+r[14]+3275163606&4294967295)<<9&4294967295|o>>>23))+((o=i+(e^t&(s^e))+r[3]+4107603335&4294967295)<<14&4294967295|o>>>18))+((o=t+(s^e&(i^s))+r[8]+1163531501&4294967295)<<20&4294967295|o>>>12))+((o=e+(i^s&(t^i))+r[13]+2850285829&4294967295)<<5&4294967295|o>>>27))+((o=s+(t^i&(e^t))+r[2]+4243563512&4294967295)<<9&4294967295|o>>>23))+((o=i+(e^t&(s^e))+r[7]+1735328473&4294967295)<<14&4294967295|o>>>18))+((o=t+(s^e&(i^s))+r[12]+2368359562&4294967295)<<20&4294967295|o>>>12))+((o=e+(t^i^s)+r[5]+4294588738&4294967295)<<4&4294967295|o>>>28))+((o=s+(e^t^i)+r[8]+2272392833&4294967295)<<11&4294967295|o>>>21))+((o=i+(s^e^t)+r[11]+1839030562&4294967295)<<16&4294967295|o>>>16))+((o=t+(i^s^e)+r[14]+4259657740&4294967295)<<23&4294967295|o>>>9))+((o=e+(t^i^s)+r[1]+2763975236&4294967295)<<4&4294967295|o>>>28))+((o=s+(e^t^i)+r[4]+1272893353&4294967295)<<11&4294967295|o>>>21))+((o=i+(s^e^t)+r[7]+4139469664&4294967295)<<16&4294967295|o>>>16))+((o=t+(i^s^e)+r[10]+3200236656&4294967295)<<23&4294967295|o>>>9))+((o=e+(t^i^s)+r[13]+681279174&4294967295)<<4&4294967295|o>>>28))+((o=s+(e^t^i)+r[0]+3936430074&4294967295)<<11&4294967295|o>>>21))+((o=i+(s^e^t)+r[3]+3572445317&4294967295)<<16&4294967295|o>>>16))+((o=t+(i^s^e)+r[6]+76029189&4294967295)<<23&4294967295|o>>>9))+((o=e+(t^i^s)+r[9]+3654602809&4294967295)<<4&4294967295|o>>>28))+((o=s+(e^t^i)+r[12]+3873151461&4294967295)<<11&4294967295|o>>>21))+((o=i+(s^e^t)+r[15]+530742520&4294967295)<<16&4294967295|o>>>16))+((o=t+(i^s^e)+r[2]+3299628645&4294967295)<<23&4294967295|o>>>9))+((o=e+(i^(t|~s))+r[0]+4096336452&4294967295)<<6&4294967295|o>>>26))+((o=s+(t^(e|~i))+r[7]+1126891415&4294967295)<<10&4294967295|o>>>22))+((o=i+(e^(s|~t))+r[14]+2878612391&4294967295)<<15&4294967295|o>>>17))+((o=t+(s^(i|~e))+r[5]+4237533241&4294967295)<<21&4294967295|o>>>11))+((o=e+(i^(t|~s))+r[12]+1700485571&4294967295)<<6&4294967295|o>>>26))+((o=s+(t^(e|~i))+r[3]+2399980690&4294967295)<<10&4294967295|o>>>22))+((o=i+(e^(s|~t))+r[10]+4293915773&4294967295)<<15&4294967295|o>>>17))+((o=t+(s^(i|~e))+r[1]+2240044497&4294967295)<<21&4294967295|o>>>11))+((o=e+(i^(t|~s))+r[8]+1873313359&4294967295)<<6&4294967295|o>>>26))+((o=s+(t^(e|~i))+r[15]+4264355552&4294967295)<<10&4294967295|o>>>22))+((o=i+(e^(s|~t))+r[6]+2734768916&4294967295)<<15&4294967295|o>>>17))+((o=t+(s^(i|~e))+r[13]+1309151649&4294967295)<<21&4294967295|o>>>11))+((s=(e=t+((o=e+(i^(t|~s))+r[4]+4149444226&4294967295)<<6&4294967295|o>>>26))+((o=s+(t^(e|~i))+r[11]+3174756917&4294967295)<<10&4294967295|o>>>22))^((i=s+((o=i+(e^(s|~t))+r[2]+718787259&4294967295)<<15&4294967295|o>>>17))|~e))+r[9]+3951481745&4294967295,n.g[0]=n.g[0]+e&4294967295,n.g[1]=n.g[1]+(i+(o<<21&4294967295|o>>>11))&4294967295,n.g[2]=n.g[2]+i&4294967295,n.g[3]=n.g[3]+s&4294967295}function H(n,e){this.h=e;for(var t=[],r=!0,i=n.length-1;0<=i;i--){var s=0|n[i];r&&s==e||(t[i]=s,r=!1)}this.g=t}(V=ae.prototype).Oa=function(n){this.M=n},V.ha=function(n,e,t,r){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.I+"; newUri="+n);e=e?e.toUpperCase():"GET",this.I=n,this.j="",this.m=0,this.F=!1,this.h=!0,this.g=this.u?this.u.g():Co.g(),this.C=function yc(n){return n.h||(n.h=n.i())}(this.u?this.u:Co),this.g.onreadystatechange=Se(this.La,this);try{this.G=!0,this.g.open(e,String(n),!0),this.G=!1}catch(s){return void qc(this,s)}if(n=t||"",t=new Map(this.headers),r)if(Object.getPrototypeOf(r)===Object.prototype)for(var i in r)t.set(i,r[i]);else{if("function"!=typeof r.keys||"function"!=typeof r.get)throw Error("Unknown input type for opt_headers: "+String(r));for(const s of r.keys())t.set(s,r.get(s))}r=Array.from(t.keys()).find(s=>"content-type"==s.toLowerCase()),i=M.FormData&&n instanceof M.FormData,!(0<=Qi(im,e))||r||i||t.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[s,o]of t)this.g.setRequestHeader(s,o);this.K&&(this.g.responseType=this.K),"withCredentials"in this.g&&this.g.withCredentials!==this.M&&(this.g.withCredentials=this.M);try{zc(this),0<this.B&&((this.L=function sm(n){return xt&&"number"==typeof n.timeout&&void 0!==n.ontimeout}(this.g))?(this.g.timeout=this.B,this.g.ontimeout=Se(this.ua,this)):this.A=jr(this.ua,this.B,this)),this.v=!0,this.g.send(n),this.v=!1}catch(s){qc(this,s)}},V.ua=function(){typeof Me<"u"&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,E(this,"timeout"),this.abort(8))},V.abort=function(n){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=n||7,E(this,"complete"),E(this,"abort"),ps(this))},V.N=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),ps(this,!0)),ae.$.N.call(this)},V.La=function(){this.s||(this.G||this.v||this.l?Gc(this):this.kb())},V.kb=function(){Gc(this)},V.isActive=function(){return!!this.g},V.da=function(){try{return 2<it(this)?this.g.status:-1}catch{return-1}},V.ja=function(){try{return this.g?this.g.responseText:""}catch{return""}},V.Wa=function(n){if(this.g){var e=this.g.responseText;return n&&0==e.indexOf(n)&&(e=e.substring(n.length)),nm(e)}},V.Ia=function(){return this.m},V.Sa=function(){return"string"==typeof this.j?this.j:String(this.j)},(V=$c.prototype).ra=8,V.H=1,V.Na=function(n){if(this.m)if(this.m=null,1==this.H){if(!n){this.W=Math.floor(1e5*Math.random()),n=this.W++;const i=new Hr(this,this.l,n);let s=this.s;if(this.U&&(s?(s=Ji(s),Yi(s,this.U)):s=this.U),null!==this.o||this.O||(i.I=s,s=null),this.P)e:{for(var e=0,t=0;t<this.j.length;t++){var r=this.j[t];if(void 0===(r="__data__"in r.map&&"string"==typeof(r=r.map.__data__)?r.length:void 0))break;if(4096<(e+=r)){e=t;break e}if(4096===e||t===this.j.length-1){e=t+1;break e}}e=1e3}else e=1e3;e=Hc(this,i,e),ne(t=yt(this.I),"RID",n),ne(t,"CVER",22),this.F&&ne(t,"X-HTTP-Session-Id",this.F),si(this,t),s&&(this.O?e="headers="+encodeURIComponent(String(jc(s)))+"&"+e:this.o&&Oo(t,this.o,s)),Fo(this.i,i),this.bb&&ne(t,"TYPE","init"),this.P?(ne(t,"$req",e),ne(t,"SID","null"),i.aa=!0,bo(i,t,null)):bo(i,t,e),this.H=2}}else 3==this.H&&(n?Wc(this,n):0==this.j.length||kc(this.i)||Wc(this))},V.Ma=function(){if(this.u=null,Jc(this),this.ca&&!(this.M||null==this.g||0>=this.S)){var n=2*this.S;this.l.info("BP detection timer enabled: "+n),this.B=Qr(Se(this.jb,this),n)}},V.jb=function(){this.B&&(this.B=null,this.l.info("BP detection timeout reached."),this.l.info("Buffering proxy detected and switch to long-polling!"),this.G=!1,this.M=!0,Oe(10),_s(this),Jc(this))},V.ib=function(){null!=this.v&&(this.v=null,_s(this),Bo(this),Oe(19))},V.pb=function(n){n?(this.l.info("Successfully pinged google.com"),Oe(2)):(this.l.info("Failed to ping google.com"),Oe(1))},V.isActive=function(){return!!this.h&&this.h.isActive(this)},(V=rl.prototype).Ba=function(){},V.Aa=function(){},V.za=function(){},V.ya=function(){},V.isActive=function(){return!0},V.Va=function(){},Ts.prototype.g=function(n,e){return new Ke(n,e)},T(Ke,_e),Ke.prototype.m=function(){this.g.h=this.j,this.A&&(this.g.J=!0);var n=this.g,e=this.l,t=this.h||void 0;Oe(0),n.Y=e,n.na=t||{},n.G=n.aa,n.I=tl(n,null,n.Y),ys(n)},Ke.prototype.close=function(){Lo(this.g)},Ke.prototype.u=function(n){var e=this.g;if("string"==typeof n){var t={};t.__data__=n,n=t}else this.v&&((t={}).__data__=f(n),n=t);e.j.push(new class{constructor(n,e){this.g=n,this.map=e}}(e.fb++,n)),3==e.H&&ys(e)},Ke.prototype.N=function(){this.g.h=null,delete this.j,Lo(this.g),delete this.g,Ke.$.N.call(this)},T(il,Vo),T(sl,xo),T(Gn,rl),Gn.prototype.Ba=function(){E(this.g,"a")},Gn.prototype.Aa=function(n){E(this.g,new il(n))},Gn.prototype.za=function(n){E(this.g,new sl)},Gn.prototype.ya=function(){E(this.g,"b")},T(tt,function um(){this.blockSize=-1}),tt.prototype.reset=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.i=this.h=0},tt.prototype.j=function(n,e){void 0===e&&(e=n.length);for(var t=e-this.blockSize,r=this.m,i=this.h,s=0;s<e;){if(0==i)for(;s<=t;)Uo(this,n,s),s+=this.blockSize;if("string"==typeof n){for(;s<e;)if(r[i++]=n.charCodeAt(s++),i==this.blockSize){Uo(this,r),i=0;break}}else for(;s<e;)if(r[i++]=n[s++],i==this.blockSize){Uo(this,r),i=0;break}}this.h=i,this.i+=e},tt.prototype.l=function(){var n=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);n[0]=128;for(var e=1;e<n.length-8;++e)n[e]=0;var t=8*this.i;for(e=n.length-8;e<n.length;++e)n[e]=255&t,t/=256;for(this.j(n),n=Array(16),e=t=0;4>e;++e)for(var r=0;32>r;r+=8)n[t++]=this.g[e]>>>r&255;return n};var cm={};function Go(n){return-128<=n&&128>n?function Hi(n,e){var t=cm;return Object.prototype.hasOwnProperty.call(t,n)?t[n]:t[n]=e(n)}(n,function(e){return new H([0|e],0>e?-1:0)}):new H([0|n],0>n?-1:0)}function st(n){if(isNaN(n)||!isFinite(n))return zn;if(0>n)return xe(st(-n));for(var e=[],t=1,r=0;n>=t;r++)e[r]=n/t|0,t*=zo;return new H(e,0)}var zo=4294967296,zn=Go(0),Ko=Go(1),al=Go(16777216);function It(n){if(0!=n.h)return!1;for(var e=0;e<n.g.length;e++)if(0!=n.g[e])return!1;return!0}function He(n){return-1==n.h}function xe(n){for(var e=n.g.length,t=[],r=0;r<e;r++)t[r]=~n.g[r];return new H(t,~n.h).add(Ko)}function Es(n,e){return n.add(xe(e))}function vs(n,e){for(;(65535&n[e])!=n[e];)n[e+1]+=n[e]>>>16,n[e]&=65535,e++}function oi(n,e){this.g=n,this.h=e}function As(n,e){if(It(e))throw Error("division by zero");if(It(n))return new oi(zn,zn);if(He(n))return e=As(xe(n),e),new oi(xe(e.g),xe(e.h));if(He(e))return e=As(n,xe(e)),new oi(xe(e.g),e.h);if(30<n.g.length){if(He(n)||He(e))throw Error("slowDivide_ only works with positive integers.");for(var t=Ko,r=e;0>=r.X(n);)t=ul(t),r=ul(r);var i=Kn(t,1),s=Kn(r,1);for(r=Kn(r,2),t=Kn(t,2);!It(r);){var o=s.add(r);0>=o.X(n)&&(i=i.add(t),s=o),r=Kn(r,1),t=Kn(t,1)}return e=Es(n,i.R(e)),new oi(i,e)}for(i=zn;0<=n.X(e);){for(t=Math.max(1,Math.floor(n.ea()/e.ea())),r=48>=(r=Math.ceil(Math.log(t)/Math.LN2))?1:Math.pow(2,r-48),o=(s=st(t)).R(e);He(o)||0<o.X(n);)o=(s=st(t-=r)).R(e);It(s)&&(s=Ko),i=i.add(s),n=Es(n,o)}return new oi(i,n)}function ul(n){for(var e=n.g.length+1,t=[],r=0;r<e;r++)t[r]=n.D(r)<<1|n.D(r-1)>>>31;return new H(t,n.h)}function Kn(n,e){var t=e>>5;e%=32;for(var r=n.g.length-t,i=[],s=0;s<r;s++)i[s]=0<e?n.D(s+t)>>>e|n.D(s+t+1)<<32-e:n.D(s+t);return new H(i,n.h)}(V=H.prototype).ea=function(){if(He(this))return-xe(this).ea();for(var n=0,e=1,t=0;t<this.g.length;t++){var r=this.D(t);n+=(0<=r?r:zo+r)*e,e*=zo}return n},V.toString=function(n){if(2>(n=n||10)||36<n)throw Error("radix out of range: "+n);if(It(this))return"0";if(He(this))return"-"+xe(this).toString(n);for(var e=st(Math.pow(n,6)),t=this,r="";;){var i=As(t,e).g,s=((0<(t=Es(t,i.R(e))).g.length?t.g[0]:t.h)>>>0).toString(n);if(It(t=i))return s+r;for(;6>s.length;)s="0"+s;r=s+r}},V.D=function(n){return 0>n?0:n<this.g.length?this.g[n]:this.h},V.X=function(n){return He(n=Es(this,n))?-1:It(n)?0:1},V.abs=function(){return He(this)?xe(this):this},V.add=function(n){for(var e=Math.max(this.g.length,n.g.length),t=[],r=0,i=0;i<=e;i++){var s=r+(65535&this.D(i))+(65535&n.D(i)),o=(s>>>16)+(this.D(i)>>>16)+(n.D(i)>>>16);r=o>>>16,t[i]=(o&=65535)<<16|(s&=65535)}return new H(t,-2147483648&t[t.length-1]?-1:0)},V.R=function(n){if(It(this)||It(n))return zn;if(He(this))return He(n)?xe(this).R(xe(n)):xe(xe(this).R(n));if(He(n))return xe(this.R(xe(n)));if(0>this.X(al)&&0>n.X(al))return st(this.ea()*n.ea());for(var e=this.g.length+n.g.length,t=[],r=0;r<2*e;r++)t[r]=0;for(r=0;r<this.g.length;r++)for(var i=0;i<n.g.length;i++){var s=this.D(r)>>>16,o=65535&this.D(r),a=n.D(i)>>>16,u=65535&n.D(i);t[2*r+2*i]+=o*u,vs(t,2*r+2*i),t[2*r+2*i+1]+=s*u,vs(t,2*r+2*i+1),t[2*r+2*i+1]+=o*a,vs(t,2*r+2*i+1),t[2*r+2*i+2]+=s*a,vs(t,2*r+2*i+2)}for(r=0;r<e;r++)t[r]=t[2*r+1]<<16|t[2*r];for(r=e;r<2*e;r++)t[r]=0;return new H(t,0)},V.gb=function(n){return As(this,n).h},V.and=function(n){for(var e=Math.max(this.g.length,n.g.length),t=[],r=0;r<e;r++)t[r]=this.D(r)&n.D(r);return new H(t,this.h&n.h)},V.or=function(n){for(var e=Math.max(this.g.length,n.g.length),t=[],r=0;r<e;r++)t[r]=this.D(r)|n.D(r);return new H(t,this.h|n.h)},V.xor=function(n){for(var e=Math.max(this.g.length,n.g.length),t=[],r=0;r<e;r++)t[r]=this.D(r)^n.D(r);return new H(t,this.h^n.h)},Ts.prototype.createWebChannel=Ts.prototype.g,Ke.prototype.send=Ke.prototype.u,Ke.prototype.open=Ke.prototype.m,Ke.prototype.close=Ke.prototype.close,us.NO_ERROR=0,us.TIMEOUT=8,us.HTTP_ERROR=6,_c.COMPLETE="complete",Ic.EventType=Wr,Wr.OPEN="a",Wr.CLOSE="b",Wr.ERROR="c",Wr.MESSAGE="d",_e.prototype.listen=_e.prototype.O,ae.prototype.listenOnce=ae.prototype.P,ae.prototype.getLastError=ae.prototype.Sa,ae.prototype.getLastErrorCode=ae.prototype.Ia,ae.prototype.getStatus=ae.prototype.da,ae.prototype.getResponseJson=ae.prototype.Wa,ae.prototype.getResponseText=ae.prototype.ja,ae.prototype.send=ae.prototype.ha,ae.prototype.setWithCredentials=ae.prototype.Oa,tt.prototype.digest=tt.prototype.l,tt.prototype.reset=tt.prototype.reset,tt.prototype.update=tt.prototype.j,H.prototype.add=H.prototype.add,H.prototype.multiply=H.prototype.R,H.prototype.modulo=H.prototype.gb,H.prototype.compare=H.prototype.X,H.prototype.toNumber=H.prototype.ea,H.prototype.toString=H.prototype.toString,H.prototype.getBits=H.prototype.D,H.fromNumber=st,H.fromString=function ol(n,e){if(0==n.length)throw Error("number format error: empty string");if(2>(e=e||10)||36<e)throw Error("radix out of range: "+e);if("-"==n.charAt(0))return xe(ol(n.substring(1),e));if(0<=n.indexOf("-"))throw Error('number format error: interior "-" character');for(var t=st(Math.pow(e,8)),r=zn,i=0;i<n.length;i+=8){var s=Math.min(8,n.length-i),o=parseInt(n.substring(i,i+s),e);8>s?(s=st(Math.pow(e,s)),r=r.R(s).add(st(o))):r=(r=r.R(t)).add(st(o))}return r};var lm=me.createWebChannelTransport=function(){return new Ts},hm=me.getStatEventTarget=function(){return as()},jo=me.ErrorCode=us,dm=me.EventType=_c,fm=me.Event=tn,cl=me.Stat={xb:0,Ab:1,Bb:2,Ub:3,Zb:4,Wb:5,Xb:6,Vb:7,Tb:8,Yb:9,PROXY:10,NOPROXY:11,Rb:12,Nb:13,Ob:14,Mb:15,Pb:16,Qb:17,tb:18,sb:19,ub:20},mm=me.FetchXmlHttpFactory=ti,ws=me.WebChannel=Ic,gm=me.XhrIo=ae,pm=me.Md5=tt,jn=me.Integer=H;const ll="@firebase/firestore";class ve{constructor(e){this.uid=e}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}ve.UNAUTHENTICATED=new ve(null),ve.GOOGLE_CREDENTIALS=new ve("google-credentials-uid"),ve.FIRST_PARTY=new ve("first-party-uid"),ve.MOCK_USER=new ve("mock-user");let $n="10.11.1";const kt=new Pe.Yd("@firebase/firestore");function Qn(){return kt.logLevel}function _m(n){kt.setLogLevel(n)}function A(n,...e){if(kt.logLevel<=Pe.in.DEBUG){const t=e.map($o);kt.debug(`Firestore (${$n}): ${n}`,...t)}}function he(n,...e){if(kt.logLevel<=Pe.in.ERROR){const t=e.map($o);kt.error(`Firestore (${$n}): ${n}`,...t)}}function Ue(n,...e){if(kt.logLevel<=Pe.in.WARN){const t=e.map($o);kt.warn(`Firestore (${$n}): ${n}`,...t)}}function $o(n){if("string"==typeof n)return n;try{return JSON.stringify(n)}catch{return n}}function D(n="Unexpected state"){const e=`FIRESTORE (${$n}) INTERNAL ASSERTION FAILED: `+n;throw he(e),new Error(e)}function b(n,e){n||D()}function ym(n,e){n||D()}function S(n,e){return n}const _={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class v extends U.ZR{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class ye{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}class hl{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class Im{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(ve.UNAUTHENTICATED))}shutdown(){}}class Tm{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class Em{constructor(e){this.t=e,this.currentUser=ve.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){var r=this;let i=this.i;const s=c=>this.i!==i?(i=this.i,t(c)):Promise.resolve();let o=new ye;this.o=()=>{this.i++,this.currentUser=this.u(),o.resolve(),o=new ye,e.enqueueRetryable(()=>s(this.currentUser))};const a=()=>{const c=o;e.enqueueRetryable((0,y.Z)(function*(){yield c.promise,yield s(r.currentUser)}))},u=c=>{A("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=c,this.auth.addAuthTokenListener(this.o),a()};this.t.onInit(c=>u(c)),setTimeout(()=>{if(!this.auth){const c=this.t.getImmediate({optional:!0});c?u(c):(A("FirebaseAuthCredentialsProvider","Auth not yet detected"),o.resolve(),o=new ye)}},0),a()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(r=>this.i!==e?(A("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(b("string"==typeof r.accessToken),new hl(r.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){const e=this.auth&&this.auth.getUid();return b(null===e||"string"==typeof e),new ve(e)}}class vm{constructor(e,t,r){this.l=e,this.h=t,this.P=r,this.type="FirstParty",this.user=ve.FIRST_PARTY,this.I=new Map}T(){return this.P?this.P():null}get headers(){this.I.set("X-Goog-AuthUser",this.l);const e=this.T();return e&&this.I.set("Authorization",e),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}}class Am{constructor(e,t,r){this.l=e,this.h=t,this.P=r}getToken(){return Promise.resolve(new vm(this.l,this.h,this.P))}start(e,t){e.enqueueRetryable(()=>t(ve.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class dl{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class wm{constructor(e){this.A=e,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(e,t){const r=s=>{null!=s.error&&A("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${s.error.message}`);const o=s.token!==this.R;return this.R=s.token,A("FirebaseAppCheckTokenProvider",`Received ${o?"new":"existing"} token.`),o?t(s.token):Promise.resolve()};this.o=s=>{e.enqueueRetryable(()=>r(s))};const i=s=>{A("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=s,this.appCheck.addTokenListener(this.o)};this.A.onInit(s=>i(s)),setTimeout(()=>{if(!this.appCheck){const s=this.A.getImmediate({optional:!0});s?i(s):A("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(b("string"==typeof t.token),this.R=t.token,new dl(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}}function Rm(n){const e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(n);if(e&&"function"==typeof e.getRandomValues)e.getRandomValues(t);else for(let r=0;r<n;r++)t[r]=Math.floor(256*Math.random());return t}class fl{static newId(){const t=62*Math.floor(256/62);let r="";for(;r.length<20;){const i=Rm(40);for(let s=0;s<i.length;++s)r.length<20&&i[s]<t&&(r+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(i[s]%62))}return r}}function O(n,e){return n<e?-1:n>e?1:0}function Wn(n,e,t){return n.length===e.length&&n.every((r,i)=>t(r,e[i]))}function ml(n){return n+"\0"}class se{constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new v(_.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new v(_.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-62135596800)throw new v(_.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new v(_.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return se.fromMillis(Date.now())}static fromDate(e){return se.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),r=Math.floor(1e6*(e-1e3*t));return new se(t,r)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?O(this.nanoseconds,e.nanoseconds):O(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){return String(this.seconds- -62135596800).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}class N{constructor(e){this.timestamp=e}static fromTimestamp(e){return new N(e)}static min(){return new N(new se(0,0))}static max(){return new N(new se(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}class ai{constructor(e,t,r){void 0===t?t=0:t>e.length&&D(),void 0===r?r=e.length-t:r>e.length-t&&D(),this.segments=e,this.offset=t,this.len=r}get length(){return this.len}isEqual(e){return 0===ai.comparator(this,e)}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof ai?e.forEach(r=>{t.push(r)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return this.construct(this.segments,this.offset+(e=void 0===e?1:e),this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return 0===this.length}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,r=this.limit();t<r;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const r=Math.min(e.length,t.length);for(let i=0;i<r;i++){const s=e.get(i),o=t.get(i);if(s<o)return-1;if(s>o)return 1}return e.length<t.length?-1:e.length>t.length?1:0}}class K extends ai{construct(e,t,r){return new K(e,t,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const t=[];for(const r of e){if(r.indexOf("//")>=0)throw new v(_.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);t.push(...r.split("/").filter(i=>i.length>0))}return new K(t)}static emptyPath(){return new K([])}}const Pm=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class re extends ai{construct(e,t,r){return new re(e,t,r)}static isValidIdentifier(e){return Pm.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),re.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&"__name__"===this.get(0)}static keyField(){return new re(["__name__"])}static fromServerFormat(e){const t=[];let r="",i=0;const s=()=>{if(0===r.length)throw new v(_.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(r),r=""};let o=!1;for(;i<e.length;){const a=e[i];if("\\"===a){if(i+1===e.length)throw new v(_.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const u=e[i+1];if("\\"!==u&&"."!==u&&"`"!==u)throw new v(_.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=u,i+=2}else"`"===a?(o=!o,i++):"."!==a||o?(r+=a,i++):(s(),i++)}if(s(),o)throw new v(_.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new re(t)}static emptyPath(){return new re([])}}class C{constructor(e){this.path=e}static fromPath(e){return new C(K.fromString(e))}static fromName(e){return new C(K.fromString(e).popFirst(5))}static empty(){return new C(K.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return null!==e&&0===K.comparator(this.path,e.path)}toString(){return this.path.toString()}static comparator(e,t){return K.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new C(new K(e.slice()))}}class Hn{constructor(e,t,r,i){this.indexId=e,this.collectionGroup=t,this.fields=r,this.indexState=i}}function Qo(n){return n.fields.find(e=>2===e.kind)}function on(n){return n.fields.filter(e=>2!==e.kind)}Hn.UNKNOWN_ID=-1;class an{constructor(e,t){this.fieldPath=e,this.kind=t}}class Zn{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new Zn(0,je.min())}}function gl(n,e){const t=n.toTimestamp().seconds,r=n.toTimestamp().nanoseconds+1,i=N.fromTimestamp(1e9===r?new se(t+1,0):new se(t,r));return new je(i,C.empty(),e)}function pl(n){return new je(n.readTime,n.key,-1)}class je{constructor(e,t,r){this.readTime=e,this.documentKey=t,this.largestBatchId=r}static min(){return new je(N.min(),C.empty(),-1)}static max(){return new je(N.max(),C.empty(),-1)}}function Wo(n,e){let t=n.readTime.compareTo(e.readTime);return 0!==t?t:(t=C.comparator(n.documentKey,e.documentKey),0!==t?t:O(n.largestBatchId,e.largestBatchId))}const _l="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class yl{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}function Ft(n){return Ho.apply(this,arguments)}function Ho(){return Ho=(0,y.Z)(function*(n){if(n.code!==_.FAILED_PRECONDITION||n.message!==_l)throw n;A("LocalStore","Unexpectedly lost primary lease")}),Ho.apply(this,arguments)}class g{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&D(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new g((r,i)=>{this.nextCallback=s=>{this.wrapSuccess(e,s).next(r,i)},this.catchCallback=s=>{this.wrapFailure(t,s).next(r,i)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{const t=e();return t instanceof g?t:g.resolve(t)}catch(t){return g.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):g.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):g.reject(t)}static resolve(e){return new g((t,r)=>{t(e)})}static reject(e){return new g((t,r)=>{r(e)})}static waitFor(e){return new g((t,r)=>{let i=0,s=0,o=!1;e.forEach(a=>{++i,a.next(()=>{++s,o&&s===i&&t()},u=>r(u))}),o=!0,s===i&&t()})}static or(e){let t=g.resolve(!1);for(const r of e)t=t.next(i=>i?g.resolve(i):r());return t}static forEach(e,t){const r=[];return e.forEach((i,s)=>{r.push(t.call(this,i,s))}),this.waitFor(r)}static mapArray(e,t){return new g((r,i)=>{const s=e.length,o=new Array(s);let a=0;for(let u=0;u<s;u++){const c=u;t(e[c]).next(l=>{o[c]=l,++a,a===s&&r(o)},l=>i(l))}})}static doWhile(e,t){return new g((r,i)=>{const s=()=>{!0===e()?t().next(()=>{s()},i):r()};s()})}}class Rs{constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.V=new ye,this.transaction.oncomplete=()=>{this.V.resolve()},this.transaction.onabort=()=>{t.error?this.V.reject(new ui(e,t.error)):this.V.resolve()},this.transaction.onerror=r=>{const i=Zo(r.target.error);this.V.reject(new ui(e,i))}}static open(e,t,r,i){try{return new Rs(t,e.transaction(i,r))}catch(s){throw new ui(t,s)}}get m(){return this.V.promise}abort(e){e&&this.V.reject(e),this.aborted||(A("SimpleDb","Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}g(){const e=this.transaction;this.aborted||"function"!=typeof e.commit||e.commit()}store(e){const t=this.transaction.objectStore(e);return new Cm(t)}}class ot{constructor(e,t,r){this.name=e,this.version=t,this.p=r,12.2===ot.S((0,U.z$)())&&he("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(e){return A("SimpleDb","Removing database:",e),un(window.indexedDB.deleteDatabase(e)).toPromise()}static D(){if(!(0,U.hl)())return!1;if(ot.C())return!0;const e=(0,U.z$)(),t=ot.S(e),r=0<t&&t<10,i=Il(e),s=0<i&&i<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||r||s)}static C(){var e;return typeof process<"u"&&"YES"===(null===(e=process.__PRIVATE_env)||void 0===e?void 0:e.v)}static F(e,t){return e.store(t)}static S(e){const t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),r=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(r)}M(e){var t=this;return(0,y.Z)(function*(){return t.db||(A("SimpleDb","Opening database:",t.name),t.db=yield new Promise((r,i)=>{const s=indexedDB.open(t.name,t.version);s.onsuccess=o=>{r(o.target.result)},s.onblocked=()=>{i(new ui(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},s.onerror=o=>{const a=o.target.error;i("VersionError"===a.name?new v(_.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh."):"InvalidStateError"===a.name?new v(_.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+a):new ui(e,a))},s.onupgradeneeded=o=>{A("SimpleDb",'Database "'+t.name+'" requires upgrade from version:',o.oldVersion),t.p.O(o.target.result,s.transaction,o.oldVersion,t.version).next(()=>{A("SimpleDb","Database upgrade to version "+t.version+" complete")})}})),t.N&&(t.db.onversionchange=r=>t.N(r)),t.db})()}L(e){this.N=e,this.db&&(this.db.onversionchange=t=>e(t))}runTransaction(e,t,r,i){var s=this;return(0,y.Z)(function*(){const o="readonly"===t;let a=0;for(;;){++a;try{s.db=yield s.M(e);const u=Rs.open(s.db,e,o?"readonly":"readwrite",r),c=i(u).next(l=>(u.g(),l)).catch(l=>(u.abort(l),g.reject(l))).toPromise();return c.catch(()=>{}),yield u.m,c}catch(u){const c=u,l="FirebaseError"!==c.name&&a<3;if(A("SimpleDb","Transaction failed with error:",c.message,"Retrying:",l),s.close(),!l)return Promise.reject(c)}}})()}close(){this.db&&this.db.close(),this.db=void 0}}function Il(n){const e=n.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}class xm{constructor(e){this.B=e,this.k=!1,this.q=null}get isDone(){return this.k}get K(){return this.q}set cursor(e){this.B=e}done(){this.k=!0}$(e){this.q=e}delete(){return un(this.B.delete())}}class ui extends v{constructor(e,t){super(_.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}}function Mt(n){return"IndexedDbTransactionError"===n.name}class Cm{constructor(e){this.store=e}put(e,t){let r;return void 0!==t?(A("SimpleDb","PUT",this.store.name,e,t),r=this.store.put(t,e)):(A("SimpleDb","PUT",this.store.name,"<auto-key>",e),r=this.store.put(e)),un(r)}add(e){return A("SimpleDb","ADD",this.store.name,e,e),un(this.store.add(e))}get(e){return un(this.store.get(e)).next(t=>(void 0===t&&(t=null),A("SimpleDb","GET",this.store.name,e,t),t))}delete(e){return A("SimpleDb","DELETE",this.store.name,e),un(this.store.delete(e))}count(){return A("SimpleDb","COUNT",this.store.name),un(this.store.count())}U(e,t){const r=this.options(e,t),i=r.index?this.store.index(r.index):this.store;if("function"==typeof i.getAll){const s=i.getAll(r.range);return new g((o,a)=>{s.onerror=u=>{a(u.target.error)},s.onsuccess=u=>{o(u.target.result)}})}{const s=this.cursor(r),o=[];return this.W(s,(a,u)=>{o.push(u)}).next(()=>o)}}G(e,t){const r=this.store.getAll(e,null===t?void 0:t);return new g((i,s)=>{r.onerror=o=>{s(o.target.error)},r.onsuccess=o=>{i(o.target.result)}})}j(e,t){A("SimpleDb","DELETE ALL",this.store.name);const r=this.options(e,t);r.H=!1;const i=this.cursor(r);return this.W(i,(s,o,a)=>a.delete())}J(e,t){let r;t?r=e:(r={},t=e);const i=this.cursor(r);return this.W(i,t)}Y(e){const t=this.cursor({});return new g((r,i)=>{t.onerror=s=>{const o=Zo(s.target.error);i(o)},t.onsuccess=s=>{const o=s.target.result;o?e(o.primaryKey,o.value).next(a=>{a?o.continue():r()}):r()}})}W(e,t){const r=[];return new g((i,s)=>{e.onerror=o=>{s(o.target.error)},e.onsuccess=o=>{const a=o.target.result;if(!a)return void i();const u=new xm(a),c=t(a.primaryKey,a.value,u);if(c instanceof g){const l=c.catch(d=>(u.done(),g.reject(d)));r.push(l)}u.isDone?i():null===u.K?a.continue():a.continue(u.K)}}).next(()=>g.waitFor(r))}options(e,t){let r;return void 0!==e&&("string"==typeof e?r=e:t=e),{index:r,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){const r=this.store.index(e.index);return e.H?r.openKeyCursor(e.range,t):r.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}}function un(n){return new g((e,t)=>{n.onsuccess=r=>{e(r.target.result)},n.onerror=r=>{const i=Zo(r.target.error);t(i)}})}let Tl=!1;function Zo(n){const e=ot.S((0,U.z$)());if(e>=12.2&&e<13){const t="An internal error was encountered in the Indexed Database server";if(n.message.indexOf(t)>=0){const r=new v("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return Tl||(Tl=!0,setTimeout(()=>{throw r},0)),r}}return n}class Dm{constructor(e,t){this.asyncQueue=e,this.Z=t,this.task=null}start(){this.X(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return null!==this.task}X(e){var t=this;A("IndexBackfiller",`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,(0,y.Z)(function*(){t.task=null;try{A("IndexBackfiller",`Documents written: ${yield t.Z.ee()}`)}catch(r){Mt(r)?A("IndexBackfiller","Ignoring IndexedDB error during index backfill: ",r):yield Ft(r)}yield t.X(6e4)}))}}class bm{constructor(e,t){this.localStore=e,this.persistence=t}ee(e=50){var t=this;return(0,y.Z)(function*(){return t.persistence.runTransaction("Backfill Indexes","readwrite-primary",r=>t.te(r,e))})()}te(e,t){const r=new Set;let i=t,s=!0;return g.doWhile(()=>!0===s&&i>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next(o=>{if(null!==o&&!r.has(o))return A("IndexBackfiller",`Processing collection: ${o}`),this.ne(e,o,i).next(a=>{i-=a,r.add(o)});s=!1})).next(()=>t-i)}ne(e,t,r){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next(i=>this.localStore.localDocuments.getNextDocuments(e,t,i,r).next(s=>{const o=s.changes;return this.localStore.indexManager.updateIndexEntries(e,o).next(()=>this.re(i,s)).next(a=>(A("IndexBackfiller",`Updating offset: ${a}`),this.localStore.indexManager.updateCollectionGroup(e,t,a))).next(()=>o.size)}))}re(e,t){let r=e;return t.changes.forEach((i,s)=>{const o=pl(s);Wo(o,r)>0&&(r=o)}),new je(r.readTime,r.documentKey,Math.max(t.batchId,e.largestBatchId))}}let $e=(()=>{class n{constructor(t,r){this.previousValue=t,r&&(r.sequenceNumberHandler=i=>this.ie(i),this.se=i=>r.writeSequenceNumber(i))}ie(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){const t=++this.previousValue;return this.se&&this.se(t),t}}return n.oe=-1,n})();function ci(n){return null==n}function li(n){return 0===n&&1/n==-1/0}function El(n){return"number"==typeof n&&Number.isInteger(n)&&!li(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}function Ne(n){let e="";for(let t=0;t<n.length;t++)e.length>0&&(e=vl(e)),e=Nm(n.get(t),e);return vl(e)}function Nm(n,e){let t=e;const r=n.length;for(let i=0;i<r;i++){const s=n.charAt(i);switch(s){case"\0":t+="\x01\x10";break;case"\x01":t+="\x01\x11";break;default:t+=s}}return t}function vl(n){return n+"\x01\x01"}function at(n){const e=n.length;if(b(e>=2),2===e)return b("\x01"===n.charAt(0)&&"\x01"===n.charAt(1)),K.emptyPath();const t=e-2,r=[];let i="";for(let s=0;s<e;){const o=n.indexOf("\x01",s);switch((o<0||o>t)&&D(),n.charAt(o+1)){case"\x01":const a=n.substring(s,o);let u;0===i.length?u=a:(i+=a,u=i,i=""),r.push(u);break;case"\x10":i+=n.substring(s,o),i+="\0";break;case"\x11":i+=n.substring(s,o+1);break;default:D()}s=o+2}return new K(r)}const Al=["userId","batchId"];function Ps(n,e){return[n,Ne(e)]}function wl(n,e,t){return[n,Ne(e),t]}const km={},Fm=["prefixPath","collectionGroup","readTime","documentId"],Mm=["prefixPath","collectionGroup","documentId"],Om=["collectionGroup","readTime","prefixPath","documentId"],Lm=["canonicalId","targetId"],Bm=["targetId","path"],qm=["path","targetId"],Um=["collectionId","parent"],Gm=["indexId","uid"],zm=["uid","sequenceNumber"],Km=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],jm=["indexId","uid","orderedDocumentKey"],$m=["userId","collectionPath","documentId"],Qm=["userId","collectionPath","largestBatchId"],Wm=["userId","collectionGroup","largestBatchId"],Rl=["mutationQueues","mutations","documentMutations","remoteDocuments","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries"],Hm=[...Rl,"documentOverlays"],Pl=["mutationQueues","mutations","documentMutations","remoteDocumentsV14","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries","documentOverlays"],Sl=Pl,Vl=[...Sl,"indexConfiguration","indexState","indexEntries"],Zm=Vl;class Jo extends yl{constructor(e,t){super(),this._e=e,this.currentSequenceNumber=t}}function Ae(n,e){const t=S(n);return ot.F(t._e,e)}function xl(n){let e=0;for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function Ot(n,e){for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function Cl(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}class ee{constructor(e,t){this.comparator=e,this.root=t||Ce.EMPTY}insert(e,t){return new ee(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,Ce.BLACK,null,null))}remove(e){return new ee(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Ce.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const r=this.comparator(e,t.key);if(0===r)return t.value;r<0?t=t.left:r>0&&(t=t.right)}return null}indexOf(e){let t=0,r=this.root;for(;!r.isEmpty();){const i=this.comparator(e,r.key);if(0===i)return t+r.left.size;i<0?r=r.left:(t+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,r)=>(e(t,r),!1))}toString(){const e=[];return this.inorderTraversal((t,r)=>(e.push(`${t}:${r}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new Ss(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new Ss(this.root,e,this.comparator,!1)}getReverseIterator(){return new Ss(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new Ss(this.root,e,this.comparator,!0)}}class Ss{constructor(e,t,r,i){this.isReverse=i,this.nodeStack=[];let s=1;for(;!e.isEmpty();)if(s=t?r(e.key,t):1,t&&i&&(s*=-1),s<0)e=this.isReverse?e.left:e.right;else{if(0===s){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class Ce{constructor(e,t,r,i,s){this.key=e,this.value=t,this.color=r??Ce.RED,this.left=i??Ce.EMPTY,this.right=s??Ce.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,r,i,s){return new Ce(e??this.key,t??this.value,r??this.color,i??this.left,s??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,r){let i=this;const s=r(e,i.key);return i=s<0?i.copy(null,null,null,i.left.insert(e,t,r),null):0===s?i.copy(null,t,null,null,null):i.copy(null,null,null,null,i.right.insert(e,t,r)),i.fixUp()}removeMin(){if(this.left.isEmpty())return Ce.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let r,i=this;if(t(e,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(e,t),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),0===t(e,i.key)){if(i.right.isEmpty())return Ce.EMPTY;r=i.right.min(),i=i.copy(r.key,r.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(e,t))}return i.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,Ce.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,Ce.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw D();const e=this.left.check();if(e!==this.right.check())throw D();return e+(this.isRed()?0:1)}}Ce.EMPTY=null,Ce.RED=!0,Ce.BLACK=!1,Ce.EMPTY=new class{constructor(){this.size=0}get key(){throw D()}get value(){throw D()}get color(){throw D()}get left(){throw D()}get right(){throw D()}copy(e,t,r,i,s){return this}insert(e,t,r){return new Ce(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class Y{constructor(e){this.comparator=e,this.data=new ee(this.comparator)}has(e){return null!==this.data.get(e)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,r)=>(e(t),!1))}forEachInRange(e,t){const r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){const i=r.getNext();if(this.comparator(i.key,e[1])>=0)return;t(i.key)}}forEachWhile(e,t){let r;for(r=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new Dl(this.data.getIterator())}getIteratorFrom(e){return new Dl(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(r=>{t=t.add(r)}),t}isEqual(e){if(!(e instanceof Y)||this.size!==e.size)return!1;const t=this.data.getIterator(),r=e.data.getIterator();for(;t.hasNext();){const i=t.getNext().key,s=r.getNext().key;if(0!==this.comparator(i,s))return!1}return!0}toArray(){const e=[];return this.forEach(t=>{e.push(t)}),e}toString(){const e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){const t=new Y(this.comparator);return t.data=e,t}}class Dl{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}function Jn(n){return n.hasNext()?n.getNext():void 0}class Ge{constructor(e){this.fields=e,e.sort(re.comparator)}static empty(){return new Ge([])}unionWith(e){let t=new Y(re.comparator);for(const r of this.fields)t=t.add(r);for(const r of e)t=t.add(r);return new Ge(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return Wn(this.fields,e.fields,(t,r)=>t.isEqual(r))}}class bl extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}function Jm(){return typeof atob<"u"}class Ie{constructor(e){this.binaryString=e}static fromBase64String(e){const t=function(i){try{return atob(i)}catch(s){throw typeof DOMException<"u"&&s instanceof DOMException?new bl("Invalid base64 string: "+s):s}}(e);return new Ie(t)}static fromUint8Array(e){const t=function(i){let s="";for(let o=0;o<i.length;++o)s+=String.fromCharCode(i[o]);return s}(e);return new Ie(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return btoa(this.binaryString)}toUint8Array(){return function(t){const r=new Uint8Array(t.length);for(let i=0;i<t.length;i++)r[i]=t.charCodeAt(i);return r}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return O(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}Ie.EMPTY_BYTE_STRING=new Ie("");const Ym=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Tt(n){if(b(!!n),"string"==typeof n){let e=0;const t=Ym.exec(n);if(b(!!t),t[1]){let i=t[1];i=(i+"000000000").substr(0,9),e=Number(i)}const r=new Date(n);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:ue(n.seconds),nanos:ue(n.nanos)}}function ue(n){return"number"==typeof n?n:"string"==typeof n?Number(n):0}function Et(n){return"string"==typeof n?Ie.fromBase64String(n):Ie.fromUint8Array(n)}function Vs(n){var e,t;return"server_timestamp"===(null===(t=((null===(e=n?.mapValue)||void 0===e?void 0:e.fields)||{}).__type__)||void 0===t?void 0:t.stringValue)}function xs(n){const e=n.mapValue.fields.__previous_value__;return Vs(e)?xs(e):e}function hi(n){const e=Tt(n.mapValue.fields.__local_write_time__.timestampValue);return new se(e.seconds,e.nanos)}class Xm{constructor(e,t,r,i,s,o,a,u,c){this.databaseId=e,this.appId=t,this.persistenceKey=r,this.host=i,this.ssl=s,this.forceLongPolling=o,this.autoDetectLongPolling=a,this.longPollingOptions=u,this.useFetchStreams=c}}class Lt{constructor(e,t){this.projectId=e,this.database=t||"(default)"}static empty(){return new Lt("","")}get isDefaultDatabase(){return"(default)"===this.database}isEqual(e){return e instanceof Lt&&e.projectId===this.projectId&&e.database===this.database}}const Bt={mapValue:{fields:{__type__:{stringValue:"__max__"}}}},Cs={nullValue:"NULL_VALUE"};function qt(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?Vs(n)?4:Ml(n)?9007199254740991:10:D()}function ut(n,e){if(n===e)return!0;const t=qt(n);if(t!==qt(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return hi(n).isEqual(hi(e));case 3:return function(i,s){if("string"==typeof i.timestampValue&&"string"==typeof s.timestampValue&&i.timestampValue.length===s.timestampValue.length)return i.timestampValue===s.timestampValue;const o=Tt(i.timestampValue),a=Tt(s.timestampValue);return o.seconds===a.seconds&&o.nanos===a.nanos}(n,e);case 5:return n.stringValue===e.stringValue;case 6:return s=e,Et(n.bytesValue).isEqual(Et(s.bytesValue));case 7:return n.referenceValue===e.referenceValue;case 8:return function(i,s){return ue(i.geoPointValue.latitude)===ue(s.geoPointValue.latitude)&&ue(i.geoPointValue.longitude)===ue(s.geoPointValue.longitude)}(n,e);case 2:return function(i,s){if("integerValue"in i&&"integerValue"in s)return ue(i.integerValue)===ue(s.integerValue);if("doubleValue"in i&&"doubleValue"in s){const o=ue(i.doubleValue),a=ue(s.doubleValue);return o===a?li(o)===li(a):isNaN(o)&&isNaN(a)}return!1}(n,e);case 9:return Wn(n.arrayValue.values||[],e.arrayValue.values||[],ut);case 10:return function(i,s){const o=i.mapValue.fields||{},a=s.mapValue.fields||{};if(xl(o)!==xl(a))return!1;for(const u in o)if(o.hasOwnProperty(u)&&(void 0===a[u]||!ut(o[u],a[u])))return!1;return!0}(n,e);default:return D()}var s}function di(n,e){return void 0!==(n.values||[]).find(t=>ut(t,e))}function Ut(n,e){if(n===e)return 0;const t=qt(n),r=qt(e);if(t!==r)return O(t,r);switch(t){case 0:case 9007199254740991:return 0;case 1:return O(n.booleanValue,e.booleanValue);case 2:return function(s,o){const a=ue(s.integerValue||s.doubleValue),u=ue(o.integerValue||o.doubleValue);return a<u?-1:a>u?1:a===u?0:isNaN(a)?isNaN(u)?0:-1:1}(n,e);case 3:return Nl(n.timestampValue,e.timestampValue);case 4:return Nl(hi(n),hi(e));case 5:return O(n.stringValue,e.stringValue);case 6:return function(s,o){const a=Et(s),u=Et(o);return a.compareTo(u)}(n.bytesValue,e.bytesValue);case 7:return function(s,o){const a=s.split("/"),u=o.split("/");for(let c=0;c<a.length&&c<u.length;c++){const l=O(a[c],u[c]);if(0!==l)return l}return O(a.length,u.length)}(n.referenceValue,e.referenceValue);case 8:return function(s,o){const a=O(ue(s.latitude),ue(o.latitude));return 0!==a?a:O(ue(s.longitude),ue(o.longitude))}(n.geoPointValue,e.geoPointValue);case 9:return function(s,o){const a=s.values||[],u=o.values||[];for(let c=0;c<a.length&&c<u.length;++c){const l=Ut(a[c],u[c]);if(l)return l}return O(a.length,u.length)}(n.arrayValue,e.arrayValue);case 10:return function(s,o){if(s===Bt.mapValue&&o===Bt.mapValue)return 0;if(s===Bt.mapValue)return 1;if(o===Bt.mapValue)return-1;const a=s.fields||{},u=Object.keys(a),c=o.fields||{},l=Object.keys(c);u.sort(),l.sort();for(let d=0;d<u.length&&d<l.length;++d){const m=O(u[d],l[d]);if(0!==m)return m;const p=Ut(a[u[d]],c[l[d]]);if(0!==p)return p}return O(u.length,l.length)}(n.mapValue,e.mapValue);default:throw D()}}function Nl(n,e){if("string"==typeof n&&"string"==typeof e&&n.length===e.length)return O(n,e);const t=Tt(n),r=Tt(e),i=O(t.seconds,r.seconds);return 0!==i?i:O(t.nanos,r.nanos)}function Yn(n){return Yo(n)}function Yo(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?function(t){const r=Tt(t);return`time(${r.seconds},${r.nanos})`}(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?Et(n.bytesValue).toBase64():"referenceValue"in n?C.fromName(n.referenceValue).toString():"geoPointValue"in n?function(t){return`geo(${t.latitude},${t.longitude})`}(n.geoPointValue):"arrayValue"in n?function(t){let r="[",i=!0;for(const s of t.values||[])i?i=!1:r+=",",r+=Yo(s);return r+"]"}(n.arrayValue):"mapValue"in n?function(t){const r=Object.keys(t.fields||{}).sort();let i="{",s=!0;for(const o of r)s?s=!1:i+=",",i+=`${o}:${Yo(t.fields[o])}`;return i+"}"}(n.mapValue):D()}function cn(n,e){return{referenceValue:`projects/${n.projectId}/databases/${n.database}/documents/${e.path.canonicalString()}`}}function Xo(n){return!!n&&"integerValue"in n}function fi(n){return!!n&&"arrayValue"in n}function kl(n){return!!n&&"nullValue"in n}function Fl(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function bs(n){return!!n&&"mapValue"in n}function mi(n){if(n.geoPointValue)return{geoPointValue:Object.assign({},n.geoPointValue)};if(n.timestampValue&&"object"==typeof n.timestampValue)return{timestampValue:Object.assign({},n.timestampValue)};if(n.mapValue){const e={mapValue:{fields:{}}};return Ot(n.mapValue.fields,(t,r)=>e.mapValue.fields[t]=mi(r)),e}if(n.arrayValue){const e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=mi(n.arrayValue.values[t]);return e}return Object.assign({},n)}function Ml(n){return"__max__"===(((n.mapValue||{}).fields||{}).__type__||{}).stringValue}function eg(n){return"nullValue"in n?Cs:"booleanValue"in n?{booleanValue:!1}:"integerValue"in n||"doubleValue"in n?{doubleValue:NaN}:"timestampValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in n?{stringValue:""}:"bytesValue"in n?{bytesValue:""}:"referenceValue"in n?cn(Lt.empty(),C.empty()):"geoPointValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in n?{arrayValue:{}}:"mapValue"in n?{mapValue:{}}:D()}function tg(n){return"nullValue"in n?{booleanValue:!1}:"booleanValue"in n?{doubleValue:NaN}:"integerValue"in n||"doubleValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in n?{stringValue:""}:"stringValue"in n?{bytesValue:""}:"bytesValue"in n?cn(Lt.empty(),C.empty()):"referenceValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in n?{arrayValue:{}}:"arrayValue"in n?{mapValue:{}}:"mapValue"in n?Bt:D()}function Ol(n,e){const t=Ut(n.value,e.value);return 0!==t?t:n.inclusive&&!e.inclusive?-1:!n.inclusive&&e.inclusive?1:0}function Ll(n,e){const t=Ut(n.value,e.value);return 0!==t?t:n.inclusive&&!e.inclusive?1:!n.inclusive&&e.inclusive?-1:0}class De{constructor(e){this.value=e}static empty(){return new De({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let r=0;r<e.length-1;++r)if(t=(t.mapValue.fields||{})[e.get(r)],!bs(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=mi(t)}setAll(e){let t=re.emptyPath(),r={},i=[];e.forEach((o,a)=>{if(!t.isImmediateParentOf(a)){const u=this.getFieldsMap(t);this.applyChanges(u,r,i),r={},i=[],t=a.popLast()}o?r[a.lastSegment()]=mi(o):i.push(a.lastSegment())});const s=this.getFieldsMap(t);this.applyChanges(s,r,i)}delete(e){const t=this.field(e.popLast());bs(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return ut(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let r=0;r<e.length;++r){let i=t.mapValue.fields[e.get(r)];bs(i)&&i.mapValue.fields||(i={mapValue:{fields:{}}},t.mapValue.fields[e.get(r)]=i),t=i}return t.mapValue.fields}applyChanges(e,t,r){Ot(t,(i,s)=>e[i]=s);for(const i of r)delete e[i]}clone(){return new De(mi(this.value))}}function Bl(n){const e=[];return Ot(n.fields,(t,r)=>{const i=new re([t]);if(bs(r)){const s=Bl(r.mapValue).fields;if(0===s.length)e.push(i);else for(const o of s)e.push(i.child(o))}else e.push(i)}),new Ge(e)}class ie{constructor(e,t,r,i,s,o,a){this.key=e,this.documentType=t,this.version=r,this.readTime=i,this.createTime=s,this.data=o,this.documentState=a}static newInvalidDocument(e){return new ie(e,0,N.min(),N.min(),N.min(),De.empty(),0)}static newFoundDocument(e,t,r,i){return new ie(e,1,t,N.min(),r,i,0)}static newNoDocument(e,t){return new ie(e,2,t,N.min(),N.min(),De.empty(),0)}static newUnknownDocument(e,t){return new ie(e,3,t,N.min(),N.min(),De.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(N.min())||2!==this.documentType&&0!==this.documentType||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=De.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=De.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=N.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(e){return e instanceof ie&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new ie(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class Gt{constructor(e,t){this.position=e,this.inclusive=t}}function ql(n,e,t){let r=0;for(let i=0;i<n.position.length;i++){const s=e[i],o=n.position[i];if(r=s.field.isKeyField()?C.comparator(C.fromName(o.referenceValue),t.key):Ut(o,t.data.field(s.field)),"desc"===s.dir&&(r*=-1),0!==r)break}return r}function Ul(n,e){if(null===n)return null===e;if(null===e||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++)if(!ut(n.position[t],e.position[t]))return!1;return!0}class gi{constructor(e,t="asc"){this.field=e,this.dir=t}}function ng(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}class Gl{}class j extends Gl{constructor(e,t,r){super(),this.field=e,this.op=t,this.value=r}static create(e,t,r){return e.isKeyField()?"in"===t||"not-in"===t?this.createKeyFieldInFilter(e,t,r):new rg(e,t,r):"array-contains"===t?new og(e,r):"in"===t?new Wl(e,r):"not-in"===t?new ag(e,r):"array-contains-any"===t?new ug(e,r):new j(e,t,r)}static createKeyFieldInFilter(e,t,r){return"in"===t?new ig(e,r):new sg(e,r)}matches(e){const t=e.data.field(this.field);return"!="===this.op?null!==t&&this.matchesComparison(Ut(t,this.value)):null!==t&&qt(this.value)===qt(t)&&this.matchesComparison(Ut(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return e>0;case">=":return e>=0;default:return D()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class Z extends Gl{constructor(e,t){super(),this.filters=e,this.op=t,this.ae=null}static create(e,t){return new Z(e,t)}matches(e){return Xn(this)?void 0===this.filters.find(t=>!t.matches(e)):void 0!==this.filters.find(t=>t.matches(e))}getFlattenedFilters(){return null!==this.ae||(this.ae=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.ae}getFilters(){return Object.assign([],this.filters)}}function Xn(n){return"and"===n.op}function ea(n){return"or"===n.op}function ta(n){return zl(n)&&Xn(n)}function zl(n){for(const e of n.filters)if(e instanceof Z)return!1;return!0}function na(n){if(n instanceof j)return n.field.canonicalString()+n.op.toString()+Yn(n.value);if(ta(n))return n.filters.map(e=>na(e)).join(",");{const e=n.filters.map(t=>na(t)).join(",");return`${n.op}(${e})`}}function Kl(n,e){return n instanceof j?(r=n,(i=e)instanceof j&&r.op===i.op&&r.field.isEqual(i.field)&&ut(r.value,i.value)):n instanceof Z?function(r,i){return i instanceof Z&&r.op===i.op&&r.filters.length===i.filters.length&&r.filters.reduce((s,o,a)=>s&&Kl(o,i.filters[a]),!0)}(n,e):void D();var r,i}function jl(n,e){const t=n.filters.concat(e);return Z.create(t,n.op)}function $l(n){return n instanceof j?`${(t=n).field.canonicalString()} ${t.op} ${Yn(t.value)}`:n instanceof Z?function(t){return t.op.toString()+" {"+t.getFilters().map($l).join(" ,")+"}"}(n):"Filter";var t}class rg extends j{constructor(e,t,r){super(e,t,r),this.key=C.fromName(r.referenceValue)}matches(e){const t=C.comparator(e.key,this.key);return this.matchesComparison(t)}}class ig extends j{constructor(e,t){super(e,"in",t),this.keys=Ql(0,t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class sg extends j{constructor(e,t){super(e,"not-in",t),this.keys=Ql(0,t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function Ql(n,e){var t;return((null===(t=e.arrayValue)||void 0===t?void 0:t.values)||[]).map(r=>C.fromName(r.referenceValue))}class og extends j{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return fi(t)&&di(t.arrayValue,this.value)}}class Wl extends j{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return null!==t&&di(this.value.arrayValue,t)}}class ag extends j{constructor(e,t){super(e,"not-in",t)}matches(e){if(di(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return null!==t&&!di(this.value.arrayValue,t)}}class ug extends j{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!fi(t)||!t.arrayValue.values)&&t.arrayValue.values.some(r=>di(this.value.arrayValue,r))}}class cg{constructor(e,t=null,r=[],i=[],s=null,o=null,a=null){this.path=e,this.collectionGroup=t,this.orderBy=r,this.filters=i,this.limit=s,this.startAt=o,this.endAt=a,this.ue=null}}function ra(n,e=null,t=[],r=[],i=null,s=null,o=null){return new cg(n,e,t,r,i,s,o)}function ln(n){const e=S(n);if(null===e.ue){let t=e.path.canonicalString();null!==e.collectionGroup&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(r=>na(r)).join(","),t+="|ob:",t+=e.orderBy.map(r=>{return(s=r).field.canonicalString()+s.dir;var s}).join(","),ci(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(r=>Yn(r)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(r=>Yn(r)).join(",")),e.ue=t}return e.ue}function pi(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<n.orderBy.length;t++)if(!ng(n.orderBy[t],e.orderBy[t]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let t=0;t<n.filters.length;t++)if(!Kl(n.filters[t],e.filters[t]))return!1;return n.collectionGroup===e.collectionGroup&&!!n.path.isEqual(e.path)&&!!Ul(n.startAt,e.startAt)&&Ul(n.endAt,e.endAt)}function Ns(n){return C.isDocumentKey(n.path)&&null===n.collectionGroup&&0===n.filters.length}function ks(n,e){return n.filters.filter(t=>t instanceof j&&t.field.isEqual(e))}function Hl(n,e,t){let r=Cs,i=!0;for(const s of ks(n,e)){let o=Cs,a=!0;switch(s.op){case"<":case"<=":o=eg(s.value);break;case"==":case"in":case">=":o=s.value;break;case">":o=s.value,a=!1;break;case"!=":case"not-in":o=Cs}Ol({value:r,inclusive:i},{value:o,inclusive:a})<0&&(r=o,i=a)}if(null!==t)for(let s=0;s<n.orderBy.length;++s)if(n.orderBy[s].field.isEqual(e)){const o=t.position[s];Ol({value:r,inclusive:i},{value:o,inclusive:t.inclusive})<0&&(r=o,i=t.inclusive);break}return{value:r,inclusive:i}}function Zl(n,e,t){let r=Bt,i=!0;for(const s of ks(n,e)){let o=Bt,a=!0;switch(s.op){case">=":case">":o=tg(s.value),a=!1;break;case"==":case"in":case"<=":o=s.value;break;case"<":o=s.value,a=!1;break;case"!=":case"not-in":o=Bt}Ll({value:r,inclusive:i},{value:o,inclusive:a})>0&&(r=o,i=a)}if(null!==t)for(let s=0;s<n.orderBy.length;++s)if(n.orderBy[s].field.isEqual(e)){const o=t.position[s];Ll({value:r,inclusive:i},{value:o,inclusive:t.inclusive})>0&&(r=o,i=t.inclusive);break}return{value:r,inclusive:i}}class vt{constructor(e,t=null,r=[],i=[],s=null,o="F",a=null,u=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=r,this.filters=i,this.limit=s,this.limitType=o,this.startAt=a,this.endAt=u,this.ce=null,this.le=null,this.he=null}}function Jl(n,e,t,r,i,s,o,a){return new vt(n,e,t,r,i,s,o,a)}function er(n){return new vt(n)}function Yl(n){return 0===n.filters.length&&null===n.limit&&null==n.startAt&&null==n.endAt&&(0===n.explicitOrderBy.length||1===n.explicitOrderBy.length&&n.explicitOrderBy[0].field.isKeyField())}function ia(n){return null!==n.collectionGroup}function tr(n){const e=S(n);if(null===e.ce){e.ce=[];const t=new Set;for(const s of e.explicitOrderBy)e.ce.push(s),t.add(s.field.canonicalString());const r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(o){let a=new Y(re.comparator);return o.filters.forEach(u=>{u.getFlattenedFilters().forEach(c=>{c.isInequality()&&(a=a.add(c.field))})}),a})(e).forEach(s=>{t.has(s.canonicalString())||s.isKeyField()||e.ce.push(new gi(s,r))}),t.has(re.keyField().canonicalString())||e.ce.push(new gi(re.keyField(),r))}return e.ce}function Le(n){const e=S(n);return e.le||(e.le=function Xl(n,e){if("F"===n.limitType)return ra(n.path,n.collectionGroup,e,n.filters,n.limit,n.startAt,n.endAt);{e=e.map(i=>new gi(i.field,"desc"===i.dir?"asc":"desc"));const t=n.endAt?new Gt(n.endAt.position,n.endAt.inclusive):null,r=n.startAt?new Gt(n.startAt.position,n.startAt.inclusive):null;return ra(n.path,n.collectionGroup,e,n.filters,n.limit,t,r)}}(e,tr(n))),e.le}function sa(n,e){const t=n.filters.concat([e]);return new vt(n.path,n.collectionGroup,n.explicitOrderBy.slice(),t,n.limit,n.limitType,n.startAt,n.endAt)}function Fs(n,e,t){return new vt(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function _i(n,e){return pi(Le(n),Le(e))&&n.limitType===e.limitType}function eh(n){return`${ln(Le(n))}|lt:${n.limitType}`}function nr(n){return`Query(target=${function(t){let r=t.path.canonicalString();return null!==t.collectionGroup&&(r+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(r+=`, filters: [${t.filters.map(i=>$l(i)).join(", ")}]`),ci(t.limit)||(r+=", limit: "+t.limit),t.orderBy.length>0&&(r+=`, orderBy: [${t.orderBy.map(i=>{return`${(o=i).field.canonicalString()} (${o.dir})`;var o}).join(", ")}]`),t.startAt&&(r+=", startAt: ",r+=t.startAt.inclusive?"b:":"a:",r+=t.startAt.position.map(i=>Yn(i)).join(",")),t.endAt&&(r+=", endAt: ",r+=t.endAt.inclusive?"a:":"b:",r+=t.endAt.position.map(i=>Yn(i)).join(",")),`Target(${r})`}(Le(n))}; limitType=${n.limitType})`}function yi(n,e){return e.isFoundDocument()&&function(r,i){const s=i.key.path;return null!==r.collectionGroup?i.key.hasCollectionId(r.collectionGroup)&&r.path.isPrefixOf(s):C.isDocumentKey(r.path)?r.path.isEqual(s):r.path.isImmediateParentOf(s)}(n,e)&&function(r,i){for(const s of tr(r))if(!s.field.isKeyField()&&null===i.data.field(s.field))return!1;return!0}(n,e)&&function(r,i){for(const s of r.filters)if(!s.matches(i))return!1;return!0}(n,e)&&(i=e,!((r=n).startAt&&!function(o,a,u){const c=ql(o,a,u);return o.inclusive?c<=0:c<0}(r.startAt,tr(r),i)||r.endAt&&!function(o,a,u){const c=ql(o,a,u);return o.inclusive?c>=0:c>0}(r.endAt,tr(r),i)));var r,i}function th(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function nh(n){return(e,t)=>{let r=!1;for(const i of tr(n)){const s=lg(i,e,t);if(0!==s)return s;r=r||i.field.isKeyField()}return 0}}function lg(n,e,t){const r=n.field.isKeyField()?C.comparator(e.key,t.key):function(s,o,a){const u=o.data.field(s),c=a.data.field(s);return null!==u&&null!==c?Ut(u,c):D()}(n.field,e,t);switch(n.dir){case"asc":return r;case"desc":return-1*r;default:return D()}}class At{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),r=this.inner[t];if(void 0!==r)for(const[i,s]of r)if(this.equalsFn(i,e))return s}has(e){return void 0!==this.get(e)}set(e,t){const r=this.mapKeyFn(e),i=this.inner[r];if(void 0===i)return this.inner[r]=[[e,t]],void this.innerSize++;for(let s=0;s<i.length;s++)if(this.equalsFn(i[s][0],e))return void(i[s]=[e,t]);i.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),r=this.inner[t];if(void 0===r)return!1;for(let i=0;i<r.length;i++)if(this.equalsFn(r[i][0],e))return 1===r.length?delete this.inner[t]:r.splice(i,1),this.innerSize--,!0;return!1}forEach(e){Ot(this.inner,(t,r)=>{for(const[i,s]of r)e(i,s)})}isEmpty(){return Cl(this.inner)}size(){return this.innerSize}}const hg=new ee(C.comparator);function ze(){return hg}const rh=new ee(C.comparator);function Ii(...n){let e=rh;for(const t of n)e=e.insert(t.key,t);return e}function ih(n){let e=rh;return n.forEach((t,r)=>e=e.insert(t,r.overlayedDocument)),e}function ct(){return Ti()}function sh(){return Ti()}function Ti(){return new At(n=>n.toString(),(n,e)=>n.isEqual(e))}const dg=new ee(C.comparator),fg=new Y(C.comparator);function B(...n){let e=fg;for(const t of n)e=e.add(t);return e}const mg=new Y(O);function oa(){return mg}function oh(n,e){if(n.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:li(e)?"-0":e}}function ah(n){return{integerValue:""+n}}function uh(n,e){return El(e)?ah(e):oh(n,e)}class Ms{constructor(){this._=void 0}}function gg(n,e,t){return n instanceof rr?function(i,s){const o={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:i.seconds,nanos:i.nanoseconds}}}};return s&&Vs(s)&&(s=xs(s)),s&&(o.fields.__previous_value__=s),{mapValue:o}}(t,e):n instanceof hn?lh(n,e):n instanceof dn?hh(n,e):function(i,s){const o=ch(i,s),a=dh(o)+dh(i.Pe);return Xo(o)&&Xo(i.Pe)?ah(a):oh(i.serializer,a)}(n,e)}function pg(n,e,t){return n instanceof hn?lh(n,e):n instanceof dn?hh(n,e):t}function ch(n,e){return n instanceof ir?Xo(r=e)||(s=r)&&"doubleValue"in s?e:{integerValue:0}:null;var r,s}class rr extends Ms{}class hn extends Ms{constructor(e){super(),this.elements=e}}function lh(n,e){const t=fh(e);for(const r of n.elements)t.some(i=>ut(i,r))||t.push(r);return{arrayValue:{values:t}}}class dn extends Ms{constructor(e){super(),this.elements=e}}function hh(n,e){let t=fh(e);for(const r of n.elements)t=t.filter(i=>!ut(i,r));return{arrayValue:{values:t}}}class ir extends Ms{constructor(e,t){super(),this.serializer=e,this.Pe=t}}function dh(n){return ue(n.integerValue||n.doubleValue)}function fh(n){return fi(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}class Ei{constructor(e,t){this.field=e,this.transform=t}}class yg{constructor(e,t){this.version=e,this.transformResults=t}}class oe{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new oe}static exists(e){return new oe(void 0,e)}static updateTime(e){return new oe(e)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function Os(n,e){return void 0!==n.updateTime?e.isFoundDocument()&&e.version.isEqual(n.updateTime):void 0===n.exists||n.exists===e.isFoundDocument()}class Ls{}function mh(n,e){if(!n.hasLocalMutations||e&&0===e.fields.length)return null;if(null===e)return n.isNoDocument()?new or(n.key,oe.none()):new sr(n.key,n.data,oe.none());{const t=n.data,r=De.empty();let i=new Y(re.comparator);for(let s of e.fields)if(!i.has(s)){let o=t.field(s);null===o&&s.length>1&&(s=s.popLast(),o=t.field(s)),null===o?r.delete(s):r.set(s,o),i=i.add(s)}return new wt(n.key,r,new Ge(i.toArray()),oe.none())}}function Ig(n,e,t){n instanceof sr?function(i,s,o){const a=i.value.clone(),u=_h(i.fieldTransforms,s,o.transformResults);a.setAll(u),s.convertToFoundDocument(o.version,a).setHasCommittedMutations()}(n,e,t):n instanceof wt?function(i,s,o){if(!Os(i.precondition,s))return void s.convertToUnknownDocument(o.version);const a=_h(i.fieldTransforms,s,o.transformResults),u=s.data;u.setAll(ph(i)),u.setAll(a),s.convertToFoundDocument(o.version,u).setHasCommittedMutations()}(n,e,t):e.convertToNoDocument(t.version).setHasCommittedMutations()}function vi(n,e,t,r){return n instanceof sr?function(s,o,a,u){if(!Os(s.precondition,o))return a;const c=s.value.clone(),l=yh(s.fieldTransforms,u,o);return c.setAll(l),o.convertToFoundDocument(o.version,c).setHasLocalMutations(),null}(n,e,t,r):n instanceof wt?function(s,o,a,u){if(!Os(s.precondition,o))return a;const c=yh(s.fieldTransforms,u,o),l=o.data;return l.setAll(ph(s)),l.setAll(c),o.convertToFoundDocument(o.version,l).setHasLocalMutations(),null===a?null:a.unionWith(s.fieldMask.fields).unionWith(s.fieldTransforms.map(d=>d.field))}(n,e,t,r):(a=t,Os(n.precondition,o=e)?(o.convertToNoDocument(o.version).setHasLocalMutations(),null):a);var o,a}function Tg(n,e){let t=null;for(const r of n.fieldTransforms){const i=e.data.field(r.field),s=ch(r.transform,i||null);null!=s&&(null===t&&(t=De.empty()),t.set(r.field,s))}return t||null}function gh(n,e){return n.type===e.type&&!!n.key.isEqual(e.key)&&!!n.precondition.isEqual(e.precondition)&&(i=e.fieldTransforms,!!(void 0===(r=n.fieldTransforms)&&void 0===i||r&&i&&Wn(r,i,(s,o)=>function _g(n,e){return n.field.isEqual(e.field)&&(i=e.transform,(r=n.transform)instanceof hn&&i instanceof hn||r instanceof dn&&i instanceof dn?Wn(r.elements,i.elements,ut):r instanceof ir&&i instanceof ir?ut(r.Pe,i.Pe):r instanceof rr&&i instanceof rr);var r,i}(s,o))))&&(0===n.type?n.value.isEqual(e.value):1!==n.type||n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask));var r,i}class sr extends Ls{constructor(e,t,r,i=[]){super(),this.key=e,this.value=t,this.precondition=r,this.fieldTransforms=i,this.type=0}getFieldMask(){return null}}class wt extends Ls{constructor(e,t,r,i,s=[]){super(),this.key=e,this.data=t,this.fieldMask=r,this.precondition=i,this.fieldTransforms=s,this.type=1}getFieldMask(){return this.fieldMask}}function ph(n){const e=new Map;return n.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){const r=n.data.field(t);e.set(t,r)}}),e}function _h(n,e,t){const r=new Map;b(n.length===t.length);for(let i=0;i<t.length;i++){const s=n[i],o=s.transform,a=e.data.field(s.field);r.set(s.field,pg(o,a,t[i]))}return r}function yh(n,e,t){const r=new Map;for(const i of n){const s=i.transform,o=t.data.field(i.field);r.set(i.field,gg(s,o,e))}return r}class or extends Ls{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class aa extends Ls{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class ua{constructor(e,t,r,i){this.batchId=e,this.localWriteTime=t,this.baseMutations=r,this.mutations=i}applyToRemoteDocument(e,t){const r=t.mutationResults;for(let i=0;i<this.mutations.length;i++){const s=this.mutations[i];s.key.isEqual(e.key)&&Ig(s,e,r[i])}}applyToLocalView(e,t){for(const r of this.baseMutations)r.key.isEqual(e.key)&&(t=vi(r,e,t,this.localWriteTime));for(const r of this.mutations)r.key.isEqual(e.key)&&(t=vi(r,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const r=sh();return this.mutations.forEach(i=>{const s=e.get(i.key),o=s.overlayedDocument;let a=this.applyToLocalView(o,s.mutatedFields);a=t.has(i.key)?null:a;const u=mh(o,a);null!==u&&r.set(i.key,u),o.isValidDocument()||o.convertToNoDocument(N.min())}),r}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),B())}isEqual(e){return this.batchId===e.batchId&&Wn(this.mutations,e.mutations,(t,r)=>gh(t,r))&&Wn(this.baseMutations,e.baseMutations,(t,r)=>gh(t,r))}}class ca{constructor(e,t,r,i){this.batch=e,this.commitVersion=t,this.mutationResults=r,this.docVersions=i}static from(e,t,r){b(e.mutations.length===r.length);let i=dg;const s=e.mutations;for(let o=0;o<s.length;o++)i=i.insert(s[o].key,r[o].version);return new ca(e,t,r,i)}}class la{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return null!==e&&this.mutation===e.mutation}toString(){return`Overlay{\n      largestBatchId: ${this.largestBatchId},\n      mutation: ${this.mutation.toString()}\n    }`}}class vg{constructor(e,t){this.count=e,this.unchangedNames=t}}var fe,Q;function Ih(n){switch(n){default:return D();case _.CANCELLED:case _.UNKNOWN:case _.DEADLINE_EXCEEDED:case _.RESOURCE_EXHAUSTED:case _.INTERNAL:case _.UNAVAILABLE:case _.UNAUTHENTICATED:return!1;case _.INVALID_ARGUMENT:case _.NOT_FOUND:case _.ALREADY_EXISTS:case _.PERMISSION_DENIED:case _.FAILED_PRECONDITION:case _.ABORTED:case _.OUT_OF_RANGE:case _.UNIMPLEMENTED:case _.DATA_LOSS:return!0}}function Th(n){if(void 0===n)return he("GRPC error has no .code"),_.UNKNOWN;switch(n){case fe.OK:return _.OK;case fe.CANCELLED:return _.CANCELLED;case fe.UNKNOWN:return _.UNKNOWN;case fe.DEADLINE_EXCEEDED:return _.DEADLINE_EXCEEDED;case fe.RESOURCE_EXHAUSTED:return _.RESOURCE_EXHAUSTED;case fe.INTERNAL:return _.INTERNAL;case fe.UNAVAILABLE:return _.UNAVAILABLE;case fe.UNAUTHENTICATED:return _.UNAUTHENTICATED;case fe.INVALID_ARGUMENT:return _.INVALID_ARGUMENT;case fe.NOT_FOUND:return _.NOT_FOUND;case fe.ALREADY_EXISTS:return _.ALREADY_EXISTS;case fe.PERMISSION_DENIED:return _.PERMISSION_DENIED;case fe.FAILED_PRECONDITION:return _.FAILED_PRECONDITION;case fe.ABORTED:return _.ABORTED;case fe.OUT_OF_RANGE:return _.OUT_OF_RANGE;case fe.UNIMPLEMENTED:return _.UNIMPLEMENTED;case fe.DATA_LOSS:return _.DATA_LOSS;default:return D()}}(Q=fe||(fe={}))[Q.OK=0]="OK",Q[Q.CANCELLED=1]="CANCELLED",Q[Q.UNKNOWN=2]="UNKNOWN",Q[Q.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Q[Q.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Q[Q.NOT_FOUND=5]="NOT_FOUND",Q[Q.ALREADY_EXISTS=6]="ALREADY_EXISTS",Q[Q.PERMISSION_DENIED=7]="PERMISSION_DENIED",Q[Q.UNAUTHENTICATED=16]="UNAUTHENTICATED",Q[Q.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Q[Q.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Q[Q.ABORTED=10]="ABORTED",Q[Q.OUT_OF_RANGE=11]="OUT_OF_RANGE",Q[Q.UNIMPLEMENTED=12]="UNIMPLEMENTED",Q[Q.INTERNAL=13]="INTERNAL",Q[Q.UNAVAILABLE=14]="UNAVAILABLE",Q[Q.DATA_LOSS=15]="DATA_LOSS";function Eh(){return new TextEncoder}const Ag=new jn([4294967295,4294967295],0);function vh(n){const e=Eh().encode(n),t=new pm;return t.update(e),new Uint8Array(t.digest())}function Ah(n){const e=new DataView(n.buffer),t=e.getUint32(0,!0),r=e.getUint32(4,!0),i=e.getUint32(8,!0),s=e.getUint32(12,!0);return[new jn([t,r],0),new jn([i,s],0)]}class ha{constructor(e,t,r){if(this.bitmap=e,this.padding=t,this.hashCount=r,t<0||t>=8)throw new Ai(`Invalid padding: ${t}`);if(r<0)throw new Ai(`Invalid hash count: ${r}`);if(e.length>0&&0===this.hashCount)throw new Ai(`Invalid hash count: ${r}`);if(0===e.length&&0!==t)throw new Ai(`Invalid padding when bitmap length is 0: ${t}`);this.Ie=8*e.length-t,this.Te=jn.fromNumber(this.Ie)}Ee(e,t,r){let i=e.add(t.multiply(jn.fromNumber(r)));return 1===i.compare(Ag)&&(i=new jn([i.getBits(0),i.getBits(1)],0)),i.modulo(this.Te).toNumber()}de(e){return 0!=(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(0===this.Ie)return!1;const t=vh(e),[r,i]=Ah(t);for(let s=0;s<this.hashCount;s++){const o=this.Ee(r,i,s);if(!this.de(o))return!1}return!0}static create(e,t,r){const i=e%8==0?0:8-e%8,s=new Uint8Array(Math.ceil(e/8)),o=new ha(s,i,t);return r.forEach(a=>o.insert(a)),o}insert(e){if(0===this.Ie)return;const t=vh(e),[r,i]=Ah(t);for(let s=0;s<this.hashCount;s++){const o=this.Ee(r,i,s);this.Ae(o)}}Ae(e){const t=Math.floor(e/8);this.bitmap[t]|=1<<e%8}}class Ai extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class wi{constructor(e,t,r,i,s){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=r,this.documentUpdates=i,this.resolvedLimboDocuments=s}static createSynthesizedRemoteEventForCurrentChange(e,t,r){const i=new Map;return i.set(e,Ri.createSynthesizedTargetChangeForCurrentChange(e,t,r)),new wi(N.min(),i,new ee(O),ze(),B())}}class Ri{constructor(e,t,r,i,s){this.resumeToken=e,this.current=t,this.addedDocuments=r,this.modifiedDocuments=i,this.removedDocuments=s}static createSynthesizedTargetChangeForCurrentChange(e,t,r){return new Ri(r,t,B(),B(),B())}}class qs{constructor(e,t,r,i){this.Re=e,this.removedTargetIds=t,this.key=r,this.Ve=i}}class wh{constructor(e,t){this.targetId=e,this.me=t}}class Rh{constructor(e,t,r=Ie.EMPTY_BYTE_STRING,i=null){this.state=e,this.targetIds=t,this.resumeToken=r,this.cause=i}}class Ph{constructor(){this.fe=0,this.ge=Vh(),this.pe=Ie.EMPTY_BYTE_STRING,this.ye=!1,this.we=!0}get current(){return this.ye}get resumeToken(){return this.pe}get Se(){return 0!==this.fe}get be(){return this.we}De(e){e.approximateByteSize()>0&&(this.we=!0,this.pe=e)}Ce(){let e=B(),t=B(),r=B();return this.ge.forEach((i,s)=>{switch(s){case 0:e=e.add(i);break;case 2:t=t.add(i);break;case 1:r=r.add(i);break;default:D()}}),new Ri(this.pe,this.ye,e,t,r)}ve(){this.we=!1,this.ge=Vh()}Fe(e,t){this.we=!0,this.ge=this.ge.insert(e,t)}Me(e){this.we=!0,this.ge=this.ge.remove(e)}xe(){this.fe+=1}Oe(){this.fe-=1,b(this.fe>=0)}Ne(){this.we=!0,this.ye=!0}}class wg{constructor(e){this.Le=e,this.Be=new Map,this.ke=ze(),this.qe=Sh(),this.Qe=new ee(O)}Ke(e){for(const t of e.Re)e.Ve&&e.Ve.isFoundDocument()?this.$e(t,e.Ve):this.Ue(t,e.key,e.Ve);for(const t of e.removedTargetIds)this.Ue(t,e.key,e.Ve)}We(e){this.forEachTarget(e,t=>{const r=this.Ge(t);switch(e.state){case 0:this.ze(t)&&r.De(e.resumeToken);break;case 1:r.Oe(),r.Se||r.ve(),r.De(e.resumeToken);break;case 2:r.Oe(),r.Se||this.removeTarget(t);break;case 3:this.ze(t)&&(r.Ne(),r.De(e.resumeToken));break;case 4:this.ze(t)&&(this.je(t),r.De(e.resumeToken));break;default:D()}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.Be.forEach((r,i)=>{this.ze(i)&&t(i)})}He(e){const t=e.targetId,r=e.me.count,i=this.Je(t);if(i){const s=i.target;if(Ns(s))if(0===r){const o=new C(s.path);this.Ue(t,o,ie.newNoDocument(o,N.min()))}else b(1===r);else{const o=this.Ye(t);if(o!==r){const a=this.Ze(e),u=a?this.Xe(a,e,o):1;0!==u&&(this.je(t),this.Qe=this.Qe.insert(t,2===u?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch"))}}}}Ze(e){const t=e.me.unchangedNames;if(!t||!t.bits)return null;const{bits:{bitmap:r="",padding:i=0},hashCount:s=0}=t;let o,a;try{o=Et(r).toUint8Array()}catch(u){if(u instanceof bl)return Ue("Decoding the base64 bloom filter in existence filter failed ("+u.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw u}try{a=new ha(o,i,s)}catch(u){return Ue(u instanceof Ai?"BloomFilter error: ":"Applying bloom filter failed: ",u),null}return 0===a.Ie?null:a}Xe(e,t,r){return t.me.count===r-this.nt(e,t.targetId)?0:2}nt(e,t){const r=this.Le.getRemoteKeysForTarget(t);let i=0;return r.forEach(s=>{const o=this.Le.tt(),a=`projects/${o.projectId}/databases/${o.database}/documents/${s.path.canonicalString()}`;e.mightContain(a)||(this.Ue(t,s,null),i++)}),i}rt(e){const t=new Map;this.Be.forEach((s,o)=>{const a=this.Je(o);if(a){if(s.current&&Ns(a.target)){const u=new C(a.target.path);null!==this.ke.get(u)||this.it(o,u)||this.Ue(o,u,ie.newNoDocument(u,e))}s.be&&(t.set(o,s.Ce()),s.ve())}});let r=B();this.qe.forEach((s,o)=>{let a=!0;o.forEachWhile(u=>{const c=this.Je(u);return!c||"TargetPurposeLimboResolution"===c.purpose||(a=!1,!1)}),a&&(r=r.add(s))}),this.ke.forEach((s,o)=>o.setReadTime(e));const i=new wi(e,t,this.Qe,this.ke,r);return this.ke=ze(),this.qe=Sh(),this.Qe=new ee(O),i}$e(e,t){if(!this.ze(e))return;const r=this.it(e,t.key)?2:0;this.Ge(e).Fe(t.key,r),this.ke=this.ke.insert(t.key,t),this.qe=this.qe.insert(t.key,this.st(t.key).add(e))}Ue(e,t,r){if(!this.ze(e))return;const i=this.Ge(e);this.it(e,t)?i.Fe(t,1):i.Me(t),this.qe=this.qe.insert(t,this.st(t).delete(e)),r&&(this.ke=this.ke.insert(t,r))}removeTarget(e){this.Be.delete(e)}Ye(e){const t=this.Ge(e).Ce();return this.Le.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}xe(e){this.Ge(e).xe()}Ge(e){let t=this.Be.get(e);return t||(t=new Ph,this.Be.set(e,t)),t}st(e){let t=this.qe.get(e);return t||(t=new Y(O),this.qe=this.qe.insert(e,t)),t}ze(e){const t=null!==this.Je(e);return t||A("WatchChangeAggregator","Detected inactive target",e),t}Je(e){const t=this.Be.get(e);return t&&t.Se?null:this.Le.ot(e)}je(e){this.Be.set(e,new Ph),this.Le.getRemoteKeysForTarget(e).forEach(t=>{this.Ue(e,t,null)})}it(e,t){return this.Le.getRemoteKeysForTarget(e).has(t)}}function Sh(){return new ee(C.comparator)}function Vh(){return new ee(C.comparator)}const Rg={asc:"ASCENDING",desc:"DESCENDING"},Pg={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},Sg={and:"AND",or:"OR"};class Vg{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function da(n,e){return n.useProto3Json||ci(e)?e:{value:e}}function ar(n,e){return n.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function xh(n,e){return n.useProto3Json?e.toBase64():e.toUint8Array()}function xg(n,e){return ar(n,e.toTimestamp())}function de(n){return b(!!n),N.fromTimestamp(function(t){const r=Tt(t);return new se(r.seconds,r.nanos)}(n))}function fa(n,e){return ma(n,e).canonicalString()}function ma(n,e){const t=(i=n,new K(["projects",i.projectId,"databases",i.database])).child("documents");var i;return void 0===e?t:t.child(e)}function Ch(n){const e=K.fromString(n);return b(qh(e)),e}function Pi(n,e){return fa(n.databaseId,e.path)}function lt(n,e){const t=Ch(e);if(t.get(1)!==n.databaseId.projectId)throw new v(_.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new v(_.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new C(Nh(t))}function Dh(n,e){return fa(n.databaseId,e)}function bh(n){const e=Ch(n);return 4===e.length?K.emptyPath():Nh(e)}function ga(n){return new K(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function Nh(n){return b(n.length>4&&"documents"===n.get(4)),n.popFirst(5)}function kh(n,e,t){return{name:Pi(n,e),fields:t.value.mapValue.fields}}function Fh(n,e,t){const r=lt(n,e.name),i=de(e.updateTime),s=e.createTime?de(e.createTime):N.min(),o=new De({mapValue:{fields:e.fields}}),a=ie.newFoundDocument(r,i,s,o);return t&&a.setHasCommittedMutations(),t?a.setHasCommittedMutations():a}function Si(n,e){let t;if(e instanceof sr)t={update:kh(n,e.key,e.value)};else if(e instanceof or)t={delete:Pi(n,e.key)};else if(e instanceof wt)t={update:kh(n,e.key,e.data),updateMask:Og(e.fieldMask)};else{if(!(e instanceof aa))return D();t={verify:Pi(n,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(r=>function(s,o){const a=o.transform;if(a instanceof rr)return{fieldPath:o.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(a instanceof hn)return{fieldPath:o.field.canonicalString(),appendMissingElements:{values:a.elements}};if(a instanceof dn)return{fieldPath:o.field.canonicalString(),removeAllFromArray:{values:a.elements}};if(a instanceof ir)return{fieldPath:o.field.canonicalString(),increment:a.Pe};throw D()}(0,r))),e.precondition.isNone||(t.currentDocument=void 0!==(s=e.precondition).updateTime?{updateTime:xg(n,s.updateTime)}:void 0!==s.exists?{exists:s.exists}:D()),t;var s}function pa(n,e){const t=e.currentDocument?void 0!==(s=e.currentDocument).updateTime?oe.updateTime(de(s.updateTime)):void 0!==s.exists?oe.exists(s.exists):oe.none():oe.none(),r=e.updateTransforms?e.updateTransforms.map(i=>function(o,a){let u=null;"setToServerValue"in a?(b("REQUEST_TIME"===a.setToServerValue),u=new rr):"appendMissingElements"in a?u=new hn(a.appendMissingElements.values||[]):"removeAllFromArray"in a?u=new dn(a.removeAllFromArray.values||[]):"increment"in a?u=new ir(o,a.increment):D();const c=re.fromServerFormat(a.fieldPath);return new Ei(c,u)}(n,i)):[];var s;if(e.update){const i=lt(n,e.update.name),s=new De({mapValue:{fields:e.update.fields}});if(e.updateMask){const o=new Ge((e.updateMask.fieldPaths||[]).map(l=>re.fromServerFormat(l)));return new wt(i,s,o,t,r)}return new sr(i,s,t,r)}if(e.delete){const i=lt(n,e.delete);return new or(i,t)}if(e.verify){const i=lt(n,e.verify);return new aa(i,t)}return D()}function Mh(n,e){return{documents:[Dh(n,e.path)]}}function _a(n,e){const t={structuredQuery:{}},r=e.path;let i;null!==e.collectionGroup?(i=r,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(i=r.popLast(),t.structuredQuery.from=[{collectionId:r.lastSegment()}]),t.parent=Dh(n,i);const s=function(c){if(0!==c.length)return Bh(Z.create(c,"and"))}(e.filters);s&&(t.structuredQuery.where=s);const o=function(c){if(0!==c.length)return c.map(l=>{return{field:zt((m=l).field),direction:kg(m.dir)};var m})}(e.orderBy);o&&(t.structuredQuery.orderBy=o);const a=da(n,e.limit);return null!==a&&(t.structuredQuery.limit=a),e.startAt&&(t.structuredQuery.startAt={before:(c=e.startAt).inclusive,values:c.position}),e.endAt&&(t.structuredQuery.endAt=function(c){return{before:!c.inclusive,values:c.position}}(e.endAt)),{_t:t,parent:i};var c}function Oh(n){let e=bh(n.parent);const t=n.structuredQuery,r=t.from?t.from.length:0;let i=null;if(r>0){b(1===r);const l=t.from[0];l.allDescendants?i=l.collectionId:e=e.child(l.collectionId)}let s=[];t.where&&(s=function(d){const m=Lh(d);return m instanceof Z&&ta(m)?m.getFilters():[m]}(t.where));let o=[];t.orderBy&&(o=t.orderBy.map(m=>{return new gi(ur((w=m).field),function(R){switch(R){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(w.direction));var w}));let a=null;t.limit&&(a=function(d){let m;return m="object"==typeof d?d.value:d,ci(m)?null:m}(t.limit));let u=null;var d;t.startAt&&(u=new Gt((d=t.startAt).values||[],!!d.before));let c=null;return t.endAt&&(c=function(d){return new Gt(d.values||[],!d.before)}(t.endAt)),Jl(e,i,o,s,a,"F",u,c)}function Lh(n){return void 0!==n.unaryFilter?function(t){switch(t.unaryFilter.op){case"IS_NAN":const r=ur(t.unaryFilter.field);return j.create(r,"==",{doubleValue:NaN});case"IS_NULL":const i=ur(t.unaryFilter.field);return j.create(i,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const s=ur(t.unaryFilter.field);return j.create(s,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const o=ur(t.unaryFilter.field);return j.create(o,"!=",{nullValue:"NULL_VALUE"});default:return D()}}(n):void 0!==n.fieldFilter?j.create(ur((t=n).fieldFilter.field),function(i){switch(i){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return D()}}(t.fieldFilter.op),t.fieldFilter.value):void 0!==n.compositeFilter?function(t){return Z.create(t.compositeFilter.filters.map(r=>Lh(r)),function(i){switch(i){case"AND":return"and";case"OR":return"or";default:return D()}}(t.compositeFilter.op))}(n):D();var t}function kg(n){return Rg[n]}function Fg(n){return Pg[n]}function Mg(n){return Sg[n]}function zt(n){return{fieldPath:n.canonicalString()}}function ur(n){return re.fromServerFormat(n.fieldPath)}function Bh(n){return n instanceof j?function(t){if("=="===t.op){if(Fl(t.value))return{unaryFilter:{field:zt(t.field),op:"IS_NAN"}};if(kl(t.value))return{unaryFilter:{field:zt(t.field),op:"IS_NULL"}}}else if("!="===t.op){if(Fl(t.value))return{unaryFilter:{field:zt(t.field),op:"IS_NOT_NAN"}};if(kl(t.value))return{unaryFilter:{field:zt(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:zt(t.field),op:Fg(t.op),value:t.value}}}(n):n instanceof Z?function(t){const r=t.getFilters().map(i=>Bh(i));return 1===r.length?r[0]:{compositeFilter:{op:Mg(t.op),filters:r}}}(n):D()}function Og(n){const e=[];return n.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function qh(n){return n.length>=4&&"projects"===n.get(0)&&"databases"===n.get(2)}class Rt{constructor(e,t,r,i,s=N.min(),o=N.min(),a=Ie.EMPTY_BYTE_STRING,u=null){this.target=e,this.targetId=t,this.purpose=r,this.sequenceNumber=i,this.snapshotVersion=s,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=a,this.expectedCount=u}withSequenceNumber(e){return new Rt(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new Rt(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new Rt(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new Rt(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}class Uh{constructor(e){this.ut=e}}function Gh(n,e){const t=e.key,r={prefixPath:t.getCollectionPath().popLast().toArray(),collectionGroup:t.collectionGroup,documentId:t.path.lastSegment(),readTime:Us(e.readTime),hasCommittedMutations:e.hasCommittedMutations};if(e.isFoundDocument())r.document={name:Pi(s=n.ut,(o=e).key),fields:o.data.value.mapValue.fields,updateTime:ar(s,o.version.toTimestamp()),createTime:ar(s,o.createTime.toTimestamp())};else if(e.isNoDocument())r.noDocument={path:t.path.toArray(),readTime:fn(e.version)};else{if(!e.isUnknownDocument())return D();r.unknownDocument={path:t.path.toArray(),version:fn(e.version)}}var s,o;return r}function Us(n){const e=n.toTimestamp();return[e.seconds,e.nanoseconds]}function fn(n){const e=n.toTimestamp();return{seconds:e.seconds,nanoseconds:e.nanoseconds}}function mn(n){const e=new se(n.seconds,n.nanoseconds);return N.fromTimestamp(e)}function gn(n,e){const t=(e.baseMutations||[]).map(s=>pa(n.ut,s));for(let s=0;s<e.mutations.length-1;++s)s+1<e.mutations.length&&void 0!==e.mutations[s+1].transform&&(e.mutations[s].updateTransforms=e.mutations[s+1].transform.fieldTransforms,e.mutations.splice(s+1,1),++s);const r=e.mutations.map(s=>pa(n.ut,s)),i=se.fromMillis(e.localWriteTimeMs);return new ua(e.batchId,i,t,r)}function Vi(n){const e=mn(n.readTime),t=void 0!==n.lastLimboFreeSnapshotVersion?mn(n.lastLimboFreeSnapshotVersion):N.min();let r;return r=void 0!==n.query.documents?(b(1===(s=n.query).documents.length),Le(er(bh(s.documents[0])))):function(s){return Le(Oh(s))}(n.query),new Rt(r,n.targetId,"TargetPurposeListen",n.lastListenSequenceNumber,e,t,Ie.fromBase64String(n.resumeToken));var s}function zh(n,e){const t=fn(e.snapshotVersion),r=fn(e.lastLimboFreeSnapshotVersion);let i;i=Ns(e.target)?Mh(n.ut,e.target):_a(n.ut,e.target)._t;const s=e.resumeToken.toBase64();return{targetId:e.targetId,canonicalId:ln(e.target),readTime:t,resumeToken:s,lastListenSequenceNumber:e.sequenceNumber,lastLimboFreeSnapshotVersion:r,query:i}}function ya(n){const e=Oh({parent:n.parent,structuredQuery:n.structuredQuery});return"LAST"===n.limitType?Fs(e,e.limit,"L"):e}function Ia(n,e){return new la(e.largestBatchId,pa(n.ut,e.overlayMutation))}function Kh(n,e){const t=e.path.lastSegment();return[n,Ne(e.path.popLast()),t]}function jh(n,e,t,r){return{indexId:n,uid:e,sequenceNumber:t,readTime:fn(r.readTime),documentKey:Ne(r.documentKey.path),largestBatchId:r.largestBatchId}}class Bg{getBundleMetadata(e,t){return $h(e).get(t).next(r=>{if(r)return{id:(s=r).bundleId,createTime:mn(s.createTime),version:s.version};var s})}saveBundleMetadata(e,t){return $h(e).put({bundleId:(i=t).id,createTime:fn(de(i.createTime)),version:i.version});var i}getNamedQuery(e,t){return Qh(e).get(t).next(r=>{if(r)return{name:(s=r).name,query:ya(s.bundledQuery),readTime:mn(s.readTime)};var s})}saveNamedQuery(e,t){return Qh(e).put({name:(i=t).name,readTime:fn(de(i.readTime)),bundledQuery:i.bundledQuery});var i}}function $h(n){return Ae(n,"bundles")}function Qh(n){return Ae(n,"namedQueries")}class Gs{constructor(e,t){this.serializer=e,this.userId=t}static ct(e,t){return new Gs(e,t.uid||"")}getOverlay(e,t){return xi(e).get(Kh(this.userId,t)).next(r=>r?Ia(this.serializer,r):null)}getOverlays(e,t){const r=ct();return g.forEach(t,i=>this.getOverlay(e,i).next(s=>{null!==s&&r.set(i,s)})).next(()=>r)}saveOverlays(e,t,r){const i=[];return r.forEach((s,o)=>{const a=new la(t,o);i.push(this.lt(e,a))}),g.waitFor(i)}removeOverlaysForBatchId(e,t,r){const i=new Set;t.forEach(o=>i.add(Ne(o.getCollectionPath())));const s=[];return i.forEach(o=>{const a=IDBKeyRange.bound([this.userId,o,r],[this.userId,o,r+1],!1,!0);s.push(xi(e).j("collectionPathOverlayIndex",a))}),g.waitFor(s)}getOverlaysForCollection(e,t,r){const i=ct(),s=Ne(t),o=IDBKeyRange.bound([this.userId,s,r],[this.userId,s,Number.POSITIVE_INFINITY],!0);return xi(e).U("collectionPathOverlayIndex",o).next(a=>{for(const u of a){const c=Ia(this.serializer,u);i.set(c.getKey(),c)}return i})}getOverlaysForCollectionGroup(e,t,r,i){const s=ct();let o;const a=IDBKeyRange.bound([this.userId,t,r],[this.userId,t,Number.POSITIVE_INFINITY],!0);return xi(e).J({index:"collectionGroupOverlayIndex",range:a},(u,c,l)=>{const d=Ia(this.serializer,c);s.size()<i||d.largestBatchId===o?(s.set(d.getKey(),d),o=d.largestBatchId):l.done()}).next(()=>s)}lt(e,t){return xi(e).put(function(i,s,o){const[a,u,c]=Kh(s,o.mutation.key);return{userId:s,collectionPath:u,documentId:c,collectionGroup:o.mutation.key.getCollectionGroup(),largestBatchId:o.largestBatchId,overlayMutation:Si(i.ut,o.mutation)}}(this.serializer,this.userId,t))}}function xi(n){return Ae(n,"documentOverlays")}class pn{constructor(){}ht(e,t){this.Pt(e,t),t.It()}Pt(e,t){if("nullValue"in e)this.Tt(t,5);else if("booleanValue"in e)this.Tt(t,10),t.Et(e.booleanValue?1:0);else if("integerValue"in e)this.Tt(t,15),t.Et(ue(e.integerValue));else if("doubleValue"in e){const r=ue(e.doubleValue);isNaN(r)?this.Tt(t,13):(this.Tt(t,15),li(r)?t.Et(0):t.Et(r))}else if("timestampValue"in e){let r=e.timestampValue;this.Tt(t,20),"string"==typeof r&&(r=Tt(r)),t.dt(`${r.seconds||""}`),t.Et(r.nanos||0)}else if("stringValue"in e)this.At(e.stringValue,t),this.Rt(t);else if("bytesValue"in e)this.Tt(t,30),t.Vt(Et(e.bytesValue)),this.Rt(t);else if("referenceValue"in e)this.ft(e.referenceValue,t);else if("geoPointValue"in e){const r=e.geoPointValue;this.Tt(t,45),t.Et(r.latitude||0),t.Et(r.longitude||0)}else"mapValue"in e?Ml(e)?this.Tt(t,Number.MAX_SAFE_INTEGER):(this.gt(e.mapValue,t),this.Rt(t)):"arrayValue"in e?(this.yt(e.arrayValue,t),this.Rt(t)):D()}At(e,t){this.Tt(t,25),this.wt(e,t)}wt(e,t){t.dt(e)}gt(e,t){const r=e.fields||{};this.Tt(t,55);for(const i of Object.keys(r))this.At(i,t),this.Pt(r[i],t)}yt(e,t){const r=e.values||[];this.Tt(t,50);for(const i of r)this.Pt(i,t)}ft(e,t){this.Tt(t,37),C.fromName(e).path.forEach(r=>{this.Tt(t,60),this.wt(r,t)})}Tt(e,t){e.Et(t)}Rt(e){e.Et(2)}}function qg(n){if(0===n)return 8;let e=0;return!(n>>4)&&(e+=4,n<<=4),!(n>>6)&&(e+=2,n<<=2),!(n>>7)&&(e+=1),e}function Wh(n){const e=64-function(r){let i=0;for(let s=0;s<8;++s){const o=qg(255&r[s]);if(i+=o,8!==o)break}return i}(n);return Math.ceil(e/8)}pn.St=new pn;class Ug{constructor(){this.buffer=new Uint8Array(1024),this.position=0}bt(e){const t=e[Symbol.iterator]();let r=t.next();for(;!r.done;)this.Dt(r.value),r=t.next();this.Ct()}vt(e){const t=e[Symbol.iterator]();let r=t.next();for(;!r.done;)this.Ft(r.value),r=t.next();this.Mt()}xt(e){for(const t of e){const r=t.charCodeAt(0);if(r<128)this.Dt(r);else if(r<2048)this.Dt(960|r>>>6),this.Dt(128|63&r);else if(t<"\ud800"||"\udbff"<t)this.Dt(480|r>>>12),this.Dt(128|63&r>>>6),this.Dt(128|63&r);else{const i=t.codePointAt(0);this.Dt(240|i>>>18),this.Dt(128|63&i>>>12),this.Dt(128|63&i>>>6),this.Dt(128|63&i)}}this.Ct()}Ot(e){for(const t of e){const r=t.charCodeAt(0);if(r<128)this.Ft(r);else if(r<2048)this.Ft(960|r>>>6),this.Ft(128|63&r);else if(t<"\ud800"||"\udbff"<t)this.Ft(480|r>>>12),this.Ft(128|63&r>>>6),this.Ft(128|63&r);else{const i=t.codePointAt(0);this.Ft(240|i>>>18),this.Ft(128|63&i>>>12),this.Ft(128|63&i>>>6),this.Ft(128|63&i)}}this.Mt()}Nt(e){const t=this.Lt(e),r=Wh(t);this.Bt(1+r),this.buffer[this.position++]=255&r;for(let i=t.length-r;i<t.length;++i)this.buffer[this.position++]=255&t[i]}kt(e){const t=this.Lt(e),r=Wh(t);this.Bt(1+r),this.buffer[this.position++]=~(255&r);for(let i=t.length-r;i<t.length;++i)this.buffer[this.position++]=~(255&t[i])}qt(){this.Qt(255),this.Qt(255)}Kt(){this.$t(255),this.$t(255)}reset(){this.position=0}seed(e){this.Bt(e.length),this.buffer.set(e,this.position),this.position+=e.length}Ut(){return this.buffer.slice(0,this.position)}Lt(e){const t=function(s){const o=new DataView(new ArrayBuffer(8));return o.setFloat64(0,s,!1),new Uint8Array(o.buffer)}(e),r=0!=(128&t[0]);t[0]^=r?255:128;for(let i=1;i<t.length;++i)t[i]^=r?255:0;return t}Dt(e){const t=255&e;0===t?(this.Qt(0),this.Qt(255)):255===t?(this.Qt(255),this.Qt(0)):this.Qt(t)}Ft(e){const t=255&e;0===t?(this.$t(0),this.$t(255)):255===t?(this.$t(255),this.$t(0)):this.$t(e)}Ct(){this.Qt(0),this.Qt(1)}Mt(){this.$t(0),this.$t(1)}Qt(e){this.Bt(1),this.buffer[this.position++]=e}$t(e){this.Bt(1),this.buffer[this.position++]=~e}Bt(e){const t=e+this.position;if(t<=this.buffer.length)return;let r=2*this.buffer.length;r<t&&(r=t);const i=new Uint8Array(r);i.set(this.buffer),this.buffer=i}}class Gg{constructor(e){this.Wt=e}Vt(e){this.Wt.bt(e)}dt(e){this.Wt.xt(e)}Et(e){this.Wt.Nt(e)}It(){this.Wt.qt()}}class zg{constructor(e){this.Wt=e}Vt(e){this.Wt.vt(e)}dt(e){this.Wt.Ot(e)}Et(e){this.Wt.kt(e)}It(){this.Wt.Kt()}}class Ci{constructor(){this.Wt=new Ug,this.Gt=new Gg(this.Wt),this.zt=new zg(this.Wt)}seed(e){this.Wt.seed(e)}jt(e){return 0===e?this.Gt:this.zt}Ut(){return this.Wt.Ut()}reset(){this.Wt.reset()}}class _n{constructor(e,t,r,i){this.indexId=e,this.documentKey=t,this.arrayValue=r,this.directionalValue=i}Ht(){const e=this.directionalValue.length,t=0===e||255===this.directionalValue[e-1]?e+1:e,r=new Uint8Array(t);return r.set(this.directionalValue,0),t!==e?r.set([0],this.directionalValue.length):++r[r.length-1],new _n(this.indexId,this.documentKey,this.arrayValue,r)}}function Kt(n,e){let t=n.indexId-e.indexId;return 0!==t?t:(t=Hh(n.arrayValue,e.arrayValue),0!==t?t:(t=Hh(n.directionalValue,e.directionalValue),0!==t?t:C.comparator(n.documentKey,e.documentKey)))}function Hh(n,e){for(let t=0;t<n.length&&t<e.length;++t){const r=n[t]-e[t];if(0!==r)return r}return n.length-e.length}class Zh{constructor(e){this.Jt=new Y((t,r)=>re.comparator(t.field,r.field)),this.collectionId=null!=e.collectionGroup?e.collectionGroup:e.path.lastSegment(),this.Yt=e.orderBy,this.Zt=[];for(const t of e.filters){const r=t;r.isInequality()?this.Jt=this.Jt.add(r):this.Zt.push(r)}}get Xt(){return this.Jt.size>1}en(e){if(b(e.collectionGroup===this.collectionId),this.Xt)return!1;const t=Qo(e);if(void 0!==t&&!this.tn(t))return!1;const r=on(e);let i=new Set,s=0,o=0;for(;s<r.length&&this.tn(r[s]);++s)i=i.add(r[s].fieldPath.canonicalString());if(s===r.length)return!0;if(this.Jt.size>0){const a=this.Jt.getIterator().getNext();if(!i.has(a.field.canonicalString())){const u=r[s];if(!this.nn(a,u)||!this.rn(this.Yt[o++],u))return!1}++s}for(;s<r.length;++s)if(o>=this.Yt.length||!this.rn(this.Yt[o++],r[s]))return!1;return!0}sn(){if(this.Xt)return null;let e=new Y(re.comparator);const t=[];for(const r of this.Zt)if(!r.field.isKeyField())if("array-contains"===r.op||"array-contains-any"===r.op)t.push(new an(r.field,2));else{if(e.has(r.field))continue;e=e.add(r.field),t.push(new an(r.field,0))}for(const r of this.Yt)r.field.isKeyField()||e.has(r.field)||(e=e.add(r.field),t.push(new an(r.field,"asc"===r.dir?0:1)));return new Hn(Hn.UNKNOWN_ID,this.collectionId,t,Zn.empty())}tn(e){for(const t of this.Zt)if(this.nn(t,e))return!0;return!1}nn(e,t){return!(void 0===e||!e.field.isEqual(t.fieldPath))&&2===t.kind==("array-contains"===e.op||"array-contains-any"===e.op)}rn(e,t){return!!e.field.isEqual(t.fieldPath)&&(0===t.kind&&"asc"===e.dir||1===t.kind&&"desc"===e.dir)}}function Jh(n){var e,t;if(b(n instanceof j||n instanceof Z),n instanceof j){if(n instanceof Wl){const i=(null===(t=null===(e=n.value.arrayValue)||void 0===e?void 0:e.values)||void 0===t?void 0:t.map(s=>j.create(n.field,"==",s)))||[];return Z.create(i,"or")}return n}const r=n.filters.map(i=>Jh(i));return Z.create(r,n.op)}function Kg(n){if(0===n.getFilters().length)return[];const e=va(Jh(n));return b(Yh(e)),Ta(e)||Ea(e)?[e]:e.getFilters()}function Ta(n){return n instanceof j}function Ea(n){return n instanceof Z&&ta(n)}function Yh(n){return Ta(n)||Ea(n)||function(t){if(t instanceof Z&&ea(t)){for(const r of t.getFilters())if(!Ta(r)&&!Ea(r))return!1;return!0}return!1}(n)}function va(n){if(b(n instanceof j||n instanceof Z),n instanceof j)return n;if(1===n.filters.length)return va(n.filters[0]);const e=n.filters.map(r=>va(r));let t=Z.create(e,n.op);return t=zs(t),Yh(t)?t:(b(t instanceof Z),b(Xn(t)),b(t.filters.length>1),t.filters.reduce((r,i)=>Aa(r,i)))}function Aa(n,e){let t;return b(n instanceof j||n instanceof Z),b(e instanceof j||e instanceof Z),t=n instanceof j?e instanceof j?Z.create([n,e],"and"):Xh(n,e):e instanceof j?Xh(e,n):function(i,s){if(b(i.filters.length>0&&s.filters.length>0),Xn(i)&&Xn(s))return jl(i,s.getFilters());const o=ea(i)?i:s,a=ea(i)?s:i,u=o.filters.map(c=>Aa(c,a));return Z.create(u,"or")}(n,e),zs(t)}function Xh(n,e){if(Xn(e))return jl(e,n.getFilters());{const t=e.filters.map(r=>Aa(n,r));return Z.create(t,"or")}}function zs(n){if(b(n instanceof j||n instanceof Z),n instanceof j)return n;const e=n.getFilters();if(1===e.length)return zs(e[0]);if(zl(n))return n;const t=e.map(i=>zs(i)),r=[];return t.forEach(i=>{i instanceof j?r.push(i):i instanceof Z&&(i.op===n.op?r.push(...i.filters):r.push(i))}),1===r.length?r[0]:Z.create(r,n.op)}class jg{constructor(){this.on=new wa}addToCollectionParentIndex(e,t){return this.on.add(t),g.resolve()}getCollectionParents(e,t){return g.resolve(this.on.getEntries(t))}addFieldIndex(e,t){return g.resolve()}deleteFieldIndex(e,t){return g.resolve()}deleteAllFieldIndexes(e){return g.resolve()}createTargetIndexes(e,t){return g.resolve()}getDocumentsMatchingTarget(e,t){return g.resolve(null)}getIndexType(e,t){return g.resolve(0)}getFieldIndexes(e,t){return g.resolve([])}getNextCollectionGroupToUpdate(e){return g.resolve(null)}getMinOffset(e,t){return g.resolve(je.min())}getMinOffsetFromCollectionGroup(e,t){return g.resolve(je.min())}updateCollectionGroup(e,t,r){return g.resolve()}updateIndexEntries(e,t){return g.resolve()}}class wa{constructor(){this.index={}}add(e){const t=e.lastSegment(),r=e.popLast(),i=this.index[t]||new Y(K.comparator),s=!i.has(r);return this.index[t]=i.add(r),s}has(e){const t=e.lastSegment(),r=e.popLast(),i=this.index[t];return i&&i.has(r)}getEntries(e){return(this.index[e]||new Y(K.comparator)).toArray()}}const Ks=new Uint8Array(0);class $g{constructor(e,t){this.databaseId=t,this._n=new wa,this.an=new At(r=>ln(r),(r,i)=>pi(r,i)),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(!this._n.has(t)){const r=t.lastSegment(),i=t.popLast();e.addOnCommittedListener(()=>{this._n.add(t)});const s={collectionId:r,parent:Ne(i)};return ed(e).put(s)}return g.resolve()}getCollectionParents(e,t){const r=[],i=IDBKeyRange.bound([t,""],[ml(t),""],!1,!0);return ed(e).U(i).next(s=>{for(const o of s){if(o.collectionId!==t)break;r.push(at(o.parent))}return r})}addFieldIndex(e,t){const r=Di(e),i={indexId:(a=t).indexId,collectionGroup:a.collectionGroup,fields:a.fields.map(u=>[u.fieldPath.canonicalString(),u.kind])};var a;delete i.indexId;const s=r.add(i);if(t.indexState){const o=lr(e);return s.next(a=>{o.put(jh(a,this.uid,t.indexState.sequenceNumber,t.indexState.offset))})}return s.next()}deleteFieldIndex(e,t){const r=Di(e),i=lr(e),s=cr(e);return r.delete(t.indexId).next(()=>i.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))).next(()=>s.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))}deleteAllFieldIndexes(e){const t=Di(e),r=cr(e),i=lr(e);return t.j().next(()=>r.j()).next(()=>i.j())}createTargetIndexes(e,t){return g.forEach(this.un(t),r=>this.getIndexType(e,r).next(i=>{if(0===i||1===i){const s=new Zh(r).sn();if(null!=s)return this.addFieldIndex(e,s)}}))}getDocumentsMatchingTarget(e,t){const r=cr(e);let i=!0;const s=new Map;return g.forEach(this.un(t),o=>this.cn(e,o).next(a=>{i&&(i=!!a),s.set(o,a)})).next(()=>{if(i){let o=B();const a=[];return g.forEach(s,(u,c)=>{var F;A("IndexedDbIndexManager",`Using index ${F=u,`id=${F.indexId}|cg=${F.collectionGroup}|f=${F.fields.map(q=>`${q.fieldPath}:${q.kind}`).join(",")}`} to execute ${ln(t)}`);const l=function(F,q){const X=Qo(q);if(void 0===X)return null;for(const J of ks(F,X.fieldPath))switch(J.op){case"array-contains-any":return J.value.arrayValue.values||[];case"array-contains":return[J.value]}return null}(c,u),d=function(F,q){const X=new Map;for(const J of on(q))for(const Te of ks(F,J.fieldPath))switch(Te.op){case"==":case"in":X.set(J.fieldPath.canonicalString(),Te.value);break;case"not-in":case"!=":return X.set(J.fieldPath.canonicalString(),Te.value),Array.from(X.values())}return null}(c,u),m=function(F,q){const X=[];let J=!0;for(const Te of on(q)){const Ze=0===Te.kind?Hl(F,Te.fieldPath,F.startAt):Zl(F,Te.fieldPath,F.startAt);X.push(Ze.value),J&&(J=Ze.inclusive)}return new Gt(X,J)}(c,u),p=function(F,q){const X=[];let J=!0;for(const Te of on(q)){const Ze=0===Te.kind?Zl(F,Te.fieldPath,F.endAt):Hl(F,Te.fieldPath,F.endAt);X.push(Ze.value),J&&(J=Ze.inclusive)}return new Gt(X,J)}(c,u),w=this.ln(u,c,m),x=this.ln(u,c,p),R=this.hn(u,c,d),k=this.Pn(u.indexId,l,w,m.inclusive,x,p.inclusive,R);return g.forEach(k,L=>r.G(L,t.limit).next(F=>{F.forEach(q=>{const X=C.fromSegments(q.documentKey);o.has(X)||(o=o.add(X),a.push(X))})}))}).next(()=>a)}return g.resolve(null)})}un(e){let t=this.an.get(e);return t||(t=0===e.filters.length?[e]:Kg(Z.create(e.filters,"and")).map(r=>ra(e.path,e.collectionGroup,e.orderBy,r.getFilters(),e.limit,e.startAt,e.endAt)),this.an.set(e,t),t)}Pn(e,t,r,i,s,o,a){const u=(null!=t?t.length:1)*Math.max(r.length,s.length),c=u/(null!=t?t.length:1),l=[];for(let d=0;d<u;++d){const m=t?this.In(t[d/c]):Ks,p=this.Tn(e,m,r[d%c],i),w=this.En(e,m,s[d%c],o),x=a.map(R=>this.Tn(e,m,R,!0));l.push(...this.createRange(p,w,x))}return l}Tn(e,t,r,i){const s=new _n(e,C.empty(),t,r);return i?s:s.Ht()}En(e,t,r,i){const s=new _n(e,C.empty(),t,r);return i?s.Ht():s}cn(e,t){const r=new Zh(t),i=null!=t.collectionGroup?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,i).next(s=>{let o=null;for(const a of s)r.en(a)&&(!o||a.fields.length>o.fields.length)&&(o=a);return o})}getIndexType(e,t){let r=2;const i=this.un(t);return g.forEach(i,s=>this.cn(e,s).next(o=>{o?0!==r&&o.fields.length<function(u){let c=new Y(re.comparator),l=!1;for(const d of u.filters)for(const m of d.getFlattenedFilters())m.field.isKeyField()||("array-contains"===m.op||"array-contains-any"===m.op?l=!0:c=c.add(m.field));for(const d of u.orderBy)d.field.isKeyField()||(c=c.add(d.field));return c.size+(l?1:0)}(s)&&(r=1):r=0})).next(()=>null!==t.limit&&i.length>1&&2===r?1:r)}dn(e,t){const r=new Ci;for(const i of on(e)){const s=t.data.field(i.fieldPath);if(null==s)return null;const o=r.jt(i.kind);pn.St.ht(s,o)}return r.Ut()}In(e){const t=new Ci;return pn.St.ht(e,t.jt(0)),t.Ut()}An(e,t){const r=new Ci;return pn.St.ht(cn(this.databaseId,t),r.jt(function(s){const o=on(s);return 0===o.length?0:o[o.length-1].kind}(e))),r.Ut()}hn(e,t,r){if(null===r)return[];let i=[];i.push(new Ci);let s=0;for(const o of on(e)){const a=r[s++];for(const u of i)if(this.Rn(t,o.fieldPath)&&fi(a))i=this.Vn(i,o,a);else{const c=u.jt(o.kind);pn.St.ht(a,c)}}return this.mn(i)}ln(e,t,r){return this.hn(e,t,r.position)}mn(e){const t=[];for(let r=0;r<e.length;++r)t[r]=e[r].Ut();return t}Vn(e,t,r){const i=[...e],s=[];for(const o of r.arrayValue.values||[])for(const a of i){const u=new Ci;u.seed(a.Ut()),pn.St.ht(o,u.jt(t.kind)),s.push(u)}return s}Rn(e,t){return!!e.filters.find(r=>r instanceof j&&r.field.isEqual(t)&&("in"===r.op||"not-in"===r.op))}getFieldIndexes(e,t){const r=Di(e),i=lr(e);return(t?r.U("collectionGroupIndex",IDBKeyRange.bound(t,t)):r.U()).next(s=>{const o=[];return g.forEach(s,a=>i.get([a.indexId,this.uid]).next(u=>{o.push(function(l,d){const m=d?new Zn(d.sequenceNumber,new je(mn(d.readTime),new C(at(d.documentKey)),d.largestBatchId)):Zn.empty(),p=l.fields.map(([w,x])=>new an(re.fromServerFormat(w),x));return new Hn(l.indexId,l.collectionGroup,p,m)}(a,u))})).next(()=>o)})}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next(t=>0===t.length?null:(t.sort((r,i)=>{const s=r.indexState.sequenceNumber-i.indexState.sequenceNumber;return 0!==s?s:O(r.collectionGroup,i.collectionGroup)}),t[0].collectionGroup))}updateCollectionGroup(e,t,r){const i=Di(e),s=lr(e);return this.fn(e).next(o=>i.U("collectionGroupIndex",IDBKeyRange.bound(t,t)).next(a=>g.forEach(a,u=>s.put(jh(u.indexId,this.uid,o,r)))))}updateIndexEntries(e,t){const r=new Map;return g.forEach(t,(i,s)=>{const o=r.get(i.collectionGroup);return(o?g.resolve(o):this.getFieldIndexes(e,i.collectionGroup)).next(a=>(r.set(i.collectionGroup,a),g.forEach(a,u=>this.gn(e,i,u).next(c=>{const l=this.pn(s,u);return c.isEqual(l)?g.resolve():this.yn(e,s,u,c,l)}))))})}wn(e,t,r,i){return cr(e).put({indexId:i.indexId,uid:this.uid,arrayValue:i.arrayValue,directionalValue:i.directionalValue,orderedDocumentKey:this.An(r,t.key),documentKey:t.key.path.toArray()})}Sn(e,t,r,i){return cr(e).delete([i.indexId,this.uid,i.arrayValue,i.directionalValue,this.An(r,t.key),t.key.path.toArray()])}gn(e,t,r){const i=cr(e);let s=new Y(Kt);return i.J({index:"documentKeyIndex",range:IDBKeyRange.only([r.indexId,this.uid,this.An(r,t)])},(o,a)=>{s=s.add(new _n(r.indexId,t,a.arrayValue,a.directionalValue))}).next(()=>s)}pn(e,t){let r=new Y(Kt);const i=this.dn(t,e);if(null==i)return r;const s=Qo(t);if(null!=s){const o=e.data.field(s.fieldPath);if(fi(o))for(const a of o.arrayValue.values||[])r=r.add(new _n(t.indexId,e.key,this.In(a),i))}else r=r.add(new _n(t.indexId,e.key,Ks,i));return r}yn(e,t,r,i,s){A("IndexedDbIndexManager","Updating index entries for document '%s'",t.key);const o=[];return function(u,c,l,d,m){const p=u.getIterator(),w=c.getIterator();let x=Jn(p),R=Jn(w);for(;x||R;){let k=!1,L=!1;if(x&&R){const F=l(x,R);F<0?L=!0:F>0&&(k=!0)}else null!=x?L=!0:k=!0;k?(d(R),R=Jn(w)):L?(m(x),x=Jn(p)):(x=Jn(p),R=Jn(w))}}(i,s,Kt,a=>{o.push(this.wn(e,t,r,a))},a=>{o.push(this.Sn(e,t,r,a))}),g.waitFor(o)}fn(e){let t=1;return lr(e).J({index:"sequenceNumberIndex",reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(r,i,s)=>{s.done(),t=i.sequenceNumber+1}).next(()=>t)}createRange(e,t,r){r=r.sort((o,a)=>Kt(o,a)).filter((o,a,u)=>!a||0!==Kt(o,u[a-1]));const i=[];i.push(e);for(const o of r){const a=Kt(o,e),u=Kt(o,t);if(0===a)i[0]=e.Ht();else if(a>0&&u<0)i.push(o),i.push(o.Ht());else if(u>0)break}i.push(t);const s=[];for(let o=0;o<i.length;o+=2){if(this.bn(i[o],i[o+1]))return[];s.push(IDBKeyRange.bound([i[o].indexId,this.uid,i[o].arrayValue,i[o].directionalValue,Ks,[]],[i[o+1].indexId,this.uid,i[o+1].arrayValue,i[o+1].directionalValue,Ks,[]]))}return s}bn(e,t){return Kt(e,t)>0}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(td)}getMinOffset(e,t){return g.mapArray(this.un(t),r=>this.cn(e,r).next(i=>i||D())).next(td)}}function ed(n){return Ae(n,"collectionParents")}function cr(n){return Ae(n,"indexEntries")}function Di(n){return Ae(n,"indexConfiguration")}function lr(n){return Ae(n,"indexState")}function td(n){b(0!==n.length);let e=n[0].indexState.offset,t=e.largestBatchId;for(let r=1;r<n.length;r++){const i=n[r].indexState.offset;Wo(i,e)<0&&(e=i),t<i.largestBatchId&&(t=i.largestBatchId)}return new je(e.readTime,e.documentKey,t)}const nd={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0};class ke{constructor(e,t,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=r}static withCacheSize(e){return new ke(e,ke.DEFAULT_COLLECTION_PERCENTILE,ke.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}function rd(n,e,t){const r=n.store("mutations"),i=n.store("documentMutations"),s=[],o=IDBKeyRange.only(t.batchId);let a=0;const u=r.J({range:o},(l,d,m)=>(a++,m.delete()));s.push(u.next(()=>{b(1===a)}));const c=[];for(const l of t.mutations){const d=wl(e,l.key.path,t.batchId);s.push(i.delete(d)),c.push(l.key)}return g.waitFor(s).next(()=>c)}function js(n){if(!n)return 0;let e;if(n.document)e=n.document;else if(n.unknownDocument)e=n.unknownDocument;else{if(!n.noDocument)throw D();e=n.noDocument}return JSON.stringify(e).length}ke.DEFAULT_COLLECTION_PERCENTILE=10,ke.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,ke.DEFAULT=new ke(41943040,ke.DEFAULT_COLLECTION_PERCENTILE,ke.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),ke.DISABLED=new ke(-1,0,0);class $s{constructor(e,t,r,i){this.userId=e,this.serializer=t,this.indexManager=r,this.referenceDelegate=i,this.Dn={}}static ct(e,t,r,i){b(""!==e.uid);const s=e.isAuthenticated()?e.uid:"";return new $s(s,t,r,i)}checkEmpty(e){let t=!0;const r=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return jt(e).J({index:"userMutationsIndex",range:r},(i,s,o)=>{t=!1,o.done()}).next(()=>t)}addMutationBatch(e,t,r,i){const s=hr(e),o=jt(e);return o.add({}).next(a=>{b("number"==typeof a);const u=new ua(a,t,r,i),c=function(p,w,x){const R=x.baseMutations.map(L=>Si(p.ut,L)),k=x.mutations.map(L=>Si(p.ut,L));return{userId:w,batchId:x.batchId,localWriteTimeMs:x.localWriteTime.toMillis(),baseMutations:R,mutations:k}}(this.serializer,this.userId,u),l=[];let d=new Y((m,p)=>O(m.canonicalString(),p.canonicalString()));for(const m of i){const p=wl(this.userId,m.key.path,a);d=d.add(m.key.path.popLast()),l.push(o.put(c)),l.push(s.put(p,km))}return d.forEach(m=>{l.push(this.indexManager.addToCollectionParentIndex(e,m))}),e.addOnCommittedListener(()=>{this.Dn[a]=u.keys()}),g.waitFor(l).next(()=>u)})}lookupMutationBatch(e,t){return jt(e).get(t).next(r=>r?(b(r.userId===this.userId),gn(this.serializer,r)):null)}Cn(e,t){return this.Dn[t]?g.resolve(this.Dn[t]):this.lookupMutationBatch(e,t).next(r=>{if(r){const i=r.keys();return this.Dn[t]=i,i}return null})}getNextMutationBatchAfterBatchId(e,t){const r=t+1,i=IDBKeyRange.lowerBound([this.userId,r]);let s=null;return jt(e).J({index:"userMutationsIndex",range:i},(o,a,u)=>{a.userId===this.userId&&(b(a.batchId>=r),s=gn(this.serializer,a)),u.done()}).next(()=>s)}getHighestUnacknowledgedBatchId(e){const t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]);let r=-1;return jt(e).J({index:"userMutationsIndex",range:t,reverse:!0},(i,s,o)=>{r=s.batchId,o.done()}).next(()=>r)}getAllMutationBatches(e){const t=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return jt(e).U("userMutationsIndex",t).next(r=>r.map(i=>gn(this.serializer,i)))}getAllMutationBatchesAffectingDocumentKey(e,t){const r=Ps(this.userId,t.path),i=IDBKeyRange.lowerBound(r),s=[];return hr(e).J({range:i},(o,a,u)=>{const[c,l,d]=o,m=at(l);if(c===this.userId&&t.path.isEqual(m))return jt(e).get(d).next(p=>{if(!p)throw D();b(p.userId===this.userId),s.push(gn(this.serializer,p))});u.done()}).next(()=>s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new Y(O);const i=[];return t.forEach(s=>{const o=Ps(this.userId,s.path),a=IDBKeyRange.lowerBound(o),u=hr(e).J({range:a},(c,l,d)=>{const[m,p,w]=c,x=at(p);m===this.userId&&s.path.isEqual(x)?r=r.add(w):d.done()});i.push(u)}),g.waitFor(i).next(()=>this.vn(e,r))}getAllMutationBatchesAffectingQuery(e,t){const r=t.path,i=r.length+1,s=Ps(this.userId,r),o=IDBKeyRange.lowerBound(s);let a=new Y(O);return hr(e).J({range:o},(u,c,l)=>{const[d,m,p]=u,w=at(m);d===this.userId&&r.isPrefixOf(w)?w.length===i&&(a=a.add(p)):l.done()}).next(()=>this.vn(e,a))}vn(e,t){const r=[],i=[];return t.forEach(s=>{i.push(jt(e).get(s).next(o=>{if(null===o)throw D();b(o.userId===this.userId),r.push(gn(this.serializer,o))}))}),g.waitFor(i).next(()=>r)}removeMutationBatch(e,t){return rd(e._e,this.userId,t).next(r=>(e.addOnCommittedListener(()=>{this.Fn(t.batchId)}),g.forEach(r,i=>this.referenceDelegate.markPotentiallyOrphaned(e,i))))}Fn(e){delete this.Dn[e]}performConsistencyCheck(e){return this.checkEmpty(e).next(t=>{if(!t)return g.resolve();const r=IDBKeyRange.lowerBound([this.userId]),i=[];return hr(e).J({range:r},(s,o,a)=>{if(s[0]===this.userId){const u=at(s[1]);i.push(u)}else a.done()}).next(()=>{b(0===i.length)})})}containsKey(e,t){return id(e,this.userId,t)}Mn(e){return sd(e).get(this.userId).next(t=>t||{userId:this.userId,lastAcknowledgedBatchId:-1,lastStreamToken:""})}}function id(n,e,t){const r=Ps(e,t.path),i=r[1],s=IDBKeyRange.lowerBound(r);let o=!1;return hr(n).J({range:s,H:!0},(a,u,c)=>{const[l,d,m]=a;l===e&&d===i&&(o=!0),c.done()}).next(()=>o)}function jt(n){return Ae(n,"mutations")}function hr(n){return Ae(n,"documentMutations")}function sd(n){return Ae(n,"mutationQueues")}class yn{constructor(e){this.xn=e}next(){return this.xn+=2,this.xn}static On(){return new yn(0)}static Nn(){return new yn(-1)}}class Qg{constructor(e,t){this.referenceDelegate=e,this.serializer=t}allocateTargetId(e){return this.Ln(e).next(t=>{const r=new yn(t.highestTargetId);return t.highestTargetId=r.next(),this.Bn(e,t).next(()=>t.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.Ln(e).next(t=>N.fromTimestamp(new se(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.Ln(e).next(t=>t.highestListenSequenceNumber)}setTargetsMetadata(e,t,r){return this.Ln(e).next(i=>(i.highestListenSequenceNumber=t,r&&(i.lastRemoteSnapshotVersion=r.toTimestamp()),t>i.highestListenSequenceNumber&&(i.highestListenSequenceNumber=t),this.Bn(e,i)))}addTargetData(e,t){return this.kn(e,t).next(()=>this.Ln(e).next(r=>(r.targetCount+=1,this.qn(t,r),this.Bn(e,r))))}updateTargetData(e,t){return this.kn(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next(()=>dr(e).delete(t.targetId)).next(()=>this.Ln(e)).next(r=>(b(r.targetCount>0),r.targetCount-=1,this.Bn(e,r)))}removeTargets(e,t,r){let i=0;const s=[];return dr(e).J((o,a)=>{const u=Vi(a);u.sequenceNumber<=t&&null===r.get(u.targetId)&&(i++,s.push(this.removeTargetData(e,u)))}).next(()=>g.waitFor(s)).next(()=>i)}forEachTarget(e,t){return dr(e).J((r,i)=>{const s=Vi(i);t(s)})}Ln(e){return od(e).get("targetGlobalKey").next(t=>(b(null!==t),t))}Bn(e,t){return od(e).put("targetGlobalKey",t)}kn(e,t){return dr(e).put(zh(this.serializer,t))}qn(e,t){let r=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,r=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,r=!0),r}getTargetCount(e){return this.Ln(e).next(t=>t.targetCount)}getTargetData(e,t){const r=ln(t),i=IDBKeyRange.bound([r,Number.NEGATIVE_INFINITY],[r,Number.POSITIVE_INFINITY]);let s=null;return dr(e).J({range:i,index:"queryTargetsIndex"},(o,a,u)=>{const c=Vi(a);pi(t,c.target)&&(s=c,u.done())}).next(()=>s)}addMatchingKeys(e,t,r){const i=[],s=$t(e);return t.forEach(o=>{const a=Ne(o.path);i.push(s.put({targetId:r,path:a})),i.push(this.referenceDelegate.addReference(e,r,o))}),g.waitFor(i)}removeMatchingKeys(e,t,r){const i=$t(e);return g.forEach(t,s=>{const o=Ne(s.path);return g.waitFor([i.delete([r,o]),this.referenceDelegate.removeReference(e,r,s)])})}removeMatchingKeysForTargetId(e,t){const r=$t(e),i=IDBKeyRange.bound([t],[t+1],!1,!0);return r.delete(i)}getMatchingKeysForTargetId(e,t){const r=IDBKeyRange.bound([t],[t+1],!1,!0),i=$t(e);let s=B();return i.J({range:r,H:!0},(o,a,u)=>{const c=at(o[1]),l=new C(c);s=s.add(l)}).next(()=>s)}containsKey(e,t){const r=Ne(t.path),i=IDBKeyRange.bound([r],[ml(r)],!1,!0);let s=0;return $t(e).J({index:"documentTargetsIndex",H:!0,range:i},([o,a],u,c)=>{0!==o&&(s++,c.done())}).next(()=>s>0)}ot(e,t){return dr(e).get(t).next(r=>r?Vi(r):null)}}function dr(n){return Ae(n,"targets")}function od(n){return Ae(n,"targetGlobal")}function $t(n){return Ae(n,"targetDocuments")}function ad([n,e],[t,r]){const i=O(n,t);return 0===i?O(e,r):i}class Wg{constructor(e){this.Qn=e,this.buffer=new Y(ad),this.Kn=0}$n(){return++this.Kn}Un(e){const t=[e,this.$n()];if(this.buffer.size<this.Qn)this.buffer=this.buffer.add(t);else{const r=this.buffer.last();ad(t,r)<0&&(this.buffer=this.buffer.delete(r).add(t))}}get maxValue(){return this.buffer.last()[0]}}class ud{constructor(e,t,r){this.garbageCollector=e,this.asyncQueue=t,this.localStore=r,this.Wn=null}start(){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.Gn(6e4)}stop(){this.Wn&&(this.Wn.cancel(),this.Wn=null)}get started(){return null!==this.Wn}Gn(e){var t=this;A("LruGarbageCollector",`Garbage collection scheduled in ${e}ms`),this.Wn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,(0,y.Z)(function*(){t.Wn=null;try{yield t.localStore.collectGarbage(t.garbageCollector)}catch(r){Mt(r)?A("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",r):yield Ft(r)}yield t.Gn(3e5)}))}}class Hg{constructor(e,t){this.zn=e,this.params=t}calculateTargetCount(e,t){return this.zn.jn(e).next(r=>Math.floor(t/100*r))}nthSequenceNumber(e,t){if(0===t)return g.resolve($e.oe);const r=new Wg(t);return this.zn.forEachTarget(e,i=>r.Un(i.sequenceNumber)).next(()=>this.zn.Hn(e,i=>r.Un(i))).next(()=>r.maxValue)}removeTargets(e,t,r){return this.zn.removeTargets(e,t,r)}removeOrphanedDocuments(e,t){return this.zn.removeOrphanedDocuments(e,t)}collect(e,t){return-1===this.params.cacheSizeCollectionThreshold?(A("LruGarbageCollector","Garbage collection skipped; disabled"),g.resolve(nd)):this.getCacheSize(e).next(r=>r<this.params.cacheSizeCollectionThreshold?(A("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),nd):this.Jn(e,t))}getCacheSize(e){return this.zn.getCacheSize(e)}Jn(e,t){let r,i,s,o,a,u,c;const l=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(d=>(d>this.params.maximumSequenceNumbersToCollect?(A("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${d}`),i=this.params.maximumSequenceNumbersToCollect):i=d,o=Date.now(),this.nthSequenceNumber(e,i))).next(d=>(r=d,a=Date.now(),this.removeTargets(e,r,t))).next(d=>(s=d,u=Date.now(),this.removeOrphanedDocuments(e,r))).next(d=>(c=Date.now(),Qn()<=Pe.in.DEBUG&&A("LruGarbageCollector",`LRU Garbage Collection\n\tCounted targets in ${o-l}ms\n\tDetermined least recently used ${i} in `+(a-o)+`ms\n\tRemoved ${s} targets in `+(u-a)+`ms\n\tRemoved ${d} documents in `+(c-u)+`ms\nTotal Duration: ${c-l}ms`),g.resolve({didRun:!0,sequenceNumbersCollected:i,targetsRemoved:s,documentsRemoved:d})))}}class Zg{constructor(e,t){this.db=e,this.garbageCollector=function cd(n,e){return new Hg(n,e)}(this,t)}jn(e){const t=this.Yn(e);return this.db.getTargetCache().getTargetCount(e).next(r=>t.next(i=>r+i))}Yn(e){let t=0;return this.Hn(e,r=>{t++}).next(()=>t)}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}Hn(e,t){return this.Zn(e,(r,i)=>t(i))}addReference(e,t,r){return Qs(e,r)}removeReference(e,t,r){return Qs(e,r)}removeTargets(e,t,r){return this.db.getTargetCache().removeTargets(e,t,r)}markPotentiallyOrphaned(e,t){return Qs(e,t)}Xn(e,t){return function(i,s){let o=!1;return sd(i).Y(a=>id(i,a,s).next(u=>(u&&(o=!0),g.resolve(!u)))).next(()=>o)}(e,t)}removeOrphanedDocuments(e,t){const r=this.db.getRemoteDocumentCache().newChangeBuffer(),i=[];let s=0;return this.Zn(e,(o,a)=>{if(a<=t){const u=this.Xn(e,o).next(c=>{if(!c)return s++,r.getEntry(e,o).next(()=>(r.removeEntry(o,N.min()),$t(e).delete([0,Ne(o.path)])))});i.push(u)}}).next(()=>g.waitFor(i)).next(()=>r.apply(e)).next(()=>s)}removeTarget(e,t){const r=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,r)}updateLimboDocument(e,t){return Qs(e,t)}Zn(e,t){const r=$t(e);let i,s=$e.oe;return r.J({index:"documentTargetsIndex"},([o,a],{path:u,sequenceNumber:c})=>{0===o?(s!==$e.oe&&t(new C(at(i)),s),s=c,i=u):s=$e.oe}).next(()=>{s!==$e.oe&&t(new C(at(i)),s)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}}function Qs(n,e){return $t(n).put((i=n.currentSequenceNumber,{targetId:0,path:Ne(e.path),sequenceNumber:i}));var i}class ld{constructor(){this.changes=new At(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,ie.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const r=this.changes.get(t);return void 0!==r?g.resolve(r):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class Jg{constructor(e){this.serializer=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,r){return In(e).put(r)}removeEntry(e,t,r){return In(e).delete(function(s,o){const a=s.path.toArray();return[a.slice(0,a.length-2),a[a.length-2],Us(o),a[a.length-1]]}(t,r))}updateMetadata(e,t){return this.getMetadata(e).next(r=>(r.byteSize+=t,this.er(e,r)))}getEntry(e,t){let r=ie.newInvalidDocument(t);return In(e).J({index:"documentKeyIndex",range:IDBKeyRange.only(bi(t))},(i,s)=>{r=this.tr(t,s)}).next(()=>r)}nr(e,t){let r={size:0,document:ie.newInvalidDocument(t)};return In(e).J({index:"documentKeyIndex",range:IDBKeyRange.only(bi(t))},(i,s)=>{r={document:this.tr(t,s),size:js(s)}}).next(()=>r)}getEntries(e,t){let r=ze();return this.rr(e,t,(i,s)=>{const o=this.tr(i,s);r=r.insert(i,o)}).next(()=>r)}ir(e,t){let r=ze(),i=new ee(C.comparator);return this.rr(e,t,(s,o)=>{const a=this.tr(s,o);r=r.insert(s,a),i=i.insert(s,js(o))}).next(()=>({documents:r,sr:i}))}rr(e,t,r){if(t.isEmpty())return g.resolve();let i=new Y(md);t.forEach(u=>i=i.add(u));const s=IDBKeyRange.bound(bi(i.first()),bi(i.last())),o=i.getIterator();let a=o.getNext();return In(e).J({index:"documentKeyIndex",range:s},(u,c,l)=>{const d=C.fromSegments([...c.prefixPath,c.collectionGroup,c.documentId]);for(;a&&md(a,d)<0;)r(a,null),a=o.getNext();a&&a.isEqual(d)&&(r(a,c),a=o.hasNext()?o.getNext():null),a?l.$(bi(a)):l.done()}).next(()=>{for(;a;)r(a,null),a=o.hasNext()?o.getNext():null})}getDocumentsMatchingQuery(e,t,r,i,s){const o=t.path,a=[o.popLast().toArray(),o.lastSegment(),Us(r.readTime),r.documentKey.path.isEmpty()?"":r.documentKey.path.lastSegment()],u=[o.popLast().toArray(),o.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return In(e).U(IDBKeyRange.bound(a,u,!0)).next(c=>{s?.incrementDocumentReadCount(c.length);let l=ze();for(const d of c){const m=this.tr(C.fromSegments(d.prefixPath.concat(d.collectionGroup,d.documentId)),d);m.isFoundDocument()&&(yi(t,m)||i.has(m.key))&&(l=l.insert(m.key,m))}return l})}getAllFromCollectionGroup(e,t,r,i){let s=ze();const o=fd(t,r),a=fd(t,je.max());return In(e).J({index:"collectionGroupIndex",range:IDBKeyRange.bound(o,a,!0)},(u,c,l)=>{const d=this.tr(C.fromSegments(c.prefixPath.concat(c.collectionGroup,c.documentId)),c);s=s.insert(d.key,d),s.size===i&&l.done()}).next(()=>s)}newChangeBuffer(e){return new Yg(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(t=>t.byteSize)}getMetadata(e){return dd(e).get("remoteDocumentGlobalKey").next(t=>(b(!!t),t))}er(e,t){return dd(e).put("remoteDocumentGlobalKey",t)}tr(e,t){if(t){const r=function Lg(n,e){let t;if(e.document)t=Fh(n.ut,e.document,!!e.hasCommittedMutations);else if(e.noDocument){const r=C.fromSegments(e.noDocument.path),i=mn(e.noDocument.readTime);t=ie.newNoDocument(r,i),e.hasCommittedMutations&&t.setHasCommittedMutations()}else{if(!e.unknownDocument)return D();{const r=C.fromSegments(e.unknownDocument.path),i=mn(e.unknownDocument.version);t=ie.newUnknownDocument(r,i)}}return e.readTime&&t.setReadTime(function(i){const s=new se(i[0],i[1]);return N.fromTimestamp(s)}(e.readTime)),t}(this.serializer,t);if(!r.isNoDocument()||!r.version.isEqual(N.min()))return r}return ie.newInvalidDocument(e)}}function hd(n){return new Jg(n)}class Yg extends ld{constructor(e,t){super(),this._r=e,this.trackRemovals=t,this.ar=new At(r=>r.toString(),(r,i)=>r.isEqual(i))}applyChanges(e){const t=[];let r=0,i=new Y((s,o)=>O(s.canonicalString(),o.canonicalString()));return this.changes.forEach((s,o)=>{const a=this.ar.get(s);if(t.push(this._r.removeEntry(e,s,a.readTime)),o.isValidDocument()){const u=Gh(this._r.serializer,o);i=i.add(s.path.popLast());const c=js(u);r+=c-a.size,t.push(this._r.addEntry(e,s,u))}else if(r-=a.size,this.trackRemovals){const u=Gh(this._r.serializer,o.convertToNoDocument(N.min()));t.push(this._r.addEntry(e,s,u))}}),i.forEach(s=>{t.push(this._r.indexManager.addToCollectionParentIndex(e,s))}),t.push(this._r.updateMetadata(e,r)),g.waitFor(t)}getFromCache(e,t){return this._r.nr(e,t).next(r=>(this.ar.set(t,{size:r.size,readTime:r.document.readTime}),r.document))}getAllFromCache(e,t){return this._r.ir(e,t).next(({documents:r,sr:i})=>(i.forEach((s,o)=>{this.ar.set(s,{size:o,readTime:r.get(s).readTime})}),r))}}function dd(n){return Ae(n,"remoteDocumentGlobal")}function In(n){return Ae(n,"remoteDocumentsV14")}function bi(n){const e=n.path.toArray();return[e.slice(0,e.length-2),e[e.length-2],e[e.length-1]]}function fd(n,e){const t=e.documentKey.path.toArray();return[n,Us(e.readTime),t.slice(0,t.length-2),t.length>0?t[t.length-1]:""]}function md(n,e){const t=n.path.toArray(),r=e.path.toArray();let i=0;for(let s=0;s<t.length-2&&s<r.length-2;++s)if(i=O(t[s],r[s]),i)return i;return i=O(t.length,r.length),i||(i=O(t[t.length-2],r[r.length-2]),i||O(t[t.length-1],r[r.length-1]))}class Xg{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}class gd{constructor(e,t,r,i){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=r,this.indexManager=i}getDocument(e,t){let r=null;return this.documentOverlayCache.getOverlay(e,t).next(i=>(r=i,this.remoteDocumentCache.getEntry(e,t))).next(i=>(null!==r&&vi(r.mutation,i,Ge.empty(),se.now()),i))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.getLocalViewOfDocuments(e,r,B()).next(()=>r))}getLocalViewOfDocuments(e,t,r=B()){const i=ct();return this.populateOverlays(e,i,t).next(()=>this.computeViews(e,t,i,r).next(s=>{let o=Ii();return s.forEach((a,u)=>{o=o.insert(a,u.overlayedDocument)}),o}))}getOverlayedDocuments(e,t){const r=ct();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,B()))}populateOverlays(e,t,r){const i=[];return r.forEach(s=>{t.has(s)||i.push(s)}),this.documentOverlayCache.getOverlays(e,i).next(s=>{s.forEach((o,a)=>{t.set(o,a)})})}computeViews(e,t,r,i){let s=ze();const o=Ti(),a=Ti();return t.forEach((u,c)=>{const l=r.get(c.key);i.has(c.key)&&(void 0===l||l.mutation instanceof wt)?s=s.insert(c.key,c):void 0!==l?(o.set(c.key,l.mutation.getFieldMask()),vi(l.mutation,c,l.mutation.getFieldMask(),se.now())):o.set(c.key,Ge.empty())}),this.recalculateAndSaveOverlays(e,s).next(u=>(u.forEach((c,l)=>o.set(c,l)),t.forEach((c,l)=>{var d;return a.set(c,new Xg(l,null!==(d=o.get(c))&&void 0!==d?d:null))}),a))}recalculateAndSaveOverlays(e,t){const r=Ti();let i=new ee((o,a)=>o-a),s=B();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(o=>{for(const a of o)a.keys().forEach(u=>{const c=t.get(u);if(null===c)return;let l=r.get(u)||Ge.empty();l=a.applyToLocalView(c,l),r.set(u,l);const d=(i.get(a.batchId)||B()).add(u);i=i.insert(a.batchId,d)})}).next(()=>{const o=[],a=i.getReverseIterator();for(;a.hasNext();){const u=a.getNext(),c=u.key,l=u.value,d=sh();l.forEach(m=>{if(!s.has(m)){const p=mh(t.get(m),r.get(m));null!==p&&d.set(m,p),s=s.add(m)}}),o.push(this.documentOverlayCache.saveOverlays(e,c,d))}return g.waitFor(o)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.recalculateAndSaveOverlays(e,r))}getDocumentsMatchingQuery(e,t,r,i){return C.isDocumentKey((o=t).path)&&null===o.collectionGroup&&0===o.filters.length?this.getDocumentsMatchingDocumentQuery(e,t.path):ia(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,r,i):this.getDocumentsMatchingCollectionQuery(e,t,r,i);var o}getNextDocuments(e,t,r,i){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,r,i).next(s=>{const o=i-s.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,r.largestBatchId,i-s.size):g.resolve(ct());let a=-1,u=s;return o.next(c=>g.forEach(c,(l,d)=>(a<d.largestBatchId&&(a=d.largestBatchId),s.get(l)?g.resolve():this.remoteDocumentCache.getEntry(e,l).next(m=>{u=u.insert(l,m)}))).next(()=>this.populateOverlays(e,c,s)).next(()=>this.computeViews(e,u,c,B())).next(l=>({batchId:a,changes:ih(l)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new C(t)).next(r=>{let i=Ii();return r.isFoundDocument()&&(i=i.insert(r.key,r)),i})}getDocumentsMatchingCollectionGroupQuery(e,t,r,i){const s=t.collectionGroup;let o=Ii();return this.indexManager.getCollectionParents(e,s).next(a=>g.forEach(a,u=>{const c=(d=t,m=u.child(s),new vt(m,null,d.explicitOrderBy.slice(),d.filters.slice(),d.limit,d.limitType,d.startAt,d.endAt));var d,m;return this.getDocumentsMatchingCollectionQuery(e,c,r,i).next(l=>{l.forEach((d,m)=>{o=o.insert(d,m)})})}).next(()=>o))}getDocumentsMatchingCollectionQuery(e,t,r,i){let s;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,r.largestBatchId).next(o=>(s=o,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,r,s,i))).next(o=>{s.forEach((u,c)=>{const l=c.getKey();null===o.get(l)&&(o=o.insert(l,ie.newInvalidDocument(l)))});let a=Ii();return o.forEach((u,c)=>{const l=s.get(u);void 0!==l&&vi(l.mutation,c,Ge.empty(),se.now()),yi(t,c)&&(a=a.insert(u,c))}),a})}}class ep{constructor(e){this.serializer=e,this.ur=new Map,this.cr=new Map}getBundleMetadata(e,t){return g.resolve(this.ur.get(t))}saveBundleMetadata(e,t){return this.ur.set(t.id,{id:(i=t).id,version:i.version,createTime:de(i.createTime)}),g.resolve();var i}getNamedQuery(e,t){return g.resolve(this.cr.get(t))}saveNamedQuery(e,t){return this.cr.set(t.name,{name:(i=t).name,query:ya(i.bundledQuery),readTime:de(i.readTime)}),g.resolve();var i}}class tp{constructor(){this.overlays=new ee(C.comparator),this.lr=new Map}getOverlay(e,t){return g.resolve(this.overlays.get(t))}getOverlays(e,t){const r=ct();return g.forEach(t,i=>this.getOverlay(e,i).next(s=>{null!==s&&r.set(i,s)})).next(()=>r)}saveOverlays(e,t,r){return r.forEach((i,s)=>{this.lt(e,t,s)}),g.resolve()}removeOverlaysForBatchId(e,t,r){const i=this.lr.get(r);return void 0!==i&&(i.forEach(s=>this.overlays=this.overlays.remove(s)),this.lr.delete(r)),g.resolve()}getOverlaysForCollection(e,t,r){const i=ct(),s=t.length+1,o=new C(t.child("")),a=this.overlays.getIteratorFrom(o);for(;a.hasNext();){const u=a.getNext().value,c=u.getKey();if(!t.isPrefixOf(c.path))break;c.path.length===s&&u.largestBatchId>r&&i.set(u.getKey(),u)}return g.resolve(i)}getOverlaysForCollectionGroup(e,t,r,i){let s=new ee((c,l)=>c-l);const o=this.overlays.getIterator();for(;o.hasNext();){const c=o.getNext().value;if(c.getKey().getCollectionGroup()===t&&c.largestBatchId>r){let l=s.get(c.largestBatchId);null===l&&(l=ct(),s=s.insert(c.largestBatchId,l)),l.set(c.getKey(),c)}}const a=ct(),u=s.getIterator();for(;u.hasNext()&&(u.getNext().value.forEach((c,l)=>a.set(c,l)),!(a.size()>=i)););return g.resolve(a)}lt(e,t,r){const i=this.overlays.get(r.key);if(null!==i){const o=this.lr.get(i.largestBatchId).delete(r.key);this.lr.set(i.largestBatchId,o)}this.overlays=this.overlays.insert(r.key,new la(t,r));let s=this.lr.get(t);void 0===s&&(s=B(),this.lr.set(t,s)),this.lr.set(t,s.add(r.key))}}class Ra{constructor(){this.hr=new Y(we.Pr),this.Ir=new Y(we.Tr)}isEmpty(){return this.hr.isEmpty()}addReference(e,t){const r=new we(e,t);this.hr=this.hr.add(r),this.Ir=this.Ir.add(r)}Er(e,t){e.forEach(r=>this.addReference(r,t))}removeReference(e,t){this.dr(new we(e,t))}Ar(e,t){e.forEach(r=>this.removeReference(r,t))}Rr(e){const t=new C(new K([])),r=new we(t,e),i=new we(t,e+1),s=[];return this.Ir.forEachInRange([r,i],o=>{this.dr(o),s.push(o.key)}),s}Vr(){this.hr.forEach(e=>this.dr(e))}dr(e){this.hr=this.hr.delete(e),this.Ir=this.Ir.delete(e)}mr(e){const t=new C(new K([])),r=new we(t,e),i=new we(t,e+1);let s=B();return this.Ir.forEachInRange([r,i],o=>{s=s.add(o.key)}),s}containsKey(e){const t=new we(e,0),r=this.hr.firstAfterOrEqual(t);return null!==r&&e.isEqual(r.key)}}class we{constructor(e,t){this.key=e,this.gr=t}static Pr(e,t){return C.comparator(e.key,t.key)||O(e.gr,t.gr)}static Tr(e,t){return O(e.gr,t.gr)||C.comparator(e.key,t.key)}}class np{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.pr=1,this.yr=new Y(we.Pr)}checkEmpty(e){return g.resolve(0===this.mutationQueue.length)}addMutationBatch(e,t,r,i){const s=this.pr;this.pr++;const o=new ua(s,t,r,i);this.mutationQueue.push(o);for(const a of i)this.yr=this.yr.add(new we(a.key,s)),this.indexManager.addToCollectionParentIndex(e,a.key.path.popLast());return g.resolve(o)}lookupMutationBatch(e,t){return g.resolve(this.wr(t))}getNextMutationBatchAfterBatchId(e,t){const i=this.Sr(t+1),s=i<0?0:i;return g.resolve(this.mutationQueue.length>s?this.mutationQueue[s]:null)}getHighestUnacknowledgedBatchId(){return g.resolve(0===this.mutationQueue.length?-1:this.pr-1)}getAllMutationBatches(e){return g.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const r=new we(t,0),i=new we(t,Number.POSITIVE_INFINITY),s=[];return this.yr.forEachInRange([r,i],o=>{const a=this.wr(o.gr);s.push(a)}),g.resolve(s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new Y(O);return t.forEach(i=>{const s=new we(i,0),o=new we(i,Number.POSITIVE_INFINITY);this.yr.forEachInRange([s,o],a=>{r=r.add(a.gr)})}),g.resolve(this.br(r))}getAllMutationBatchesAffectingQuery(e,t){const r=t.path,i=r.length+1;let s=r;C.isDocumentKey(s)||(s=s.child(""));const o=new we(new C(s),0);let a=new Y(O);return this.yr.forEachWhile(u=>{const c=u.key.path;return!!r.isPrefixOf(c)&&(c.length===i&&(a=a.add(u.gr)),!0)},o),g.resolve(this.br(a))}br(e){const t=[];return e.forEach(r=>{const i=this.wr(r);null!==i&&t.push(i)}),t}removeMutationBatch(e,t){b(0===this.Dr(t.batchId,"removed")),this.mutationQueue.shift();let r=this.yr;return g.forEach(t.mutations,i=>{const s=new we(i.key,t.batchId);return r=r.delete(s),this.referenceDelegate.markPotentiallyOrphaned(e,i.key)}).next(()=>{this.yr=r})}Fn(e){}containsKey(e,t){const r=new we(t,0),i=this.yr.firstAfterOrEqual(r);return g.resolve(t.isEqual(i&&i.key))}performConsistencyCheck(e){return g.resolve()}Dr(e,t){return this.Sr(e)}Sr(e){return 0===this.mutationQueue.length?0:e-this.mutationQueue[0].batchId}wr(e){const t=this.Sr(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}class rp{constructor(e){this.Cr=e,this.docs=new ee(C.comparator),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const r=t.key,i=this.docs.get(r),s=i?i.size:0,o=this.Cr(t);return this.docs=this.docs.insert(r,{document:t.mutableCopy(),size:o}),this.size+=o-s,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const r=this.docs.get(t);return g.resolve(r?r.document.mutableCopy():ie.newInvalidDocument(t))}getEntries(e,t){let r=ze();return t.forEach(i=>{const s=this.docs.get(i);r=r.insert(i,s?s.document.mutableCopy():ie.newInvalidDocument(i))}),g.resolve(r)}getDocumentsMatchingQuery(e,t,r,i){let s=ze();const o=t.path,a=new C(o.child("")),u=this.docs.getIteratorFrom(a);for(;u.hasNext();){const{key:c,value:{document:l}}=u.getNext();if(!o.isPrefixOf(c.path))break;c.path.length>o.length+1||Wo(pl(l),r)<=0||(i.has(l.key)||yi(t,l))&&(s=s.insert(l.key,l.mutableCopy()))}return g.resolve(s)}getAllFromCollectionGroup(e,t,r,i){D()}vr(e,t){return g.forEach(this.docs,r=>t(r))}newChangeBuffer(e){return new ip(this)}getSize(e){return g.resolve(this.size)}}class ip extends ld{constructor(e){super(),this._r=e}applyChanges(e){const t=[];return this.changes.forEach((r,i)=>{i.isValidDocument()?t.push(this._r.addEntry(e,i)):this._r.removeEntry(r)}),g.waitFor(t)}getFromCache(e,t){return this._r.getEntry(e,t)}getAllFromCache(e,t){return this._r.getEntries(e,t)}}class sp{constructor(e){this.persistence=e,this.Fr=new At(t=>ln(t),pi),this.lastRemoteSnapshotVersion=N.min(),this.highestTargetId=0,this.Mr=0,this.Or=new Ra,this.targetCount=0,this.Nr=yn.On()}forEachTarget(e,t){return this.Fr.forEach((r,i)=>t(i)),g.resolve()}getLastRemoteSnapshotVersion(e){return g.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return g.resolve(this.Mr)}allocateTargetId(e){return this.highestTargetId=this.Nr.next(),g.resolve(this.highestTargetId)}setTargetsMetadata(e,t,r){return r&&(this.lastRemoteSnapshotVersion=r),t>this.Mr&&(this.Mr=t),g.resolve()}kn(e){this.Fr.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.Nr=new yn(t),this.highestTargetId=t),e.sequenceNumber>this.Mr&&(this.Mr=e.sequenceNumber)}addTargetData(e,t){return this.kn(t),this.targetCount+=1,g.resolve()}updateTargetData(e,t){return this.kn(t),g.resolve()}removeTargetData(e,t){return this.Fr.delete(t.target),this.Or.Rr(t.targetId),this.targetCount-=1,g.resolve()}removeTargets(e,t,r){let i=0;const s=[];return this.Fr.forEach((o,a)=>{a.sequenceNumber<=t&&null===r.get(a.targetId)&&(this.Fr.delete(o),s.push(this.removeMatchingKeysForTargetId(e,a.targetId)),i++)}),g.waitFor(s).next(()=>i)}getTargetCount(e){return g.resolve(this.targetCount)}getTargetData(e,t){const r=this.Fr.get(t)||null;return g.resolve(r)}addMatchingKeys(e,t,r){return this.Or.Er(t,r),g.resolve()}removeMatchingKeys(e,t,r){this.Or.Ar(t,r);const i=this.persistence.referenceDelegate,s=[];return i&&t.forEach(o=>{s.push(i.markPotentiallyOrphaned(e,o))}),g.waitFor(s)}removeMatchingKeysForTargetId(e,t){return this.Or.Rr(t),g.resolve()}getMatchingKeysForTargetId(e,t){const r=this.Or.mr(t);return g.resolve(r)}containsKey(e,t){return g.resolve(this.Or.containsKey(t))}}class Pa{constructor(e,t){this.Lr={},this.overlays={},this.Br=new $e(0),this.kr=!1,this.kr=!0,this.referenceDelegate=e(this),this.qr=new sp(this),this.indexManager=new jg,this.remoteDocumentCache=new rp(r=>this.referenceDelegate.Qr(r)),this.serializer=new Uh(t),this.Kr=new ep(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.kr=!1,Promise.resolve()}get started(){return this.kr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new tp,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let r=this.Lr[e.toKey()];return r||(r=new np(t,this.referenceDelegate),this.Lr[e.toKey()]=r),r}getTargetCache(){return this.qr}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Kr}runTransaction(e,t,r){A("MemoryPersistence","Starting transaction:",e);const i=new op(this.Br.next());return this.referenceDelegate.$r(),r(i).next(s=>this.referenceDelegate.Ur(i).next(()=>s)).toPromise().then(s=>(i.raiseOnCommittedEvent(),s))}Wr(e,t){return g.or(Object.values(this.Lr).map(r=>()=>r.containsKey(e,t)))}}class op extends yl{constructor(e){super(),this.currentSequenceNumber=e}}class Ws{constructor(e){this.persistence=e,this.Gr=new Ra,this.zr=null}static jr(e){return new Ws(e)}get Hr(){if(this.zr)return this.zr;throw D()}addReference(e,t,r){return this.Gr.addReference(r,t),this.Hr.delete(r.toString()),g.resolve()}removeReference(e,t,r){return this.Gr.removeReference(r,t),this.Hr.add(r.toString()),g.resolve()}markPotentiallyOrphaned(e,t){return this.Hr.add(t.toString()),g.resolve()}removeTarget(e,t){this.Gr.Rr(t.targetId).forEach(i=>this.Hr.add(i.toString()));const r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,t.targetId).next(i=>{i.forEach(s=>this.Hr.add(s.toString()))}).next(()=>r.removeTargetData(e,t))}$r(){this.zr=new Set}Ur(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return g.forEach(this.Hr,r=>{const i=C.fromPath(r);return this.Jr(e,i).next(s=>{s||t.removeEntry(i,N.min())})}).next(()=>(this.zr=null,t.apply(e)))}updateLimboDocument(e,t){return this.Jr(e,t).next(r=>{r?this.Hr.delete(t.toString()):this.Hr.add(t.toString())})}Qr(e){return 0}Jr(e,t){return g.or([()=>g.resolve(this.Gr.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Wr(e,t)])}}class ap{constructor(e){this.serializer=e}O(e,t,r,i){const s=new Rs("createOrUpgrade",t);var u;r<1&&i>=1&&(e.createObjectStore("owner"),(u=e).createObjectStore("mutationQueues",{keyPath:"userId"}),u.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",Al,{unique:!0}),u.createObjectStore("documentMutations"),pd(e),function(u){u.createObjectStore("remoteDocuments")}(e));let o=g.resolve();return r<3&&i>=3&&(0!==r&&(function(u){u.deleteObjectStore("targetDocuments"),u.deleteObjectStore("targets"),u.deleteObjectStore("targetGlobal")}(e),pd(e)),o=o.next(()=>function(u){const c=u.store("targetGlobal"),l={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:N.min().toTimestamp(),targetCount:0};return c.put("targetGlobalKey",l)}(s))),r<4&&i>=4&&(0!==r&&(o=o.next(()=>function(u,c){return c.store("mutations").U().next(l=>{u.deleteObjectStore("mutations"),u.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",Al,{unique:!0});const d=c.store("mutations"),m=l.map(p=>d.put(p));return g.waitFor(m)})}(e,s))),o=o.next(()=>{!function(u){u.createObjectStore("clientMetadata",{keyPath:"clientId"})}(e)})),r<5&&i>=5&&(o=o.next(()=>this.Zr(s))),r<6&&i>=6&&(o=o.next(()=>(function(u){u.createObjectStore("remoteDocumentGlobal")}(e),this.Xr(s)))),r<7&&i>=7&&(o=o.next(()=>this.ei(s))),r<8&&i>=8&&(o=o.next(()=>this.ti(e,s))),r<9&&i>=9&&(o=o.next(()=>{!function(u){u.objectStoreNames.contains("remoteDocumentChanges")&&u.deleteObjectStore("remoteDocumentChanges")}(e)})),r<10&&i>=10&&(o=o.next(()=>this.ni(s))),r<11&&i>=11&&(o=o.next(()=>{(function(u){u.createObjectStore("bundles",{keyPath:"bundleId"})})(e),function(u){u.createObjectStore("namedQueries",{keyPath:"name"})}(e)})),r<12&&i>=12&&(o=o.next(()=>{!function(u){const c=u.createObjectStore("documentOverlays",{keyPath:$m});c.createIndex("collectionPathOverlayIndex",Qm,{unique:!1}),c.createIndex("collectionGroupOverlayIndex",Wm,{unique:!1})}(e)})),r<13&&i>=13&&(o=o.next(()=>function(u){const c=u.createObjectStore("remoteDocumentsV14",{keyPath:Fm});c.createIndex("documentKeyIndex",Mm),c.createIndex("collectionGroupIndex",Om)}(e)).next(()=>this.ri(e,s)).next(()=>e.deleteObjectStore("remoteDocuments"))),r<14&&i>=14&&(o=o.next(()=>this.ii(e,s))),r<15&&i>=15&&(o=o.next(()=>function(u){u.createObjectStore("indexConfiguration",{keyPath:"indexId",autoIncrement:!0}).createIndex("collectionGroupIndex","collectionGroup",{unique:!1}),u.createObjectStore("indexState",{keyPath:Gm}).createIndex("sequenceNumberIndex",zm,{unique:!1}),u.createObjectStore("indexEntries",{keyPath:Km}).createIndex("documentKeyIndex",jm,{unique:!1})}(e))),r<16&&i>=16&&(o=o.next(()=>{t.objectStore("indexState").clear()}).next(()=>{t.objectStore("indexEntries").clear()})),o}Xr(e){let t=0;return e.store("remoteDocuments").J((r,i)=>{t+=js(i)}).next(()=>{const r={byteSize:t};return e.store("remoteDocumentGlobal").put("remoteDocumentGlobalKey",r)})}Zr(e){const t=e.store("mutationQueues"),r=e.store("mutations");return t.U().next(i=>g.forEach(i,s=>{const o=IDBKeyRange.bound([s.userId,-1],[s.userId,s.lastAcknowledgedBatchId]);return r.U("userMutationsIndex",o).next(a=>g.forEach(a,u=>{b(u.userId===s.userId);const c=gn(this.serializer,u);return rd(e,s.userId,c).next(()=>{})}))}))}ei(e){const t=e.store("targetDocuments"),r=e.store("remoteDocuments");return e.store("targetGlobal").get("targetGlobalKey").next(i=>{const s=[];return r.J((o,a)=>{const u=new K(o),c=[0,Ne(u)];s.push(t.get(c).next(l=>l?g.resolve():t.put({targetId:0,path:Ne(u),sequenceNumber:i.highestListenSequenceNumber})))}).next(()=>g.waitFor(s))})}ti(e,t){e.createObjectStore("collectionParents",{keyPath:Um});const r=t.store("collectionParents"),i=new wa,s=o=>{if(i.add(o)){const a=o.lastSegment(),u=o.popLast();return r.put({collectionId:a,parent:Ne(u)})}};return t.store("remoteDocuments").J({H:!0},(o,a)=>{const u=new K(o);return s(u.popLast())}).next(()=>t.store("documentMutations").J({H:!0},([o,a,u],c)=>{const l=at(a);return s(l.popLast())}))}ni(e){const t=e.store("targets");return t.J((r,i)=>{const s=Vi(i),o=zh(this.serializer,s);return t.put(o)})}ri(e,t){const r=t.store("remoteDocuments"),i=[];return r.J((s,o)=>{const a=t.store("remoteDocumentsV14"),u=(d=o,d.document?new C(K.fromString(d.document.name).popFirst(5)):d.noDocument?C.fromSegments(d.noDocument.path):d.unknownDocument?C.fromSegments(d.unknownDocument.path):D()).path.toArray(),c={prefixPath:u.slice(0,u.length-2),collectionGroup:u[u.length-2],documentId:u[u.length-1],readTime:o.readTime||[0,0],unknownDocument:o.unknownDocument,noDocument:o.noDocument,document:o.document,hasCommittedMutations:!!o.hasCommittedMutations};var d;i.push(a.put(c))}).next(()=>g.waitFor(i))}ii(e,t){const r=t.store("mutations"),i=hd(this.serializer),s=new Pa(Ws.jr,this.serializer.ut);return r.U().next(o=>{const a=new Map;return o.forEach(u=>{var c;let l=null!==(c=a.get(u.userId))&&void 0!==c?c:B();gn(this.serializer,u).keys().forEach(d=>l=l.add(d)),a.set(u.userId,l)}),g.forEach(a,(u,c)=>{const l=new ve(c),d=Gs.ct(this.serializer,l),m=s.getIndexManager(l),p=$s.ct(l,this.serializer,m,s.referenceDelegate);return new gd(i,p,d,m).recalculateAndSaveOverlaysForDocumentKeys(new Jo(t,$e.oe),u).next()})})}}function pd(n){n.createObjectStore("targetDocuments",{keyPath:Bm}).createIndex("documentTargetsIndex",qm,{unique:!0}),n.createObjectStore("targets",{keyPath:"targetId"}).createIndex("queryTargetsIndex",Lm,{unique:!0}),n.createObjectStore("targetGlobal")}const Sa="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.";class Va{constructor(e,t,r,i,s,o,a,u,c,l,d=16){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=r,this.si=s,this.window=o,this.document=a,this.oi=c,this._i=l,this.ai=d,this.Br=null,this.kr=!1,this.isPrimary=!1,this.networkEnabled=!0,this.ui=null,this.inForeground=!1,this.ci=null,this.li=null,this.hi=Number.NEGATIVE_INFINITY,this.Pi=m=>Promise.resolve(),!Va.D())throw new v(_.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new Zg(this,i),this.Ii=t+"main",this.serializer=new Uh(u),this.Ti=new ot(this.Ii,this.ai,new ap(this.serializer)),this.qr=new Qg(this.referenceDelegate,this.serializer),this.remoteDocumentCache=hd(this.serializer),this.Kr=new Bg,this.window&&this.window.localStorage?this.Ei=this.window.localStorage:(this.Ei=null,!1===l&&he("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.di().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new v(_.FAILED_PRECONDITION,Sa);return this.Ai(),this.Ri(),this.Vi(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.qr.getHighestSequenceNumber(e))}).then(e=>{this.Br=new $e(e,this.oi)}).then(()=>{this.kr=!0}).catch(e=>(this.Ti&&this.Ti.close(),Promise.reject(e)))}mi(e){var t=this;return this.Pi=function(){var r=(0,y.Z)(function*(i){if(t.started)return e(i)});return function(i){return r.apply(this,arguments)}}(),e(this.isPrimary)}setDatabaseDeletedListener(e){this.Ti.L(function(){var t=(0,y.Z)(function*(r){null===r.newVersion&&(yield e())});return function(r){return t.apply(this,arguments)}}())}setNetworkEnabled(e){var t=this;this.networkEnabled!==e&&(this.networkEnabled=e,this.si.enqueueAndForget((0,y.Z)(function*(){t.started&&(yield t.di())})))}di(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",e=>Zs(e).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.fi(e).next(t=>{t||(this.isPrimary=!1,this.si.enqueueRetryable(()=>this.Pi(!1)))})}).next(()=>this.gi(e)).next(t=>this.isPrimary&&!t?this.pi(e).next(()=>!1):!!t&&this.yi(e).next(()=>!0))).catch(e=>{if(Mt(e))return A("IndexedDbPersistence","Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return A("IndexedDbPersistence","Releasing owner lease after error during lease refresh",e),!1}).then(e=>{this.isPrimary!==e&&this.si.enqueueRetryable(()=>this.Pi(e)),this.isPrimary=e})}fi(e){return Ni(e).get("owner").next(t=>g.resolve(this.wi(t)))}Si(e){return Zs(e).delete(this.clientId)}bi(){var e=this;return(0,y.Z)(function*(){if(e.isPrimary&&!e.Di(e.hi,18e5)){e.hi=Date.now();const t=yield e.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",r=>{const i=Ae(r,"clientMetadata");return i.U().next(s=>{const o=e.Ci(s,18e5),a=s.filter(u=>-1===o.indexOf(u));return g.forEach(a,u=>i.delete(u.clientId)).next(()=>a)})}).catch(()=>[]);if(e.Ei)for(const r of t)e.Ei.removeItem(e.vi(r.clientId))}})()}Vi(){this.li=this.si.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.di().then(()=>this.bi()).then(()=>this.Vi()))}wi(e){return!!e&&e.ownerId===this.clientId}gi(e){return this._i?g.resolve(!0):Ni(e).get("owner").next(t=>{if(null!==t&&this.Di(t.leaseTimestampMs,5e3)&&!this.Fi(t.ownerId)){if(this.wi(t)&&this.networkEnabled)return!0;if(!this.wi(t)){if(!t.allowTabSynchronization)throw new v(_.FAILED_PRECONDITION,Sa);return!1}}return!(!this.networkEnabled||!this.inForeground)||Zs(e).U().next(r=>void 0===this.Ci(r,5e3).find(i=>!(this.clientId===i.clientId||!(!this.networkEnabled&&i.networkEnabled||!this.inForeground&&i.inForeground&&this.networkEnabled===i.networkEnabled))))}).next(t=>(this.isPrimary!==t&&A("IndexedDbPersistence",`Client ${t?"is":"is not"} eligible for a primary lease.`),t))}shutdown(){var e=this;return(0,y.Z)(function*(){e.kr=!1,e.Mi(),e.li&&(e.li.cancel(),e.li=null),e.xi(),e.Oi(),yield e.Ti.runTransaction("shutdown","readwrite",["owner","clientMetadata"],t=>{const r=new Jo(t,$e.oe);return e.pi(r).next(()=>e.Si(r))}),e.Ti.close(),e.Ni()})()}Ci(e,t){return e.filter(r=>this.Di(r.updateTimeMs,t)&&!this.Fi(r.clientId))}Li(){return this.runTransaction("getActiveClients","readonly",e=>Zs(e).U().next(t=>this.Ci(t,18e5).map(r=>r.clientId)))}get started(){return this.kr}getMutationQueue(e,t){return $s.ct(e,this.serializer,t,this.referenceDelegate)}getTargetCache(){return this.qr}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new $g(e,this.serializer.ut.databaseId)}getDocumentOverlayCache(e){return Gs.ct(this.serializer,e)}getBundleCache(){return this.Kr}runTransaction(e,t,r){A("IndexedDbPersistence","Starting transaction:",e);const i="readonly"===t?"readonly":"readwrite",s=16===(u=this.ai)?Zm:15===u?Vl:14===u?Sl:13===u?Pl:12===u?Hm:11===u?Rl:void D();var u;let o;return this.Ti.runTransaction(e,i,s,a=>(o=new Jo(a,this.Br?this.Br.next():$e.oe),"readwrite-primary"===t?this.fi(o).next(u=>!!u||this.gi(o)).next(u=>{if(!u)throw he(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.si.enqueueRetryable(()=>this.Pi(!1)),new v(_.FAILED_PRECONDITION,_l);return r(o)}).next(u=>this.yi(o).next(()=>u)):this.Bi(o).next(()=>r(o)))).then(a=>(o.raiseOnCommittedEvent(),a))}Bi(e){return Ni(e).get("owner").next(t=>{if(null!==t&&this.Di(t.leaseTimestampMs,5e3)&&!this.Fi(t.ownerId)&&!this.wi(t)&&!(this._i||this.allowTabSynchronization&&t.allowTabSynchronization))throw new v(_.FAILED_PRECONDITION,Sa)})}yi(e){const t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return Ni(e).put("owner",t)}static D(){return ot.D()}pi(e){const t=Ni(e);return t.get("owner").next(r=>this.wi(r)?(A("IndexedDbPersistence","Releasing primary lease."),t.delete("owner")):g.resolve())}Di(e,t){const r=Date.now();return!(e<r-t||e>r&&(he(`Detected an update time that is in the future: ${e} > ${r}`),1))}Ai(){null!==this.document&&"function"==typeof this.document.addEventListener&&(this.ci=()=>{this.si.enqueueAndForget(()=>(this.inForeground="visible"===this.document.visibilityState,this.di()))},this.document.addEventListener("visibilitychange",this.ci),this.inForeground="visible"===this.document.visibilityState)}xi(){this.ci&&(this.document.removeEventListener("visibilitychange",this.ci),this.ci=null)}Ri(){var e;"function"==typeof(null===(e=this.window)||void 0===e?void 0:e.addEventListener)&&(this.ui=()=>{this.Mi();const t=/(?:Version|Mobile)\/1[456]/;(0,U.G6)()&&(navigator.appVersion.match(t)||navigator.userAgent.match(t))&&this.si.enterRestrictedMode(!0),this.si.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.ui))}Oi(){this.ui&&(this.window.removeEventListener("pagehide",this.ui),this.ui=null)}Fi(e){var t;try{const r=null!==(null===(t=this.Ei)||void 0===t?void 0:t.getItem(this.vi(e)));return A("IndexedDbPersistence",`Client '${e}' ${r?"is":"is not"} zombied in LocalStorage`),r}catch(r){return he("IndexedDbPersistence","Failed to get zombied client id.",r),!1}}Mi(){if(this.Ei)try{this.Ei.setItem(this.vi(this.clientId),String(Date.now()))}catch(e){he("Failed to set zombie client id.",e)}}Ni(){if(this.Ei)try{this.Ei.removeItem(this.vi(this.clientId))}catch{}}vi(e){return`firestore_zombie_${this.persistenceKey}_${e}`}}function Ni(n){return Ae(n,"owner")}function Zs(n){return Ae(n,"clientMetadata")}function xa(n,e){let t=n.projectId;return n.isDefaultDatabase||(t+="."+n.database),"firestore/"+e+"/"+t+"/"}class Ca{constructor(e,t,r,i){this.targetId=e,this.fromCache=t,this.ki=r,this.qi=i}static Qi(e,t){let r=B(),i=B();for(const s of t.docChanges)switch(s.type){case 0:r=r.add(s.doc.key);break;case 1:i=i.add(s.doc.key)}return new Ca(e,t.fromCache,r,i)}}class up{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}class _d{constructor(){this.Ki=!1,this.$i=!1,this.Ui=100,this.Wi=(0,U.G6)()?8:Il((0,U.z$)())>0?6:4}initialize(e,t){this.Gi=e,this.indexManager=t,this.Ki=!0}getDocumentsMatchingQuery(e,t,r,i){const s={result:null};return this.zi(e,t).next(o=>{s.result=o}).next(()=>{if(!s.result)return this.ji(e,t,i,r).next(o=>{s.result=o})}).next(()=>{if(s.result)return;const o=new up;return this.Hi(e,t,o).next(a=>{if(s.result=a,this.$i)return this.Ji(e,t,o,a.size)})}).next(()=>s.result)}Ji(e,t,r,i){return r.documentReadCount<this.Ui?(Qn()<=Pe.in.DEBUG&&A("QueryEngine","SDK will not create cache indexes for query:",nr(t),"since it only creates cache indexes for collection contains","more than or equal to",this.Ui,"documents"),g.resolve()):(Qn()<=Pe.in.DEBUG&&A("QueryEngine","Query:",nr(t),"scans",r.documentReadCount,"local documents and returns",i,"documents as results."),r.documentReadCount>this.Wi*i?(Qn()<=Pe.in.DEBUG&&A("QueryEngine","The SDK decides to create cache indexes for query:",nr(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,Le(t))):g.resolve())}zi(e,t){if(Yl(t))return g.resolve(null);let r=Le(t);return this.indexManager.getIndexType(e,r).next(i=>0===i?null:(null!==t.limit&&1===i&&(t=Fs(t,null,"F"),r=Le(t)),this.indexManager.getDocumentsMatchingTarget(e,r).next(s=>{const o=B(...s);return this.Gi.getDocuments(e,o).next(a=>this.indexManager.getMinOffset(e,r).next(u=>{const c=this.Yi(t,a);return this.Zi(t,c,o,u.readTime)?this.zi(e,Fs(t,null,"F")):this.Xi(e,c,t,u)}))})))}ji(e,t,r,i){return Yl(t)||i.isEqual(N.min())?g.resolve(null):this.Gi.getDocuments(e,r).next(s=>{const o=this.Yi(t,s);return this.Zi(t,o,r,i)?g.resolve(null):(Qn()<=Pe.in.DEBUG&&A("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),nr(t)),this.Xi(e,o,t,gl(i,-1)).next(a=>a))})}Yi(e,t){let r=new Y(nh(e));return t.forEach((i,s)=>{yi(e,s)&&(r=r.add(s))}),r}Zi(e,t,r,i){if(null===e.limit)return!1;if(r.size!==t.size)return!0;const s="F"===e.limitType?t.last():t.first();return!!s&&(s.hasPendingWrites||s.version.compareTo(i)>0)}Hi(e,t,r){return Qn()<=Pe.in.DEBUG&&A("QueryEngine","Using full collection scan to execute query:",nr(t)),this.Gi.getDocumentsMatchingQuery(e,t,je.min(),r)}Xi(e,t,r,i){return this.Gi.getDocumentsMatchingQuery(e,r,i).next(s=>(t.forEach(o=>{s=s.insert(o.key,o)}),s))}}class cp{constructor(e,t,r,i){this.persistence=e,this.es=t,this.serializer=i,this.ts=new ee(O),this.ns=new At(s=>ln(s),pi),this.rs=new Map,this.ss=e.getRemoteDocumentCache(),this.qr=e.getTargetCache(),this.Kr=e.getBundleCache(),this.os(r)}os(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new gd(this.ss,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.ss.setIndexManager(this.indexManager),this.es.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.ts))}}function yd(n,e,t,r){return new cp(n,e,t,r)}function Id(n,e){return Da.apply(this,arguments)}function Da(){return Da=(0,y.Z)(function*(n,e){const t=S(n);return yield t.persistence.runTransaction("Handle user change","readonly",r=>{let i;return t.mutationQueue.getAllMutationBatches(r).next(s=>(i=s,t.os(e),t.mutationQueue.getAllMutationBatches(r))).next(s=>{const o=[],a=[];let u=B();for(const c of i){o.push(c.batchId);for(const l of c.mutations)u=u.add(l.key)}for(const c of s){a.push(c.batchId);for(const l of c.mutations)u=u.add(l.key)}return t.localDocuments.getDocuments(r,u).next(c=>({_s:c,removedBatchIds:o,addedBatchIds:a}))})})}),Da.apply(this,arguments)}function Td(n){const e=S(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.qr.getLastRemoteSnapshotVersion(t))}function Ed(n,e,t){let r=B(),i=B();return t.forEach(s=>r=r.add(s)),e.getEntries(n,r).next(s=>{let o=ze();return t.forEach((a,u)=>{const c=s.get(a);u.isFoundDocument()!==c.isFoundDocument()&&(i=i.add(a)),u.isNoDocument()&&u.version.isEqual(N.min())?(e.removeEntry(a,u.readTime),o=o.insert(a,u)):!c.isValidDocument()||u.version.compareTo(c.version)>0||0===u.version.compareTo(c.version)&&c.hasPendingWrites?(e.addEntry(u),o=o.insert(a,u)):A("LocalStore","Ignoring outdated watch update for ",a,". Current version:",c.version," Watch version:",u.version)}),{us:o,cs:i}})}function dp(n,e){const t=S(n);return t.persistence.runTransaction("Get next mutation batch","readonly",r=>(void 0===e&&(e=-1),t.mutationQueue.getNextMutationBatchAfterBatchId(r,e)))}function fr(n,e){const t=S(n);return t.persistence.runTransaction("Allocate target","readwrite",r=>{let i;return t.qr.getTargetData(r,e).next(s=>s?(i=s,g.resolve(i)):t.qr.allocateTargetId(r).next(o=>(i=new Rt(e,o,"TargetPurposeListen",r.currentSequenceNumber),t.qr.addTargetData(r,i).next(()=>i))))}).then(r=>{const i=t.ts.get(r.targetId);return(null===i||r.snapshotVersion.compareTo(i.snapshotVersion)>0)&&(t.ts=t.ts.insert(r.targetId,r),t.ns.set(e,r.targetId)),r})}function mr(n,e,t){return ba.apply(this,arguments)}function ba(){return ba=(0,y.Z)(function*(n,e,t){const r=S(n),i=r.ts.get(e),s=t?"readwrite":"readwrite-primary";try{t||(yield r.persistence.runTransaction("Release target",s,o=>r.persistence.referenceDelegate.removeTarget(o,i)))}catch(o){if(!Mt(o))throw o;A("LocalStore",`Failed to update sequence numbers for target ${e}: ${o}`)}r.ts=r.ts.remove(e),r.ns.delete(i.target)}),ba.apply(this,arguments)}function Js(n,e,t){const r=S(n);let i=N.min(),s=B();return r.persistence.runTransaction("Execute query","readwrite",o=>function(u,c,l){const d=S(u),m=d.ns.get(l);return void 0!==m?g.resolve(d.ts.get(m)):d.qr.getTargetData(c,l)}(r,o,Le(e)).next(a=>{if(a)return i=a.lastLimboFreeSnapshotVersion,r.qr.getMatchingKeysForTargetId(o,a.targetId).next(u=>{s=u})}).next(()=>r.es.getDocumentsMatchingQuery(o,e,t?i:N.min(),t?s:B())).next(a=>(wd(r,th(e),a),{documents:a,ls:s})))}function vd(n,e){const t=S(n),r=S(t.qr),i=t.ts.get(e);return i?Promise.resolve(i.target):t.persistence.runTransaction("Get target data","readonly",s=>r.ot(s,e).next(o=>o?o.target:null))}function Ad(n,e){const t=S(n),r=t.rs.get(e)||N.min();return t.persistence.runTransaction("Get new document changes","readonly",i=>t.ss.getAllFromCollectionGroup(i,e,gl(r,-1),Number.MAX_SAFE_INTEGER)).then(i=>(wd(t,e,i),i))}function wd(n,e,t){let r=n.rs.get(e)||N.min();t.forEach((i,s)=>{s.readTime.compareTo(r)>0&&(r=s.readTime)}),n.rs.set(e,r)}function Na(){return Na=(0,y.Z)(function*(n,e,t,r){const i=S(n);let s=B(),o=ze();for(const c of t){const l=e.hs(c.metadata.name);c.document&&(s=s.add(l));const d=e.Ps(c);d.setReadTime(e.Is(c.metadata.readTime)),o=o.insert(l,d)}const a=i.ss.newChangeBuffer({trackRemovals:!0}),u=yield fr(i,(l=r,Le(er(K.fromString(`__bundle__/docs/${l}`)))));var l;return i.persistence.runTransaction("Apply bundle documents","readwrite",c=>Ed(c,a,o).next(l=>(a.apply(c),l)).next(l=>i.qr.removeMatchingKeysForTargetId(c,u.targetId).next(()=>i.qr.addMatchingKeys(c,s,u.targetId)).next(()=>i.localDocuments.getLocalViewOfDocuments(c,l.us,l.cs)).next(()=>l.us)))}),Na.apply(this,arguments)}function mp(n,e){return ka.apply(this,arguments)}function ka(){return ka=(0,y.Z)(function*(n,e,t=B()){const r=yield fr(n,Le(ya(e.bundledQuery))),i=S(n);return i.persistence.runTransaction("Save named query","readwrite",s=>{const o=de(e.readTime);if(r.snapshotVersion.compareTo(o)>=0)return i.Kr.saveNamedQuery(s,e);const a=r.withResumeToken(Ie.EMPTY_BYTE_STRING,o);return i.ts=i.ts.insert(a.targetId,a),i.qr.updateTargetData(s,a).next(()=>i.qr.removeMatchingKeysForTargetId(s,r.targetId)).next(()=>i.qr.addMatchingKeys(s,t,r.targetId)).next(()=>i.Kr.saveNamedQuery(s,e))})}),ka.apply(this,arguments)}function Rd(n,e){return`firestore_clients_${n}_${e}`}function Pd(n,e,t){let r=`firestore_mutations_${n}_${t}`;return e.isAuthenticated()&&(r+=`_${e.uid}`),r}function Fa(n,e){return`firestore_targets_${n}_${e}`}class Ys{constructor(e,t,r,i){this.user=e,this.batchId=t,this.state=r,this.error=i}static Ts(e,t,r){const i=JSON.parse(r);let s,o="object"==typeof i&&-1!==["pending","acknowledged","rejected"].indexOf(i.state)&&(void 0===i.error||"object"==typeof i.error);return o&&i.error&&(o="string"==typeof i.error.message&&"string"==typeof i.error.code,o&&(s=new v(i.error.code,i.error.message))),o?new Ys(e,t,i.state,s):(he("SharedClientState",`Failed to parse mutation state for ID '${t}': ${r}`),null)}Es(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class ki{constructor(e,t,r){this.targetId=e,this.state=t,this.error=r}static Ts(e,t){const r=JSON.parse(t);let i,s="object"==typeof r&&-1!==["not-current","current","rejected"].indexOf(r.state)&&(void 0===r.error||"object"==typeof r.error);return s&&r.error&&(s="string"==typeof r.error.message&&"string"==typeof r.error.code,s&&(i=new v(r.error.code,r.error.message))),s?new ki(e,r.state,i):(he("SharedClientState",`Failed to parse target state for ID '${e}': ${t}`),null)}Es(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class Xs{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static Ts(e,t){const r=JSON.parse(t);let i="object"==typeof r&&r.activeTargetIds instanceof Array,s=oa();for(let o=0;i&&o<r.activeTargetIds.length;++o)i=El(r.activeTargetIds[o]),s=s.add(r.activeTargetIds[o]);return i?new Xs(e,s):(he("SharedClientState",`Failed to parse client data for instance '${e}': ${t}`),null)}}class Ma{constructor(e,t){this.clientId=e,this.onlineState=t}static Ts(e){const t=JSON.parse(e);return"object"==typeof t&&-1!==["Unknown","Online","Offline"].indexOf(t.onlineState)&&"string"==typeof t.clientId?new Ma(t.clientId,t.onlineState):(he("SharedClientState",`Failed to parse online state: ${e}`),null)}}class Oa{constructor(){this.activeTargetIds=oa()}ds(e){this.activeTargetIds=this.activeTargetIds.add(e)}As(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Es(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class La{constructor(e,t,r,i,s){this.window=e,this.si=t,this.persistenceKey=r,this.Rs=i,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.Vs=this.fs.bind(this),this.gs=new ee(O),this.started=!1,this.ps=[];const o=r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=s,this.ys=Rd(this.persistenceKey,this.Rs),this.ws=`firestore_sequence_number_${this.persistenceKey}`,this.gs=this.gs.insert(this.Rs,new Oa),this.Ss=new RegExp(`^firestore_clients_${o}_([^_]*)$`),this.bs=new RegExp(`^firestore_mutations_${o}_(\\d+)(?:_(.*))?$`),this.Ds=new RegExp(`^firestore_targets_${o}_(\\d+)$`),this.Cs=`firestore_online_state_${this.persistenceKey}`,this.vs=function(u){return`firestore_bundle_loaded_v2_${u}`}(this.persistenceKey),this.window.addEventListener("storage",this.Vs)}static D(e){return!(!e||!e.localStorage)}start(){var e=this;return(0,y.Z)(function*(){const t=yield e.syncEngine.Li();for(const i of t){if(i===e.Rs)continue;const s=e.getItem(Rd(e.persistenceKey,i));if(s){const o=Xs.Ts(i,s);o&&(e.gs=e.gs.insert(o.clientId,o))}}e.Fs();const r=e.storage.getItem(e.Cs);if(r){const i=e.Ms(r);i&&e.xs(i)}for(const i of e.ps)e.fs(i);e.ps=[],e.window.addEventListener("pagehide",()=>e.shutdown()),e.started=!0})()}writeSequenceNumber(e){this.setItem(this.ws,JSON.stringify(e))}getAllActiveQueryTargets(){return this.Os(this.gs)}isActiveQueryTarget(e){let t=!1;return this.gs.forEach((r,i)=>{i.activeTargetIds.has(e)&&(t=!0)}),t}addPendingMutation(e){this.Ns(e,"pending")}updateMutationState(e,t,r){this.Ns(e,t,r),this.Ls(e)}addLocalQueryTarget(e){let t="not-current";if(this.isActiveQueryTarget(e)){const r=this.storage.getItem(Fa(this.persistenceKey,e));if(r){const i=ki.Ts(e,r);i&&(t=i.state)}}return this.Bs.ds(e),this.Fs(),t}removeLocalQueryTarget(e){this.Bs.As(e),this.Fs()}isLocalQueryTarget(e){return this.Bs.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(Fa(this.persistenceKey,e))}updateQueryState(e,t,r){this.ks(e,t,r)}handleUserChange(e,t,r){t.forEach(i=>{this.Ls(i)}),this.currentUser=e,r.forEach(i=>{this.addPendingMutation(i)})}setOnlineState(e){this.qs(e)}notifyBundleLoaded(e){this.Qs(e)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.Vs),this.removeItem(this.ys),this.started=!1)}getItem(e){const t=this.storage.getItem(e);return A("SharedClientState","READ",e,t),t}setItem(e,t){A("SharedClientState","SET",e,t),this.storage.setItem(e,t)}removeItem(e){A("SharedClientState","REMOVE",e),this.storage.removeItem(e)}fs(e){var t=this;const r=e;if(r.storageArea===this.storage){if(A("SharedClientState","EVENT",r.key,r.newValue),r.key===this.ys)return void he("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.si.enqueueRetryable((0,y.Z)(function*(){if(t.started){if(null!==r.key)if(t.Ss.test(r.key)){if(null==r.newValue){const i=t.Ks(r.key);return t.$s(i,null)}{const i=t.Us(r.key,r.newValue);if(i)return t.$s(i.clientId,i)}}else if(t.bs.test(r.key)){if(null!==r.newValue){const i=t.Ws(r.key,r.newValue);if(i)return t.Gs(i)}}else if(t.Ds.test(r.key)){if(null!==r.newValue){const i=t.zs(r.key,r.newValue);if(i)return t.js(i)}}else if(r.key===t.Cs){if(null!==r.newValue){const i=t.Ms(r.newValue);if(i)return t.xs(i)}}else if(r.key===t.ws){const i=function(o){let a=$e.oe;if(null!=o)try{const u=JSON.parse(o);b("number"==typeof u),a=u}catch(u){he("SharedClientState","Failed to read sequence number from WebStorage",u)}return a}(r.newValue);i!==$e.oe&&t.sequenceNumberHandler(i)}else if(r.key===t.vs){const i=t.Hs(r.newValue);yield Promise.all(i.map(s=>t.syncEngine.Js(s)))}}else t.ps.push(r)}))}}get Bs(){return this.gs.get(this.Rs)}Fs(){this.setItem(this.ys,this.Bs.Es())}Ns(e,t,r){const i=new Ys(this.currentUser,e,t,r),s=Pd(this.persistenceKey,this.currentUser,e);this.setItem(s,i.Es())}Ls(e){const t=Pd(this.persistenceKey,this.currentUser,e);this.removeItem(t)}qs(e){this.storage.setItem(this.Cs,JSON.stringify({clientId:this.Rs,onlineState:e}))}ks(e,t,r){const i=Fa(this.persistenceKey,e),s=new ki(e,t,r);this.setItem(i,s.Es())}Qs(e){const t=JSON.stringify(Array.from(e));this.setItem(this.vs,t)}Ks(e){const t=this.Ss.exec(e);return t?t[1]:null}Us(e,t){const r=this.Ks(e);return Xs.Ts(r,t)}Ws(e,t){const r=this.bs.exec(e),i=Number(r[1]);return Ys.Ts(new ve(void 0!==r[2]?r[2]:null),i,t)}zs(e,t){const r=this.Ds.exec(e),i=Number(r[1]);return ki.Ts(i,t)}Ms(e){return Ma.Ts(e)}Hs(e){return JSON.parse(e)}Gs(e){var t=this;return(0,y.Z)(function*(){if(e.user.uid===t.currentUser.uid)return t.syncEngine.Ys(e.batchId,e.state,e.error);A("SharedClientState",`Ignoring mutation for non-active user ${e.user.uid}`)})()}js(e){return this.syncEngine.Zs(e.targetId,e.state,e.error)}$s(e,t){const r=t?this.gs.insert(e,t):this.gs.remove(e),i=this.Os(this.gs),s=this.Os(r),o=[],a=[];return s.forEach(u=>{i.has(u)||o.push(u)}),i.forEach(u=>{s.has(u)||a.push(u)}),this.syncEngine.Xs(o,a).then(()=>{this.gs=r})}xs(e){this.gs.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}Os(e){let t=oa();return e.forEach((r,i)=>{t=t.unionWith(i.activeTargetIds)}),t}}class Sd{constructor(){this.eo=new Oa,this.no={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,r){}addLocalQueryTarget(e){return this.eo.ds(e),this.no[e]||"not-current"}updateQueryState(e,t,r){this.no[e]=t}removeLocalQueryTarget(e){this.eo.As(e)}isLocalQueryTarget(e){return this.eo.activeTargetIds.has(e)}clearQueryState(e){delete this.no[e]}getAllActiveQueryTargets(){return this.eo.activeTargetIds}isActiveQueryTarget(e){return this.eo.activeTargetIds.has(e)}start(){return this.eo=new Oa,Promise.resolve()}handleUserChange(e,t,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class gp{ro(e){}shutdown(){}}class Vd{constructor(){this.io=()=>this.so(),this.oo=()=>this._o(),this.ao=[],this.uo()}ro(e){this.ao.push(e)}shutdown(){window.removeEventListener("online",this.io),window.removeEventListener("offline",this.oo)}uo(){window.addEventListener("online",this.io),window.addEventListener("offline",this.oo)}so(){A("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const e of this.ao)e(0)}_o(){A("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const e of this.ao)e(1)}static D(){return typeof window<"u"&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}let eo=null;function Ba(){return null===eo?eo=268435456+Math.round(2147483648*Math.random()):eo++,"0x"+eo.toString(16)}const pp={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class _p{constructor(e){this.co=e.co,this.lo=e.lo}ho(e){this.Po=e}Io(e){this.To=e}Eo(e){this.Ao=e}onMessage(e){this.Ro=e}close(){this.lo()}send(e){this.co(e)}Vo(){this.Po()}mo(){this.To()}fo(e){this.Ao(e)}po(e){this.Ro(e)}}const Fe="WebChannelConnection";class yp extends class{constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId;const r=t.ssl?"https":"http",i=encodeURIComponent(this.databaseId.projectId),s=encodeURIComponent(this.databaseId.database);this.yo=r+"://"+t.host,this.wo=`projects/${i}/databases/${s}`,this.So="(default)"===this.databaseId.database?`project_id=${i}`:`project_id=${i}&database_id=${s}`}get bo(){return!1}Do(t,r,i,s,o){const a=Ba(),u=this.Co(t,r.toUriEncodedString());A("RestConnection",`Sending RPC '${t}' ${a}:`,u,i);const c={"google-cloud-resource-prefix":this.wo,"x-goog-request-params":this.So};return this.vo(c,s,o),this.Fo(t,u,c,i).then(l=>(A("RestConnection",`Received RPC '${t}' ${a}: `,l),l),l=>{throw Ue("RestConnection",`RPC '${t}' ${a} failed with error: `,l,"url: ",u,"request:",i),l})}Mo(t,r,i,s,o,a){return this.Do(t,r,i,s,o)}vo(t,r,i){t["X-Goog-Api-Client"]="gl-js/ fire/"+$n,t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),r&&r.headers.forEach((s,o)=>t[o]=s),i&&i.headers.forEach((s,o)=>t[o]=s)}Co(t,r){return`${this.yo}/v1/${r}:${pp[t]}`}terminate(){}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Fo(e,t,r,i){const s=Ba();return new Promise((o,a)=>{const u=new gm;u.setWithCredentials(!0),u.listenOnce(dm.COMPLETE,()=>{try{switch(u.getLastErrorCode()){case jo.NO_ERROR:const l=u.getResponseJson();A(Fe,`XHR for RPC '${e}' ${s} received:`,JSON.stringify(l)),o(l);break;case jo.TIMEOUT:A(Fe,`RPC '${e}' ${s} timed out`),a(new v(_.DEADLINE_EXCEEDED,"Request time out"));break;case jo.HTTP_ERROR:const d=u.getStatus();if(A(Fe,`RPC '${e}' ${s} failed with status:`,d,"response text:",u.getResponseText()),d>0){let m=u.getResponseJson();Array.isArray(m)&&(m=m[0]);const p=m?.error;if(p&&p.status&&p.message){const w=function(R){const k=R.toLowerCase().replace(/_/g,"-");return Object.values(_).indexOf(k)>=0?k:_.UNKNOWN}(p.status);a(new v(w,p.message))}else a(new v(_.UNKNOWN,"Server responded with status "+u.getStatus()))}else a(new v(_.UNAVAILABLE,"Connection failed."));break;default:D()}}finally{A(Fe,`RPC '${e}' ${s} completed.`)}});const c=JSON.stringify(i);A(Fe,`RPC '${e}' ${s} sending request:`,i),u.send(t,"POST",c,r,15)})}xo(e,t,r){const i=Ba(),s=[this.yo,"/","google.firestore.v1.Firestore","/",e,"/channel"],o=lm(),a=hm(),u={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},c=this.longPollingOptions.timeoutSeconds;void 0!==c&&(u.longPollingTimeout=Math.round(1e3*c)),this.useFetchStreams&&(u.xmlHttpFactory=new mm({})),this.vo(u.initMessageHeaders,t,r),u.encodeInitMessageHeaders=!0;const l=s.join("");A(Fe,`Creating RPC '${e}' stream ${i}: ${l}`,u);const d=o.createWebChannel(l,u);let m=!1,p=!1;const w=new _p({co:R=>{p?A(Fe,`Not sending because RPC '${e}' stream ${i} is closed:`,R):(m||(A(Fe,`Opening RPC '${e}' stream ${i} transport.`),d.open(),m=!0),A(Fe,`RPC '${e}' stream ${i} sending:`,R),d.send(R))},lo:()=>d.close()}),x=(R,k,L)=>{R.listen(k,F=>{try{L(F)}catch(q){setTimeout(()=>{throw q},0)}})};return x(d,ws.EventType.OPEN,()=>{p||(A(Fe,`RPC '${e}' stream ${i} transport opened.`),w.Vo())}),x(d,ws.EventType.CLOSE,()=>{p||(p=!0,A(Fe,`RPC '${e}' stream ${i} transport closed`),w.fo())}),x(d,ws.EventType.ERROR,R=>{p||(p=!0,Ue(Fe,`RPC '${e}' stream ${i} transport errored:`,R),w.fo(new v(_.UNAVAILABLE,"The operation could not be completed")))}),x(d,ws.EventType.MESSAGE,R=>{var k;if(!p){const L=R.data[0];b(!!L);const q=L.error||(null===(k=L[0])||void 0===k?void 0:k.error);if(q){A(Fe,`RPC '${e}' stream ${i} received error:`,q);const X=q.status;let J=function(Ny){const kf=fe[Ny];if(void 0!==kf)return Th(kf)}(X),Te=q.message;void 0===J&&(J=_.INTERNAL,Te="Unknown error status: "+X+" with message "+q.message),p=!0,w.fo(new v(J,Te)),d.close()}else A(Fe,`RPC '${e}' stream ${i} received:`,L),w.po(L)}}),x(a,fm.STAT_EVENT,R=>{R.stat===cl.PROXY?A(Fe,`RPC '${e}' stream ${i} detected buffering proxy`):R.stat===cl.NOPROXY&&A(Fe,`RPC '${e}' stream ${i} detected no buffering proxy`)}),setTimeout(()=>{w.mo()},0),w}}function xd(){return typeof window<"u"?window:null}function to(){return typeof document<"u"?document:null}function Fi(n){return new Vg(n,!0)}class qa{constructor(e,t,r=1e3,i=1.5,s=6e4){this.si=e,this.timerId=t,this.Oo=r,this.No=i,this.Lo=s,this.Bo=0,this.ko=null,this.qo=Date.now(),this.reset()}reset(){this.Bo=0}Qo(){this.Bo=this.Lo}Ko(e){this.cancel();const t=Math.floor(this.Bo+this.$o()),r=Math.max(0,Date.now()-this.qo),i=Math.max(0,t-r);i>0&&A("ExponentialBackoff",`Backing off for ${i} ms (base delay: ${this.Bo} ms, delay with jitter: ${t} ms, last attempt: ${r} ms ago)`),this.ko=this.si.enqueueAfterDelay(this.timerId,i,()=>(this.qo=Date.now(),e())),this.Bo*=this.No,this.Bo<this.Oo&&(this.Bo=this.Oo),this.Bo>this.Lo&&(this.Bo=this.Lo)}Uo(){null!==this.ko&&(this.ko.skipDelay(),this.ko=null)}cancel(){null!==this.ko&&(this.ko.cancel(),this.ko=null)}$o(){return(Math.random()-.5)*this.Bo}}class Cd{constructor(e,t,r,i,s,o,a,u){this.si=e,this.Wo=r,this.Go=i,this.connection=s,this.authCredentialsProvider=o,this.appCheckCredentialsProvider=a,this.listener=u,this.state=0,this.zo=0,this.jo=null,this.Ho=null,this.stream=null,this.Jo=new qa(e,t)}Yo(){return 1===this.state||5===this.state||this.Zo()}Zo(){return 2===this.state||3===this.state}start(){4!==this.state?this.auth():this.Xo()}stop(){var e=this;return(0,y.Z)(function*(){e.Yo()&&(yield e.close(0))})()}e_(){this.state=0,this.Jo.reset()}t_(){this.Zo()&&null===this.jo&&(this.jo=this.si.enqueueAfterDelay(this.Wo,6e4,()=>this.n_()))}r_(e){this.i_(),this.stream.send(e)}n_(){var e=this;return(0,y.Z)(function*(){if(e.Zo())return e.close(0)})()}i_(){this.jo&&(this.jo.cancel(),this.jo=null)}s_(){this.Ho&&(this.Ho.cancel(),this.Ho=null)}close(e,t){var r=this;return(0,y.Z)(function*(){r.i_(),r.s_(),r.Jo.cancel(),r.zo++,4!==e?r.Jo.reset():t&&t.code===_.RESOURCE_EXHAUSTED?(he(t.toString()),he("Using maximum backoff delay to prevent overloading the backend."),r.Jo.Qo()):t&&t.code===_.UNAUTHENTICATED&&3!==r.state&&(r.authCredentialsProvider.invalidateToken(),r.appCheckCredentialsProvider.invalidateToken()),null!==r.stream&&(r.o_(),r.stream.close(),r.stream=null),r.state=e,yield r.listener.Eo(t)})()}o_(){}auth(){this.state=1;const e=this.__(this.zo),t=this.zo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([r,i])=>{this.zo===t&&this.a_(r,i)},r=>{e(()=>{const i=new v(_.UNKNOWN,"Fetching auth token failed: "+r.message);return this.u_(i)})})}a_(e,t){const r=this.__(this.zo);this.stream=this.c_(e,t),this.stream.ho(()=>{r(()=>this.listener.ho())}),this.stream.Io(()=>{r(()=>(this.state=2,this.Ho=this.si.enqueueAfterDelay(this.Go,1e4,()=>(this.Zo()&&(this.state=3),Promise.resolve())),this.listener.Io()))}),this.stream.Eo(i=>{r(()=>this.u_(i))}),this.stream.onMessage(i=>{r(()=>this.onMessage(i))})}Xo(){var e=this;this.state=5,this.Jo.Ko((0,y.Z)(function*(){e.state=0,e.start()}))}u_(e){return A("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}__(e){return t=>{this.si.enqueueAndForget(()=>this.zo===e?t():(A("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class Ip extends Cd{constructor(e,t,r,i,s,o){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,r,i,o),this.serializer=s}c_(e,t){return this.connection.xo("Listen",e,t)}onMessage(e){this.Jo.reset();const t=function Dg(n,e){let t;if("targetChange"in e){const r="NO_CHANGE"===(c=e.targetChange.targetChangeType||"NO_CHANGE")?0:"ADD"===c?1:"REMOVE"===c?2:"CURRENT"===c?3:"RESET"===c?4:D(),i=e.targetChange.targetIds||[],s=function(c,l){return c.useProto3Json?(b(void 0===l||"string"==typeof l),Ie.fromBase64String(l||"")):(b(void 0===l||l instanceof Buffer||l instanceof Uint8Array),Ie.fromUint8Array(l||new Uint8Array))}(n,e.targetChange.resumeToken),o=e.targetChange.cause,a=o&&function(c){const l=void 0===c.code?_.UNKNOWN:Th(c.code);return new v(l,c.message||"")}(o);t=new Rh(r,i,s,a||null)}else if("documentChange"in e){const r=e.documentChange,i=lt(n,r.document.name),s=de(r.document.updateTime),o=r.document.createTime?de(r.document.createTime):N.min(),a=new De({mapValue:{fields:r.document.fields}}),u=ie.newFoundDocument(i,s,o,a);t=new qs(r.targetIds||[],r.removedTargetIds||[],u.key,u)}else if("documentDelete"in e){const r=e.documentDelete,i=lt(n,r.document),s=r.readTime?de(r.readTime):N.min(),o=ie.newNoDocument(i,s);t=new qs([],r.removedTargetIds||[],o.key,o)}else if("documentRemove"in e){const r=e.documentRemove,i=lt(n,r.document);t=new qs([],r.removedTargetIds||[],i,null)}else{if(!("filter"in e))return D();{const r=e.filter,{count:i=0,unchangedNames:s}=r,o=new vg(i,s);t=new wh(r.targetId,o)}}var c;return t}(this.serializer,e),r=function(s){if(!("targetChange"in s))return N.min();const o=s.targetChange;return o.targetIds&&o.targetIds.length?N.min():o.readTime?de(o.readTime):N.min()}(e);return this.listener.l_(t,r)}h_(e){const t={};t.database=ga(this.serializer),t.addTarget=function(s,o){let a;const u=o.target;if(a=Ns(u)?{documents:Mh(s,u)}:{query:_a(s,u)._t},a.targetId=o.targetId,o.resumeToken.approximateByteSize()>0){a.resumeToken=xh(s,o.resumeToken);const c=da(s,o.expectedCount);null!==c&&(a.expectedCount=c)}else if(o.snapshotVersion.compareTo(N.min())>0){a.readTime=ar(s,o.snapshotVersion.toTimestamp());const c=da(s,o.expectedCount);null!==c&&(a.expectedCount=c)}return a}(this.serializer,e);const r=function Ng(n,e){const t=function(i){switch(i){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return D()}}(e.purpose);return null==t?null:{"goog-listen-tags":t}}(0,e);r&&(t.labels=r),this.r_(t)}P_(e){const t={};t.database=ga(this.serializer),t.removeTarget=e,this.r_(t)}}class Tp extends Cd{constructor(e,t,r,i,s,o){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,r,i,o),this.serializer=s,this.I_=!1}get T_(){return this.I_}start(){this.I_=!1,this.lastStreamToken=void 0,super.start()}o_(){this.I_&&this.E_([])}c_(e,t){return this.connection.xo("Write",e,t)}onMessage(e){if(b(!!e.streamToken),this.lastStreamToken=e.streamToken,this.I_){this.Jo.reset();const t=function bg(n,e){return n&&n.length>0?(b(void 0!==e),n.map(t=>function(i,s){let o=de(i.updateTime?i.updateTime:s);return o.isEqual(N.min())&&(o=de(s)),new yg(o,i.transformResults||[])}(t,e))):[]}(e.writeResults,e.commitTime),r=de(e.commitTime);return this.listener.d_(r,t)}return b(!e.writeResults||0===e.writeResults.length),this.I_=!0,this.listener.A_()}R_(){const e={};e.database=ga(this.serializer),this.r_(e)}E_(e){const t={streamToken:this.lastStreamToken,writes:e.map(r=>Si(this.serializer,r))};this.r_(t)}}class Ep extends class{}{constructor(e,t,r,i){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=r,this.serializer=i,this.V_=!1}m_(){if(this.V_)throw new v(_.FAILED_PRECONDITION,"The client has already been terminated.")}Do(e,t,r,i){return this.m_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,o])=>this.connection.Do(e,ma(t,r),i,s,o)).catch(s=>{throw"FirebaseError"===s.name?(s.code===_.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),s):new v(_.UNKNOWN,s.toString())})}Mo(e,t,r,i,s){return this.m_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([o,a])=>this.connection.Mo(e,ma(t,r),i,o,a,s)).catch(o=>{throw"FirebaseError"===o.name?(o.code===_.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new v(_.UNKNOWN,o.toString())})}terminate(){this.V_=!0,this.connection.terminate()}}class Ap{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.g_=0,this.p_=null,this.y_=!0}w_(){0===this.g_&&(this.S_("Unknown"),this.p_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.p_=null,this.b_("Backend didn't respond within 10 seconds."),this.S_("Offline"),Promise.resolve())))}D_(e){"Online"===this.state?this.S_("Unknown"):(this.g_++,this.g_>=1&&(this.C_(),this.b_(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.S_("Offline")))}set(e){this.C_(),this.g_=0,"Online"===e&&(this.y_=!1),this.S_(e)}S_(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}b_(e){const t=`Could not reach Cloud Firestore backend. ${e}\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.y_?(he(t),this.y_=!1):A("OnlineStateTracker",t)}C_(){null!==this.p_&&(this.p_.cancel(),this.p_=null)}}class wp{constructor(e,t,r,i,s){var o=this;this.localStore=e,this.datastore=t,this.asyncQueue=r,this.remoteSyncer={},this.v_=[],this.F_=new Map,this.M_=new Set,this.x_=[],this.O_=s,this.O_.ro(a=>{r.enqueueAndForget((0,y.Z)(function*(){var u;Qt(o)&&(A("RemoteStore","Restarting streams for network reachability change."),yield(u=(0,y.Z)(function*(l){const d=S(l);d.M_.add(4),yield gr(d),d.N_.set("Unknown"),d.M_.delete(4),yield Mi(d)}),function c(l){return u.apply(this,arguments)})(o))}))}),this.N_=new Ap(r,i)}}function Mi(n){return Ga.apply(this,arguments)}function Ga(){return Ga=(0,y.Z)(function*(n){if(Qt(n))for(const e of n.x_)yield e(!0)}),Ga.apply(this,arguments)}function gr(n){return za.apply(this,arguments)}function za(){return za=(0,y.Z)(function*(n){for(const e of n.x_)yield e(!1)}),za.apply(this,arguments)}function no(n,e){const t=S(n);t.F_.has(e.targetId)||(t.F_.set(e.targetId,e),$a(t)?ja(t):yr(t).Zo()&&Ka(t,e))}function pr(n,e){const t=S(n),r=yr(t);t.F_.delete(e),r.Zo()&&Dd(t,e),0===t.F_.size&&(r.Zo()?r.t_():Qt(t)&&t.N_.set("Unknown"))}function Ka(n,e){if(n.L_.xe(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(N.min())>0){const t=n.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}yr(n).h_(e)}function Dd(n,e){n.L_.xe(e),yr(n).P_(e)}function ja(n){n.L_=new wg({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),ot:e=>n.F_.get(e)||null,tt:()=>n.datastore.serializer.databaseId}),yr(n).start(),n.N_.w_()}function $a(n){return Qt(n)&&!yr(n).Yo()&&n.F_.size>0}function Qt(n){return 0===S(n).M_.size}function bd(n){n.L_=void 0}function Rp(n){return Qa.apply(this,arguments)}function Qa(){return Qa=(0,y.Z)(function*(n){n.N_.set("Online")}),Qa.apply(this,arguments)}function Pp(n){return Wa.apply(this,arguments)}function Wa(){return Wa=(0,y.Z)(function*(n){n.F_.forEach((e,t)=>{Ka(n,e)})}),Wa.apply(this,arguments)}function Sp(n,e){return Ha.apply(this,arguments)}function Ha(){return Ha=(0,y.Z)(function*(n,e){bd(n),$a(n)?(n.N_.D_(e),ja(n)):n.N_.set("Unknown")}),Ha.apply(this,arguments)}function Vp(n,e,t){return Za.apply(this,arguments)}function Za(){return Za=(0,y.Z)(function*(n,e,t){if(n.N_.set("Online"),e instanceof Rh&&2===e.state&&e.cause)try{yield(r=(0,y.Z)(function*(s,o){const a=o.cause;for(const u of o.targetIds)s.F_.has(u)&&(yield s.remoteSyncer.rejectListen(u,a),s.F_.delete(u),s.L_.removeTarget(u))}),function i(s,o){return r.apply(this,arguments)})(n,e)}catch(r){A("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),r),yield ro(n,r)}else if(e instanceof qs?n.L_.Ke(e):e instanceof wh?n.L_.He(e):n.L_.We(e),!t.isEqual(N.min()))try{const r=yield Td(n.localStore);t.compareTo(r)>=0&&(yield function(s,o){const a=s.L_.rt(o);return a.targetChanges.forEach((u,c)=>{if(u.resumeToken.approximateByteSize()>0){const l=s.F_.get(c);l&&s.F_.set(c,l.withResumeToken(u.resumeToken,o))}}),a.targetMismatches.forEach((u,c)=>{const l=s.F_.get(u);if(!l)return;s.F_.set(u,l.withResumeToken(Ie.EMPTY_BYTE_STRING,l.snapshotVersion)),Dd(s,u);const d=new Rt(l.target,u,c,l.sequenceNumber);Ka(s,d)}),s.remoteSyncer.applyRemoteEvent(a)}(n,t))}catch(r){A("RemoteStore","Failed to raise snapshot:",r),yield ro(n,r)}var r}),Za.apply(this,arguments)}function ro(n,e,t){return Ja.apply(this,arguments)}function Ja(){return Ja=(0,y.Z)(function*(n,e,t){if(!Mt(e))throw e;n.M_.add(1),yield gr(n),n.N_.set("Offline"),t||(t=()=>Td(n.localStore)),n.asyncQueue.enqueueRetryable((0,y.Z)(function*(){A("RemoteStore","Retrying IndexedDB access"),yield t(),n.M_.delete(1),yield Mi(n)}))}),Ja.apply(this,arguments)}function Nd(n,e){return e().catch(t=>ro(n,t,e))}function _r(n){return Ya.apply(this,arguments)}function Ya(){return Ya=(0,y.Z)(function*(n){const e=S(n),t=Wt(e);let r=e.v_.length>0?e.v_[e.v_.length-1].batchId:-1;for(;xp(e);)try{const i=yield dp(e.localStore,r);if(null===i){0===e.v_.length&&t.t_();break}r=i.batchId,Cp(e,i)}catch(i){yield ro(e,i)}kd(e)&&Fd(e)}),Ya.apply(this,arguments)}function xp(n){return Qt(n)&&n.v_.length<10}function Cp(n,e){n.v_.push(e);const t=Wt(n);t.Zo()&&t.T_&&t.E_(e.mutations)}function kd(n){return Qt(n)&&!Wt(n).Yo()&&n.v_.length>0}function Fd(n){Wt(n).start()}function Dp(n){return Xa.apply(this,arguments)}function Xa(){return Xa=(0,y.Z)(function*(n){Wt(n).R_()}),Xa.apply(this,arguments)}function bp(n){return eu.apply(this,arguments)}function eu(){return eu=(0,y.Z)(function*(n){const e=Wt(n);for(const t of n.v_)e.E_(t.mutations)}),eu.apply(this,arguments)}function Np(n,e,t){return tu.apply(this,arguments)}function tu(){return tu=(0,y.Z)(function*(n,e,t){const r=n.v_.shift(),i=ca.from(r,e,t);yield Nd(n,()=>n.remoteSyncer.applySuccessfulWrite(i)),yield _r(n)}),tu.apply(this,arguments)}function kp(n,e){return nu.apply(this,arguments)}function nu(){return nu=(0,y.Z)(function*(n,e){var t;e&&Wt(n).T_&&(yield(t=(0,y.Z)(function*(i,s){if(Ih(a=s.code)&&a!==_.ABORTED){const o=i.v_.shift();Wt(i).e_(),yield Nd(i,()=>i.remoteSyncer.rejectFailedWrite(o.batchId,s)),yield _r(i)}var a}),function r(i,s){return t.apply(this,arguments)})(n,e)),kd(n)&&Fd(n)}),nu.apply(this,arguments)}function Md(n,e){return ru.apply(this,arguments)}function ru(){return ru=(0,y.Z)(function*(n,e){const t=S(n);t.asyncQueue.verifyOperationInProgress(),A("RemoteStore","RemoteStore received new credentials");const r=Qt(t);t.M_.add(3),yield gr(t),r&&t.N_.set("Unknown"),yield t.remoteSyncer.handleCredentialChange(e),t.M_.delete(3),yield Mi(t)}),ru.apply(this,arguments)}function iu(n,e){return su.apply(this,arguments)}function su(){return su=(0,y.Z)(function*(n,e){const t=S(n);e?(t.M_.delete(2),yield Mi(t)):e||(t.M_.add(2),yield gr(t),t.N_.set("Unknown"))}),su.apply(this,arguments)}function yr(n){return n.B_||(n.B_=function(t,r,i){const s=S(t);return s.m_(),new Ip(r,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,i)}(n.datastore,n.asyncQueue,{ho:Rp.bind(null,n),Io:Pp.bind(null,n),Eo:Sp.bind(null,n),l_:Vp.bind(null,n)}),n.x_.push(function(){var e=(0,y.Z)(function*(t){t?(n.B_.e_(),$a(n)?ja(n):n.N_.set("Unknown")):(yield n.B_.stop(),bd(n))});return function(t){return e.apply(this,arguments)}}())),n.B_}function Wt(n){return n.k_||(n.k_=function(t,r,i){const s=S(t);return s.m_(),new Tp(r,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,i)}(n.datastore,n.asyncQueue,{ho:()=>Promise.resolve(),Io:Dp.bind(null,n),Eo:kp.bind(null,n),A_:bp.bind(null,n),d_:Np.bind(null,n)}),n.x_.push(function(){var e=(0,y.Z)(function*(t){t?(n.k_.e_(),yield _r(n)):(yield n.k_.stop(),n.v_.length>0&&(A("RemoteStore",`Stopping write stream with ${n.v_.length} pending writes`),n.v_=[]))});return function(t){return e.apply(this,arguments)}}())),n.k_}class ou{constructor(e,t,r,i,s){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=r,this.op=i,this.removalCallback=s,this.deferred=new ye,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(o=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,r,i,s){const o=Date.now()+r,a=new ou(e,t,o,i,s);return a.start(r),a}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new v(_.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function Ir(n,e){if(he("AsyncQueue",`${e}: ${n}`),Mt(n))return new v(_.UNAVAILABLE,`${e}: ${n}`);throw n}class Tr{constructor(e){this.comparator=e?(t,r)=>e(t,r)||C.comparator(t.key,r.key):(t,r)=>C.comparator(t.key,r.key),this.keyedMap=Ii(),this.sortedSet=new ee(this.comparator)}static emptySet(e){return new Tr(e.comparator)}has(e){return null!=this.keyedMap.get(e)}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,r)=>(e(t),!1))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof Tr)||this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;t.hasNext();){const i=t.getNext().key,s=r.getNext().key;if(!i.isEqual(s))return!1}return!0}toString(){const e=[];return this.forEach(t=>{e.push(t.toString())}),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"}copy(e,t){const r=new Tr;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=t,r}}class Od{constructor(){this.q_=new ee(C.comparator)}track(e){const t=e.doc.key,r=this.q_.get(t);r?0!==e.type&&3===r.type?this.q_=this.q_.insert(t,e):3===e.type&&1!==r.type?this.q_=this.q_.insert(t,{type:r.type,doc:e.doc}):2===e.type&&2===r.type?this.q_=this.q_.insert(t,{type:2,doc:e.doc}):2===e.type&&0===r.type?this.q_=this.q_.insert(t,{type:0,doc:e.doc}):1===e.type&&0===r.type?this.q_=this.q_.remove(t):1===e.type&&2===r.type?this.q_=this.q_.insert(t,{type:1,doc:r.doc}):0===e.type&&1===r.type?this.q_=this.q_.insert(t,{type:2,doc:e.doc}):D():this.q_=this.q_.insert(t,e)}Q_(){const e=[];return this.q_.inorderTraversal((t,r)=>{e.push(r)}),e}}class Er{constructor(e,t,r,i,s,o,a,u,c){this.query=e,this.docs=t,this.oldDocs=r,this.docChanges=i,this.mutatedKeys=s,this.fromCache=o,this.syncStateChanged=a,this.excludesMetadataChanges=u,this.hasCachedResults=c}static fromInitialDocuments(e,t,r,i,s){const o=[];return t.forEach(a=>{o.push({type:0,doc:a})}),new Er(e,t,Tr.emptySet(t),o,r,i,!0,!1,s)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&_i(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,r=e.docChanges;if(t.length!==r.length)return!1;for(let i=0;i<t.length;i++)if(t[i].type!==r[i].type||!t[i].doc.isEqual(r[i].doc))return!1;return!0}}class Fp{constructor(){this.K_=void 0,this.U_=[]}W_(){return this.U_.some(e=>e.G_())}}class Mp{constructor(){this.queries=new At(e=>eh(e),_i),this.onlineState="Unknown",this.z_=new Set}}function au(n,e){return uu.apply(this,arguments)}function uu(){return uu=(0,y.Z)(function*(n,e){const t=S(n);let r=3;const i=e.query;let s=t.queries.get(i);s?!s.W_()&&e.G_()&&(r=2):(s=new Fp,r=e.G_()?0:1);try{switch(r){case 0:s.K_=yield t.onListen(i,!0);break;case 1:s.K_=yield t.onListen(i,!1);break;case 2:yield t.onFirstRemoteStoreListen(i)}}catch(o){const a=Ir(o,`Initialization of query '${nr(e.query)}' failed`);return void e.onError(a)}t.queries.set(i,s),s.U_.push(e),e.j_(t.onlineState),s.K_&&e.H_(s.K_)&&hu(t)}),uu.apply(this,arguments)}function cu(n,e){return lu.apply(this,arguments)}function lu(){return lu=(0,y.Z)(function*(n,e){const t=S(n),r=e.query;let i=3;const s=t.queries.get(r);if(s){const o=s.U_.indexOf(e);o>=0&&(s.U_.splice(o,1),0===s.U_.length?i=e.G_()?0:1:!s.W_()&&e.G_()&&(i=2))}switch(i){case 0:return t.queries.delete(r),t.onUnlisten(r,!0);case 1:return t.queries.delete(r),t.onUnlisten(r,!1);case 2:return t.onLastRemoteStoreUnlisten(r);default:return}}),lu.apply(this,arguments)}function Op(n,e){const t=S(n);let r=!1;for(const i of e){const o=t.queries.get(i.query);if(o){for(const a of o.U_)a.H_(i)&&(r=!0);o.K_=i}}r&&hu(t)}function Lp(n,e,t){const r=S(n),i=r.queries.get(e);if(i)for(const s of i.U_)s.onError(t);r.queries.delete(e)}function hu(n){n.z_.forEach(e=>{e.next()})}var du,Ld;(Ld=du||(du={})).J_="default",Ld.Cache="cache";class fu{constructor(e,t,r){this.query=e,this.Y_=t,this.Z_=!1,this.X_=null,this.onlineState="Unknown",this.options=r||{}}H_(e){if(!this.options.includeMetadataChanges){const r=[];for(const i of e.docChanges)3!==i.type&&r.push(i);e=new Er(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.Z_?this.ea(e)&&(this.Y_.next(e),t=!0):this.ta(e,this.onlineState)&&(this.na(e),t=!0),this.X_=e,t}onError(e){this.Y_.error(e)}j_(e){this.onlineState=e;let t=!1;return this.X_&&!this.Z_&&this.ta(this.X_,e)&&(this.na(this.X_),t=!0),t}ta(e,t){return!e.fromCache||!this.G_()||(!this.options.ra||!("Offline"!==t))&&(!e.docs.isEmpty()||e.hasCachedResults||"Offline"===t)}ea(e){return e.docChanges.length>0||!!(e.syncStateChanged||this.X_&&this.X_.hasPendingWrites!==e.hasPendingWrites)&&!0===this.options.includeMetadataChanges}na(e){e=Er.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Z_=!0,this.Y_.next(e)}G_(){return this.options.source!==du.Cache}}class Bp{constructor(e,t){this.ia=e,this.byteLength=t}sa(){return"metadata"in this.ia}}class Bd{constructor(e){this.serializer=e}hs(e){return lt(this.serializer,e)}Ps(e){return e.metadata.exists?Fh(this.serializer,e.document,!1):ie.newNoDocument(this.hs(e.metadata.name),this.Is(e.metadata.readTime))}Is(e){return de(e)}}class qp{constructor(e,t,r){this.oa=e,this.localStore=t,this.serializer=r,this.queries=[],this.documents=[],this.collectionGroups=new Set,this.progress=qd(e)}_a(e){this.progress.bytesLoaded+=e.byteLength;let t=this.progress.documentsLoaded;if(e.ia.namedQuery)this.queries.push(e.ia.namedQuery);else if(e.ia.documentMetadata){this.documents.push({metadata:e.ia.documentMetadata}),e.ia.documentMetadata.exists||++t;const r=K.fromString(e.ia.documentMetadata.name);this.collectionGroups.add(r.get(r.length-2))}else e.ia.document&&(this.documents[this.documents.length-1].document=e.ia.document,++t);return t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,Object.assign({},this.progress)):null}aa(e){const t=new Map,r=new Bd(this.serializer);for(const i of e)if(i.metadata.queries){const s=r.hs(i.metadata.name);for(const o of i.metadata.queries){const a=(t.get(o)||B()).add(s);t.set(o,a)}}return t}complete(){var e=this;return(0,y.Z)(function*(){const t=yield function fp(n,e,t,r){return Na.apply(this,arguments)}(e.localStore,new Bd(e.serializer),e.documents,e.oa.id),r=e.aa(e.documents);for(const i of e.queries)yield mp(e.localStore,i,r.get(i.name));return e.progress.taskState="Success",{progress:e.progress,ua:e.collectionGroups,ca:t}})()}}function qd(n){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:n.totalDocuments,totalBytes:n.totalBytes}}class Ud{constructor(e){this.key=e}}class Gd{constructor(e){this.key=e}}class zd{constructor(e,t){this.query=e,this.la=t,this.ha=null,this.hasCachedResults=!1,this.current=!1,this.Pa=B(),this.mutatedKeys=B(),this.Ia=nh(e),this.Ta=new Tr(this.Ia)}get Ea(){return this.la}da(e,t){const r=t?t.Aa:new Od,i=t?t.Ta:this.Ta;let s=t?t.mutatedKeys:this.mutatedKeys,o=i,a=!1;const u="F"===this.query.limitType&&i.size===this.query.limit?i.last():null,c="L"===this.query.limitType&&i.size===this.query.limit?i.first():null;if(e.inorderTraversal((l,d)=>{const m=i.get(l),p=yi(this.query,d)?d:null,w=!!m&&this.mutatedKeys.has(m.key),x=!!p&&(p.hasLocalMutations||this.mutatedKeys.has(p.key)&&p.hasCommittedMutations);let R=!1;m&&p?m.data.isEqual(p.data)?w!==x&&(r.track({type:3,doc:p}),R=!0):this.Ra(m,p)||(r.track({type:2,doc:p}),R=!0,(u&&this.Ia(p,u)>0||c&&this.Ia(p,c)<0)&&(a=!0)):!m&&p?(r.track({type:0,doc:p}),R=!0):m&&!p&&(r.track({type:1,doc:m}),R=!0,(u||c)&&(a=!0)),R&&(p?(o=o.add(p),s=x?s.add(l):s.delete(l)):(o=o.delete(l),s=s.delete(l)))}),null!==this.query.limit)for(;o.size>this.query.limit;){const l="F"===this.query.limitType?o.last():o.first();o=o.delete(l.key),s=s.delete(l.key),r.track({type:1,doc:l})}return{Ta:o,Aa:r,Zi:a,mutatedKeys:s}}Ra(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,r,i){const s=this.Ta;this.Ta=e.Ta,this.mutatedKeys=e.mutatedKeys;const o=e.Aa.Q_();o.sort((l,d)=>function(p,w){const x=R=>{switch(R){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return D()}};return x(p)-x(w)}(l.type,d.type)||this.Ia(l.doc,d.doc)),this.Va(r),i=null!=i&&i;const a=t&&!i?this.ma():[],u=0===this.Pa.size&&this.current&&!i?1:0,c=u!==this.ha;return this.ha=u,0!==o.length||c?{snapshot:new Er(this.query,e.Ta,s,o,e.mutatedKeys,0===u,c,!1,!!r&&r.resumeToken.approximateByteSize()>0),fa:a}:{fa:a}}j_(e){return this.current&&"Offline"===e?(this.current=!1,this.applyChanges({Ta:this.Ta,Aa:new Od,mutatedKeys:this.mutatedKeys,Zi:!1},!1)):{fa:[]}}ga(e){return!this.la.has(e)&&!!this.Ta.has(e)&&!this.Ta.get(e).hasLocalMutations}Va(e){e&&(e.addedDocuments.forEach(t=>this.la=this.la.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this.la=this.la.delete(t)),this.current=e.current)}ma(){if(!this.current)return[];const e=this.Pa;this.Pa=B(),this.Ta.forEach(r=>{this.ga(r.key)&&(this.Pa=this.Pa.add(r.key))});const t=[];return e.forEach(r=>{this.Pa.has(r)||t.push(new Gd(r))}),this.Pa.forEach(r=>{e.has(r)||t.push(new Ud(r))}),t}pa(e){this.la=e.ls,this.Pa=B();const t=this.da(e.documents);return this.applyChanges(t,!0)}ya(){return Er.fromInitialDocuments(this.query,this.Ta,this.mutatedKeys,0===this.ha,this.hasCachedResults)}}class Up{constructor(e,t,r){this.query=e,this.targetId=t,this.view=r}}class Gp{constructor(e){this.key=e,this.wa=!1}}class zp{constructor(e,t,r,i,s,o){this.localStore=e,this.remoteStore=t,this.eventManager=r,this.sharedClientState=i,this.currentUser=s,this.maxConcurrentLimboResolutions=o,this.Sa={},this.ba=new At(a=>eh(a),_i),this.Da=new Map,this.Ca=new Set,this.va=new ee(C.comparator),this.Fa=new Map,this.Ma=new Ra,this.xa={},this.Oa=new Map,this.Na=yn.Nn(),this.onlineState="Unknown",this.La=void 0}get isPrimaryClient(){return!0===this.La}}function Kp(n,e){return mu.apply(this,arguments)}function mu(){return mu=(0,y.Z)(function*(n,e,t=!0){const r=io(n);let i;const s=r.ba.get(e);return s?(r.sharedClientState.addLocalQueryTarget(s.targetId),i=s.view.ya()):i=yield Kd(r,e,t,!0),i}),mu.apply(this,arguments)}function jp(n,e){return gu.apply(this,arguments)}function gu(){return gu=(0,y.Z)(function*(n,e){const t=io(n);yield Kd(t,e,!0,!1)}),gu.apply(this,arguments)}function Kd(n,e,t,r){return pu.apply(this,arguments)}function pu(){return pu=(0,y.Z)(function*(n,e,t,r){const i=yield fr(n.localStore,Le(e)),s=i.targetId,o=t?n.sharedClientState.addLocalQueryTarget(s):"not-current";let a;return r&&(a=yield _u(n,e,s,"current"===o,i.resumeToken)),n.isPrimaryClient&&t&&no(n.remoteStore,i),a}),pu.apply(this,arguments)}function _u(n,e,t,r,i){return yu.apply(this,arguments)}function yu(){return yu=(0,y.Z)(function*(n,e,t,r,i){n.Ba=(d,m,p)=>{return(w=(0,y.Z)(function*(R,k,L,F){let q=k.view.da(L);q.Zi&&(q=yield Js(R.localStore,k.query,!1).then(({documents:Ze})=>k.view.da(Ze,q)));const X=F&&F.targetChanges.get(k.targetId),J=F&&null!=F.targetMismatches.get(k.targetId),Te=k.view.applyChanges(q,R.isPrimaryClient,X,J);return xu(R,k.targetId,Te.fa),Te.snapshot}),function x(R,k,L,F){return w.apply(this,arguments)})(n,d,m,p);var w};const s=yield Js(n.localStore,e,!0),o=new zd(e,s.ls),a=o.da(s.documents),u=Ri.createSynthesizedTargetChangeForCurrentChange(t,r&&"Offline"!==n.onlineState,i),c=o.applyChanges(a,n.isPrimaryClient,u);xu(n,t,c.fa);const l=new Up(e,t,o);return n.ba.set(e,l),n.Da.has(t)?n.Da.get(t).push(e):n.Da.set(t,[e]),c.snapshot}),yu.apply(this,arguments)}function $p(n,e,t){return Iu.apply(this,arguments)}function Iu(){return Iu=(0,y.Z)(function*(n,e,t){const r=S(n),i=r.ba.get(e),s=r.Da.get(i.targetId);if(s.length>1)return r.Da.set(i.targetId,s.filter(o=>!_i(o,e))),void r.ba.delete(e);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(i.targetId),r.sharedClientState.isActiveQueryTarget(i.targetId)||(yield mr(r.localStore,i.targetId,!1).then(()=>{r.sharedClientState.clearQueryState(i.targetId),t&&pr(r.remoteStore,i.targetId),vr(r,i.targetId)}).catch(Ft))):(vr(r,i.targetId),yield mr(r.localStore,i.targetId,!0))}),Iu.apply(this,arguments)}function Qp(n,e){return Tu.apply(this,arguments)}function Tu(){return Tu=(0,y.Z)(function*(n,e){const t=S(n),r=t.ba.get(e),i=t.Da.get(r.targetId);t.isPrimaryClient&&1===i.length&&(t.sharedClientState.removeLocalQueryTarget(r.targetId),pr(t.remoteStore,r.targetId))}),Tu.apply(this,arguments)}function Eu(){return Eu=(0,y.Z)(function*(n,e,t){const r=qu(n);try{const i=yield function(o,a){const u=S(o),c=se.now(),l=a.reduce((p,w)=>p.add(w.key),B());let d,m;return u.persistence.runTransaction("Locally write mutations","readwrite",p=>{let w=ze(),x=B();return u.ss.getEntries(p,l).next(R=>{w=R,w.forEach((k,L)=>{L.isValidDocument()||(x=x.add(k))})}).next(()=>u.localDocuments.getOverlayedDocuments(p,w)).next(R=>{d=R;const k=[];for(const L of a){const F=Tg(L,d.get(L.key).overlayedDocument);null!=F&&k.push(new wt(L.key,F,Bl(F.value.mapValue),oe.exists(!0)))}return u.mutationQueue.addMutationBatch(p,c,k,a)}).next(R=>{m=R;const k=R.applyToLocalDocumentSet(d,x);return u.documentOverlayCache.saveOverlays(p,R.batchId,k)})}).then(()=>({batchId:m.batchId,changes:ih(d)}))}(r.localStore,e);r.sharedClientState.addPendingMutation(i.batchId),function(o,a,u){let c=o.xa[o.currentUser.toKey()];c||(c=new ee(O)),c=c.insert(a,u),o.xa[o.currentUser.toKey()]=c}(r,i.batchId,t),yield Pt(r,i.changes),yield _r(r.remoteStore)}catch(i){const s=Ir(i,"Failed to persist write");t.reject(s)}}),Eu.apply(this,arguments)}function jd(n,e){return vu.apply(this,arguments)}function vu(){return vu=(0,y.Z)(function*(n,e){const t=S(n);try{const r=yield function hp(n,e){const t=S(n),r=e.snapshotVersion;let i=t.ts;return t.persistence.runTransaction("Apply remote event","readwrite-primary",s=>{const o=t.ss.newChangeBuffer({trackRemovals:!0});i=t.ts;const a=[];e.targetChanges.forEach((l,d)=>{const m=i.get(d);if(!m)return;a.push(t.qr.removeMatchingKeys(s,l.removedDocuments,d).next(()=>t.qr.addMatchingKeys(s,l.addedDocuments,d)));let p=m.withSequenceNumber(s.currentSequenceNumber);var x,R,k;null!==e.targetMismatches.get(d)?p=p.withResumeToken(Ie.EMPTY_BYTE_STRING,N.min()).withLastLimboFreeSnapshotVersion(N.min()):l.resumeToken.approximateByteSize()>0&&(p=p.withResumeToken(l.resumeToken,r)),i=i.insert(d,p),R=p,k=l,(0===(x=m).resumeToken.approximateByteSize()||R.snapshotVersion.toMicroseconds()-x.snapshotVersion.toMicroseconds()>=3e8||k.addedDocuments.size+k.modifiedDocuments.size+k.removedDocuments.size>0)&&a.push(t.qr.updateTargetData(s,p))});let u=ze(),c=B();if(e.documentUpdates.forEach(l=>{e.resolvedLimboDocuments.has(l)&&a.push(t.persistence.referenceDelegate.updateLimboDocument(s,l))}),a.push(Ed(s,o,e.documentUpdates).next(l=>{u=l.us,c=l.cs})),!r.isEqual(N.min())){const l=t.qr.getLastRemoteSnapshotVersion(s).next(d=>t.qr.setTargetsMetadata(s,s.currentSequenceNumber,r));a.push(l)}return g.waitFor(a).next(()=>o.apply(s)).next(()=>t.localDocuments.getLocalViewOfDocuments(s,u,c)).next(()=>u)}).then(s=>(t.ts=i,s))}(t.localStore,e);e.targetChanges.forEach((i,s)=>{const o=t.Fa.get(s);o&&(b(i.addedDocuments.size+i.modifiedDocuments.size+i.removedDocuments.size<=1),i.addedDocuments.size>0?o.wa=!0:i.modifiedDocuments.size>0?b(o.wa):i.removedDocuments.size>0&&(b(o.wa),o.wa=!1))}),yield Pt(t,r,e)}catch(r){yield Ft(r)}}),vu.apply(this,arguments)}function $d(n,e,t){const r=S(n);if(r.isPrimaryClient&&0===t||!r.isPrimaryClient&&1===t){const i=[];r.ba.forEach((s,o)=>{const a=o.view.j_(e);a.snapshot&&i.push(a.snapshot)}),function(o,a){const u=S(o);u.onlineState=a;let c=!1;u.queries.forEach((l,d)=>{for(const m of d.U_)m.j_(a)&&(c=!0)}),c&&hu(u)}(r.eventManager,e),i.length&&r.Sa.l_(i),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}function Hp(n,e,t){return Au.apply(this,arguments)}function Au(){return Au=(0,y.Z)(function*(n,e,t){const r=S(n);r.sharedClientState.updateQueryState(e,"rejected",t);const i=r.Fa.get(e),s=i&&i.key;if(s){let o=new ee(C.comparator);o=o.insert(s,ie.newNoDocument(s,N.min()));const a=B().add(s),u=new wi(N.min(),new Map,new ee(O),o,a);yield jd(r,u),r.va=r.va.remove(s),r.Fa.delete(e),Cu(r)}else yield mr(r.localStore,e,!1).then(()=>vr(r,e,t)).catch(Ft)}),Au.apply(this,arguments)}function Zp(n,e){return wu.apply(this,arguments)}function wu(){return wu=(0,y.Z)(function*(n,e){const t=S(n),r=e.batch.batchId;try{const i=yield function lp(n,e){const t=S(n);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",r=>{const i=e.batch.keys(),s=t.ss.newChangeBuffer({trackRemovals:!0});return function(a,u,c,l){const d=c.batch,m=d.keys();let p=g.resolve();return m.forEach(w=>{p=p.next(()=>l.getEntry(u,w)).next(x=>{const R=c.docVersions.get(w);b(null!==R),x.version.compareTo(R)<0&&(d.applyToRemoteDocument(x,c),x.isValidDocument()&&(x.setReadTime(c.commitVersion),l.addEntry(x)))})}),p.next(()=>a.mutationQueue.removeMutationBatch(u,d))}(t,r,e,s).next(()=>s.apply(r)).next(()=>t.mutationQueue.performConsistencyCheck(r)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(r,i,e.batch.batchId)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,function(a){let u=B();for(let c=0;c<a.mutationResults.length;++c)a.mutationResults[c].transformResults.length>0&&(u=u.add(a.batch.mutations[c].key));return u}(e))).next(()=>t.localDocuments.getDocuments(r,i))})}(t.localStore,e);Vu(t,r,null),Su(t,r),t.sharedClientState.updateMutationState(r,"acknowledged"),yield Pt(t,i)}catch(i){yield Ft(i)}}),wu.apply(this,arguments)}function Jp(n,e,t){return Ru.apply(this,arguments)}function Ru(){return Ru=(0,y.Z)(function*(n,e,t){const r=S(n);try{const i=yield function(o,a){const u=S(o);return u.persistence.runTransaction("Reject batch","readwrite-primary",c=>{let l;return u.mutationQueue.lookupMutationBatch(c,a).next(d=>(b(null!==d),l=d.keys(),u.mutationQueue.removeMutationBatch(c,d))).next(()=>u.mutationQueue.performConsistencyCheck(c)).next(()=>u.documentOverlayCache.removeOverlaysForBatchId(c,l,a)).next(()=>u.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(c,l)).next(()=>u.localDocuments.getDocuments(c,l))})}(r.localStore,e);Vu(r,e,t),Su(r,e),r.sharedClientState.updateMutationState(e,"rejected",t),yield Pt(r,i)}catch(i){yield Ft(i)}}),Ru.apply(this,arguments)}function Pu(){return Pu=(0,y.Z)(function*(n,e){const t=S(n);Qt(t.remoteStore)||A("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{const r=yield function(o){const a=S(o);return a.persistence.runTransaction("Get highest unacknowledged batch id","readonly",u=>a.mutationQueue.getHighestUnacknowledgedBatchId(u))}(t.localStore);if(-1===r)return void e.resolve();const i=t.Oa.get(r)||[];i.push(e),t.Oa.set(r,i)}catch(r){const i=Ir(r,"Initialization of waitForPendingWrites() operation failed");e.reject(i)}}),Pu.apply(this,arguments)}function Su(n,e){(n.Oa.get(e)||[]).forEach(t=>{t.resolve()}),n.Oa.delete(e)}function Vu(n,e,t){const r=S(n);let i=r.xa[r.currentUser.toKey()];if(i){const s=i.get(e);s&&(t?s.reject(t):s.resolve(),i=i.remove(e)),r.xa[r.currentUser.toKey()]=i}}function vr(n,e,t=null){n.sharedClientState.removeLocalQueryTarget(e);for(const r of n.Da.get(e))n.ba.delete(r),t&&n.Sa.ka(r,t);n.Da.delete(e),n.isPrimaryClient&&n.Ma.Rr(e).forEach(r=>{n.Ma.containsKey(r)||Qd(n,r)})}function Qd(n,e){n.Ca.delete(e.path.canonicalString());const t=n.va.get(e);null!==t&&(pr(n.remoteStore,t),n.va=n.va.remove(e),n.Fa.delete(t),Cu(n))}function xu(n,e,t){for(const r of t)r instanceof Ud?(n.Ma.addReference(r.key,e),Xp(n,r)):r instanceof Gd?(A("SyncEngine","Document no longer in limbo: "+r.key),n.Ma.removeReference(r.key,e),n.Ma.containsKey(r.key)||Qd(n,r.key)):D()}function Xp(n,e){const t=e.key,r=t.path.canonicalString();n.va.get(t)||n.Ca.has(r)||(A("SyncEngine","New document in limbo: "+t),n.Ca.add(r),Cu(n))}function Cu(n){for(;n.Ca.size>0&&n.va.size<n.maxConcurrentLimboResolutions;){const e=n.Ca.values().next().value;n.Ca.delete(e);const t=new C(K.fromString(e)),r=n.Na.next();n.Fa.set(r,new Gp(t)),n.va=n.va.insert(t,r),no(n.remoteStore,new Rt(Le(er(t.path)),r,"TargetPurposeLimboResolution",$e.oe))}}function Pt(n,e,t){return Du.apply(this,arguments)}function Du(){return Du=(0,y.Z)(function*(n,e,t){const r=S(n),i=[],s=[],o=[];var a;r.ba.isEmpty()||(r.ba.forEach((a,u)=>{o.push(r.Ba(u,e,t).then(c=>{if((c||t)&&r.isPrimaryClient&&r.sharedClientState.updateQueryState(u.targetId,c?.fromCache?"not-current":"current"),c){i.push(c);const l=Ca.Qi(u.targetId,c);s.push(l)}}))}),yield Promise.all(o),r.Sa.l_(i),yield(a=(0,y.Z)(function*(c,l){const d=S(c);try{yield d.persistence.runTransaction("notifyLocalViewChanges","readwrite",m=>g.forEach(l,p=>g.forEach(p.ki,w=>d.persistence.referenceDelegate.addReference(m,p.targetId,w)).next(()=>g.forEach(p.qi,w=>d.persistence.referenceDelegate.removeReference(m,p.targetId,w)))))}catch(m){if(!Mt(m))throw m;A("LocalStore","Failed to update sequence numbers: "+m)}for(const m of l){const p=m.targetId;if(!m.fromCache){const w=d.ts.get(p),R=w.withLastLimboFreeSnapshotVersion(w.snapshotVersion);d.ts=d.ts.insert(p,R)}}}),function u(c,l){return a.apply(this,arguments)})(r.localStore,s))}),Du.apply(this,arguments)}function e_(n,e){return bu.apply(this,arguments)}function bu(){return bu=(0,y.Z)(function*(n,e){const t=S(n);if(!t.currentUser.isEqual(e)){A("SyncEngine","User change. New user:",e.toKey());const r=yield Id(t.localStore,e);t.currentUser=e,(s=t).Oa.forEach(a=>{a.forEach(u=>{u.reject(new v(_.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))})}),s.Oa.clear(),t.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),yield Pt(t,r._s)}var s}),bu.apply(this,arguments)}function t_(n,e){const t=S(n),r=t.Fa.get(e);if(r&&r.wa)return B().add(r.key);{let i=B();const s=t.Da.get(e);if(!s)return i;for(const o of s){const a=t.ba.get(o);i=i.unionWith(a.view.Ea)}return i}}function n_(n,e){return Nu.apply(this,arguments)}function Nu(){return Nu=(0,y.Z)(function*(n,e){const t=S(n),r=yield Js(t.localStore,e.query,!0),i=e.view.pa(r);return t.isPrimaryClient&&xu(t,e.targetId,i.fa),i}),Nu.apply(this,arguments)}function r_(n,e){return ku.apply(this,arguments)}function ku(){return ku=(0,y.Z)(function*(n,e){const t=S(n);return Ad(t.localStore,e).then(r=>Pt(t,r))}),ku.apply(this,arguments)}function i_(n,e,t,r){return Fu.apply(this,arguments)}function Fu(){return Fu=(0,y.Z)(function*(n,e,t,r){const i=S(n),s=yield function(a,u){const c=S(a),l=S(c.mutationQueue);return c.persistence.runTransaction("Lookup mutation documents","readonly",d=>l.Cn(d,u).next(m=>m?c.localDocuments.getDocuments(d,m):g.resolve(null)))}(i.localStore,e);var u;null!==s?("pending"===t?yield _r(i.remoteStore):"acknowledged"===t||"rejected"===t?(Vu(i,e,r||null),Su(i,e),u=e,S(S(i.localStore).mutationQueue).Fn(u)):D(),yield Pt(i,s)):A("SyncEngine","Cannot apply mutation batch with id: "+e)}),Fu.apply(this,arguments)}function Mu(){return Mu=(0,y.Z)(function*(n,e){const t=S(n);if(io(t),qu(t),!0===e&&!0!==t.La){const r=t.sharedClientState.getAllActiveQueryTargets(),i=yield Wd(t,r.toArray());t.La=!0,yield iu(t.remoteStore,!0);for(const s of i)no(t.remoteStore,s)}else if(!1===e&&!1!==t.La){const r=[];let i=Promise.resolve();t.Da.forEach((s,o)=>{t.sharedClientState.isLocalQueryTarget(o)?r.push(o):i=i.then(()=>(vr(t,o),mr(t.localStore,o,!0))),pr(t.remoteStore,o)}),yield i,yield Wd(t,r),function(o){const a=S(o);a.Fa.forEach((u,c)=>{pr(a.remoteStore,c)}),a.Ma.Vr(),a.Fa=new Map,a.va=new ee(C.comparator)}(t),t.La=!1,yield iu(t.remoteStore,!1)}}),Mu.apply(this,arguments)}function Wd(n,e,t){return Ou.apply(this,arguments)}function Ou(){return Ou=(0,y.Z)(function*(n,e,t){const r=S(n),i=[],s=[];for(const o of e){let a;const u=r.Da.get(o);if(u&&0!==u.length){a=yield fr(r.localStore,Le(u[0]));for(const c of u){const l=r.ba.get(c),d=yield n_(r,l);d.snapshot&&s.push(d.snapshot)}}else{const c=yield vd(r.localStore,o);a=yield fr(r.localStore,c),yield _u(r,Hd(c),o,!1,a.resumeToken)}i.push(a)}return r.Sa.l_(s),i}),Ou.apply(this,arguments)}function Hd(n){return Jl(n.path,n.collectionGroup,n.orderBy,n.filters,n.limit,"F",n.startAt,n.endAt)}function o_(n){return t=S(n).localStore,S(S(t).persistence).Li();var t}function a_(n,e,t,r){return Lu.apply(this,arguments)}function Lu(){return Lu=(0,y.Z)(function*(n,e,t,r){const i=S(n);if(i.La)return void A("SyncEngine","Ignoring unexpected query state notification.");const s=i.Da.get(e);if(s&&s.length>0)switch(t){case"current":case"not-current":{const o=yield Ad(i.localStore,th(s[0])),a=wi.createSynthesizedRemoteEventForCurrentChange(e,"current"===t,Ie.EMPTY_BYTE_STRING);yield Pt(i,o,a);break}case"rejected":yield mr(i.localStore,e,!0),vr(i,e,r);break;default:D()}}),Lu.apply(this,arguments)}function u_(n,e,t){return Bu.apply(this,arguments)}function Bu(){return Bu=(0,y.Z)(function*(n,e,t){const r=io(n);if(r.La){for(const i of e){if(r.Da.has(i)&&r.sharedClientState.isActiveQueryTarget(i)){A("SyncEngine","Adding an already active target "+i);continue}const s=yield vd(r.localStore,i),o=yield fr(r.localStore,s);yield _u(r,Hd(s),o.targetId,!1,o.resumeToken),no(r.remoteStore,o)}for(const i of t)r.Da.has(i)&&(yield mr(r.localStore,i,!1).then(()=>{pr(r.remoteStore,i),vr(r,i)}).catch(Ft))}}),Bu.apply(this,arguments)}function io(n){const e=S(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=jd.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=t_.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=Hp.bind(null,e),e.Sa.l_=Op.bind(null,e.eventManager),e.Sa.ka=Lp.bind(null,e.eventManager),e}function qu(n){const e=S(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=Zp.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=Jp.bind(null,e),e}class Oi{constructor(){this.synchronizeTabs=!1}initialize(e){var t=this;return(0,y.Z)(function*(){t.serializer=Fi(e.databaseInfo.databaseId),t.sharedClientState=t.createSharedClientState(e),t.persistence=t.createPersistence(e),yield t.persistence.start(),t.localStore=t.createLocalStore(e),t.gcScheduler=t.createGarbageCollectionScheduler(e,t.localStore),t.indexBackfillerScheduler=t.createIndexBackfillerScheduler(e,t.localStore)})()}createGarbageCollectionScheduler(e,t){return null}createIndexBackfillerScheduler(e,t){return null}createLocalStore(e){return yd(this.persistence,new _d,e.initialUser,this.serializer)}createPersistence(e){return new Pa(Ws.jr,this.serializer)}createSharedClientState(e){return new Sd}terminate(){var e=this;return(0,y.Z)(function*(){var t,r;null===(t=e.gcScheduler)||void 0===t||t.stop(),null===(r=e.indexBackfillerScheduler)||void 0===r||r.stop(),e.sharedClientState.shutdown(),yield e.persistence.shutdown()})()}}class Uu extends Oi{constructor(e,t,r){super(),this.Qa=e,this.cacheSizeBytes=t,this.forceOwnership=r,this.synchronizeTabs=!1}initialize(e){var t=()=>super.initialize,r=this;return(0,y.Z)(function*(){yield t().call(r,e),yield r.Qa.initialize(r,e),yield qu(r.Qa.syncEngine),yield _r(r.Qa.remoteStore),yield r.persistence.mi(()=>(r.gcScheduler&&!r.gcScheduler.started&&r.gcScheduler.start(),r.indexBackfillerScheduler&&!r.indexBackfillerScheduler.started&&r.indexBackfillerScheduler.start(),Promise.resolve()))})()}createLocalStore(e){return yd(this.persistence,new _d,e.initialUser,this.serializer)}createGarbageCollectionScheduler(e,t){return new ud(this.persistence.referenceDelegate.garbageCollector,e.asyncQueue,t)}createIndexBackfillerScheduler(e,t){const r=new bm(t,this.persistence);return new Dm(e.asyncQueue,r)}createPersistence(e){const t=xa(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),r=void 0!==this.cacheSizeBytes?ke.withCacheSize(this.cacheSizeBytes):ke.DEFAULT;return new Va(this.synchronizeTabs,t,e.clientId,r,e.asyncQueue,xd(),to(),this.serializer,this.sharedClientState,!!this.forceOwnership)}createSharedClientState(e){return new Sd}}class Zd extends Uu{constructor(e,t){super(e,t,!1),this.Qa=e,this.cacheSizeBytes=t,this.synchronizeTabs=!0}initialize(e){var t=()=>super.initialize,r=this;return(0,y.Z)(function*(){yield t().call(r,e);const i=r.Qa.syncEngine;r.sharedClientState instanceof La&&(r.sharedClientState.syncEngine={Ys:i_.bind(null,i),Zs:a_.bind(null,i),Xs:u_.bind(null,i),Li:o_.bind(null,i),Js:r_.bind(null,i)},yield r.sharedClientState.start()),yield r.persistence.mi(function(){var s=(0,y.Z)(function*(o){yield function s_(n,e){return Mu.apply(this,arguments)}(r.Qa.syncEngine,o),r.gcScheduler&&(o&&!r.gcScheduler.started?r.gcScheduler.start():o||r.gcScheduler.stop()),r.indexBackfillerScheduler&&(o&&!r.indexBackfillerScheduler.started?r.indexBackfillerScheduler.start():o||r.indexBackfillerScheduler.stop())});return function(o){return s.apply(this,arguments)}}())})()}createSharedClientState(e){const t=xd();if(!La.D(t))throw new v(_.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");const r=xa(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new La(t,e.asyncQueue,r,e.clientId,e.initialUser)}}class Ar{initialize(e,t){var r=this;return(0,y.Z)(function*(){r.localStore||(r.localStore=e.localStore,r.sharedClientState=e.sharedClientState,r.datastore=r.createDatastore(t),r.remoteStore=r.createRemoteStore(t),r.eventManager=r.createEventManager(t),r.syncEngine=r.createSyncEngine(t,!e.synchronizeTabs),r.sharedClientState.onlineStateHandler=i=>$d(r.syncEngine,i,1),r.remoteStore.remoteSyncer.handleCredentialChange=e_.bind(null,r.syncEngine),yield iu(r.remoteStore,r.syncEngine.isPrimaryClient))})()}createEventManager(e){return new Mp}createDatastore(e){const t=Fi(e.databaseInfo.databaseId),r=new yp(e.databaseInfo);return new Ep(e.authCredentials,e.appCheckCredentials,r,t)}createRemoteStore(e){return r=this.localStore,i=this.datastore,s=e.asyncQueue,o=t=>$d(this.syncEngine,t,0),a=Vd.D()?new Vd:new gp,new wp(r,i,s,o,a);var r,i,s,o,a}createSyncEngine(e,t){return function(i,s,o,a,u,c,l){const d=new zp(i,s,o,a,u,c);return l&&(d.La=!0),d}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}terminate(){var e=this;return(0,y.Z)(function*(){var t,r;yield(r=(0,y.Z)(function*(s){const o=S(s);A("RemoteStore","RemoteStore shutting down."),o.M_.add(5),yield gr(o),o.O_.shutdown(),o.N_.set("Unknown")}),function i(s){return r.apply(this,arguments)})(e.remoteStore),null===(t=e.datastore)||void 0===t||t.terminate()})()}}function Jd(n,e=10240){let t=0;return{read:()=>(0,y.Z)(function*(){if(t<n.byteLength){const r={value:n.slice(t,t+e),done:!1};return t+=e,r}return{done:!0}})(),cancel:()=>(0,y.Z)(function*(){})(),releaseLock(){},closed:Promise.resolve()}}class so{constructor(e){this.observer=e,this.muted=!1}next(e){this.observer.next&&this.Ka(this.observer.next,e)}error(e){this.observer.error?this.Ka(this.observer.error,e):he("Uncaught Error in snapshot listener:",e.toString())}$a(){this.muted=!0}Ka(e,t){this.muted||setTimeout(()=>{this.muted||e(t)},0)}}class h_{constructor(e,t){this.Ua=e,this.serializer=t,this.metadata=new ye,this.buffer=new Uint8Array,this.Wa=new TextDecoder("utf-8"),this.Ga().then(r=>{r&&r.sa()?this.metadata.resolve(r.ia.metadata):this.metadata.reject(new Error(`The first element of the bundle is not a metadata, it is\n             ${JSON.stringify(r?.ia)}`))},r=>this.metadata.reject(r))}close(){return this.Ua.cancel()}getMetadata(){var e=this;return(0,y.Z)(function*(){return e.metadata.promise})()}qa(){var e=this;return(0,y.Z)(function*(){return yield e.getMetadata(),e.Ga()})()}Ga(){var e=this;return(0,y.Z)(function*(){const t=yield e.za();if(null===t)return null;const r=e.Wa.decode(t),i=Number(r);isNaN(i)&&e.ja(`length string (${r}) is not valid number`);const s=yield e.Ha(i);return new Bp(JSON.parse(s),t.length+i)})()}Ja(){return this.buffer.findIndex(e=>e==="{".charCodeAt(0))}za(){var e=this;return(0,y.Z)(function*(){for(;e.Ja()<0&&!(yield e.Ya()););if(0===e.buffer.length)return null;const t=e.Ja();t<0&&e.ja("Reached the end of bundle when a length string is expected.");const r=e.buffer.slice(0,t);return e.buffer=e.buffer.slice(t),r})()}Ha(e){var t=this;return(0,y.Z)(function*(){for(;t.buffer.length<e;)(yield t.Ya())&&t.ja("Reached the end of bundle when more is expected.");const r=t.Wa.decode(t.buffer.slice(0,e));return t.buffer=t.buffer.slice(e),r})()}ja(e){throw this.Ua.cancel(),new Error(`Invalid bundle format: ${e}`)}Ya(){var e=this;return(0,y.Z)(function*(){const t=yield e.Ua.read();if(!t.done){const r=new Uint8Array(e.buffer.length+t.value.length);r.set(e.buffer),r.set(t.value,e.buffer.length),e.buffer=r}return t.done})()}}class d_{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastTransactionError=null,this.writtenDocs=new Set}lookup(e){var t=this;return(0,y.Z)(function*(){if(t.ensureCommitNotCalled(),t.mutations.length>0)throw t.lastTransactionError=new v(_.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes."),t.lastTransactionError;const r=yield(i=(0,y.Z)(function*(o,a){const u=S(o),c={documents:a.map(p=>Pi(u.serializer,p))},l=yield u.Mo("BatchGetDocuments",u.serializer.databaseId,K.emptyPath(),c,a.length),d=new Map;l.forEach(p=>{const w=function Cg(n,e){return"found"in e?function(r,i){b(!!i.found);const s=lt(r,i.found.name),o=de(i.found.updateTime),a=i.found.createTime?de(i.found.createTime):N.min(),u=new De({mapValue:{fields:i.found.fields}});return ie.newFoundDocument(s,o,a,u)}(n,e):"missing"in e?function(r,i){b(!!i.missing),b(!!i.readTime);const s=lt(r,i.missing),o=de(i.readTime);return ie.newNoDocument(s,o)}(n,e):D()}(u.serializer,p);d.set(w.key.toString(),w)});const m=[];return a.forEach(p=>{const w=d.get(p.toString());b(!!w),m.push(w)}),m}),function s(o,a){return i.apply(this,arguments)})(t.datastore,e);var i;return r.forEach(i=>t.recordVersion(i)),r})()}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(r){this.lastTransactionError=r}this.writtenDocs.add(e.toString())}delete(e){this.write(new or(e,this.precondition(e))),this.writtenDocs.add(e.toString())}commit(){var e=this;return(0,y.Z)(function*(){if(e.ensureCommitNotCalled(),e.lastTransactionError)throw e.lastTransactionError;const t=e.readVersions;var r;e.mutations.forEach(r=>{t.delete(r.key.toString())}),t.forEach((r,i)=>{const s=C.fromPath(i);e.mutations.push(new aa(s,e.precondition(s)))}),yield(r=(0,y.Z)(function*(s,o){const a=S(s),u={writes:o.map(c=>Si(a.serializer,c))};yield a.Do("Commit",a.serializer.databaseId,K.emptyPath(),u)}),function i(s,o){return r.apply(this,arguments)})(e.datastore,e.mutations),e.committed=!0})()}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else{if(!e.isNoDocument())throw D();t=N.min()}const r=this.readVersions.get(e.key.toString());if(r){if(!t.isEqual(r))throw new v(_.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){const t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?t.isEqual(N.min())?oe.exists(!1):oe.updateTime(t):oe.none()}preconditionForUpdate(e){const t=this.readVersions.get(e.toString());if(!this.writtenDocs.has(e.toString())&&t){if(t.isEqual(N.min()))throw new v(_.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return oe.updateTime(t)}return oe.exists(!0)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}}class f_{constructor(e,t,r,i,s){this.asyncQueue=e,this.datastore=t,this.options=r,this.updateFunction=i,this.deferred=s,this.Za=r.maxAttempts,this.Jo=new qa(this.asyncQueue,"transaction_retry")}Xa(){this.Za-=1,this.eu()}eu(){var e=this;this.Jo.Ko((0,y.Z)(function*(){const t=new d_(e.datastore),r=e.tu(t);r&&r.then(i=>{e.asyncQueue.enqueueAndForget(()=>t.commit().then(()=>{e.deferred.resolve(i)}).catch(s=>{e.nu(s)}))}).catch(i=>{e.nu(i)})}))}tu(e){try{const t=this.updateFunction(e);return!ci(t)&&t.catch&&t.then?t:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.deferred.reject(t),null}}nu(e){this.Za>0&&this.ru(e)?(this.Za-=1,this.asyncQueue.enqueueAndForget(()=>(this.eu(),Promise.resolve()))):this.deferred.reject(e)}ru(e){if("FirebaseError"===e.name){const t=e.code;return"aborted"===t||"failed-precondition"===t||"already-exists"===t||!Ih(t)}return!1}}class m_{constructor(e,t,r,i){var s=this;this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=r,this.databaseInfo=i,this.user=ve.UNAUTHENTICATED,this.clientId=fl.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(r,function(){var o=(0,y.Z)(function*(a){A("FirestoreClient","Received user=",a.uid),yield s.authCredentialListener(a),s.user=a});return function(a){return o.apply(this,arguments)}}()),this.appCheckCredentials.start(r,o=>(A("FirestoreClient","Received new app check token=",o),this.appCheckCredentialListener(o,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new v(_.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){var e=this;this.asyncQueue.enterRestrictedMode();const t=new ye;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((0,y.Z)(function*(){try{e._onlineComponents&&(yield e._onlineComponents.terminate()),e._offlineComponents&&(yield e._offlineComponents.terminate()),e.authCredentials.shutdown(),e.appCheckCredentials.shutdown(),t.resolve()}catch(r){const i=Ir(r,"Failed to shutdown persistence");t.reject(i)}})),t.promise}}function oo(n,e){return Gu.apply(this,arguments)}function Gu(){return Gu=(0,y.Z)(function*(n,e){n.asyncQueue.verifyOperationInProgress(),A("FirestoreClient","Initializing OfflineComponentProvider");const t=n.configuration;yield e.initialize(t);let r=t.initialUser;n.setCredentialChangeListener(function(){var i=(0,y.Z)(function*(s){r.isEqual(s)||(yield Id(e.localStore,s),r=s)});return function(s){return i.apply(this,arguments)}}()),e.persistence.setDatabaseDeletedListener(()=>n.terminate()),n._offlineComponents=e}),Gu.apply(this,arguments)}function zu(n,e){return Ku.apply(this,arguments)}function Ku(){return Ku=(0,y.Z)(function*(n,e){n.asyncQueue.verifyOperationInProgress();const t=yield ju(n);A("FirestoreClient","Initializing OnlineComponentProvider"),yield e.initialize(t,n.configuration),n.setCredentialChangeListener(r=>Md(e.remoteStore,r)),n.setAppCheckTokenChangeListener((r,i)=>Md(e.remoteStore,i)),n._onlineComponents=e}),Ku.apply(this,arguments)}function Yd(n){return"FirebaseError"===n.name?n.code===_.FAILED_PRECONDITION||n.code===_.UNIMPLEMENTED:!(typeof DOMException<"u"&&n instanceof DOMException)||22===n.code||20===n.code||11===n.code}function ju(n){return $u.apply(this,arguments)}function $u(){return $u=(0,y.Z)(function*(n){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){A("FirestoreClient","Using user provided OfflineComponentProvider");try{yield oo(n,n._uninitializedComponentsProvider._offline)}catch(e){const t=e;if(!Yd(t))throw t;Ue("Error using user provided cache. Falling back to memory cache: "+t),yield oo(n,new Oi)}}else A("FirestoreClient","Using default OfflineComponentProvider"),yield oo(n,new Oi);return n._offlineComponents}),$u.apply(this,arguments)}function ao(n){return Qu.apply(this,arguments)}function Qu(){return Qu=(0,y.Z)(function*(n){return n._onlineComponents||(n._uninitializedComponentsProvider?(A("FirestoreClient","Using user provided OnlineComponentProvider"),yield zu(n,n._uninitializedComponentsProvider._online)):(A("FirestoreClient","Using default OnlineComponentProvider"),yield zu(n,new Ar))),n._onlineComponents}),Qu.apply(this,arguments)}function Xd(n){return ju(n).then(e=>e.persistence)}function wr(n){return ju(n).then(e=>e.localStore)}function ef(n){return ao(n).then(e=>e.remoteStore)}function Wu(n){return ao(n).then(e=>e.syncEngine)}function Rr(n){return Hu.apply(this,arguments)}function Hu(){return Hu=(0,y.Z)(function*(n){const e=yield ao(n),t=e.eventManager;return t.onListen=Kp.bind(null,e.syncEngine),t.onUnlisten=$p.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=jp.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=Qp.bind(null,e.syncEngine),t}),Hu.apply(this,arguments)}function nf(n,e,t={}){const r=new ye;return n.asyncQueue.enqueueAndForget((0,y.Z)(function*(){return function(s,o,a,u,c){const l=new so({next:m=>{o.enqueueAndForget(()=>cu(s,d));const p=m.docs.has(a);!p&&m.fromCache?c.reject(new v(_.UNAVAILABLE,"Failed to get document because the client is offline.")):p&&m.fromCache&&u&&"server"===u.source?c.reject(new v(_.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):c.resolve(m)},error:m=>c.reject(m)}),d=new fu(er(a.path),l,{includeMetadataChanges:!0,ra:!0});return au(s,d)}(yield Rr(n),n.asyncQueue,e,t,r)})),r.promise}function rf(n,e,t={}){const r=new ye;return n.asyncQueue.enqueueAndForget((0,y.Z)(function*(){return function(s,o,a,u,c){const l=new so({next:m=>{o.enqueueAndForget(()=>cu(s,d)),m.fromCache&&"server"===u.source?c.reject(new v(_.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):c.resolve(m)},error:m=>c.reject(m)}),d=new fu(a,l,{includeMetadataChanges:!0,ra:!0});return au(s,d)}(yield Rr(n),n.asyncQueue,e,t,r)})),r.promise}function sf(n){const e={};return void 0!==n.timeoutSeconds&&(e.timeoutSeconds=n.timeoutSeconds),e}const of=new Map;function Zu(n,e,t){if(!t)throw new v(_.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function af(n,e,t,r){if(!0===e&&!0===r)throw new v(_.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function uf(n){if(!C.isDocumentKey(n))throw new v(_.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function cf(n){if(C.isDocumentKey(n))throw new v(_.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function uo(n){if(void 0===n)return"undefined";if(null===n)return"null";if("string"==typeof n)return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if("number"==typeof n||"boolean"==typeof n)return""+n;if("object"==typeof n){if(n instanceof Array)return"an array";{const e=(r=n).constructor?r.constructor.name:null;return e?`a custom ${e} object`:"an object"}}var r;return"function"==typeof n?"a function":D()}function z(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new v(_.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const t=uo(n);throw new v(_.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}function lf(n,e){if(e<=0)throw new v(_.INVALID_ARGUMENT,`Function ${n}() requires a positive number, but it was: ${e}.`)}class hf{constructor(e){var t,r;if(void 0===e.host){if(void 0!==e.ssl)throw new v(_.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=null===(t=e.ssl)||void 0===t||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,void 0===e.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==e.cacheSizeBytes&&e.cacheSizeBytes<1048576)throw new v(_.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}af("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!(this.experimentalForceLongPolling||void 0!==e.experimentalAutoDetectLongPolling&&!e.experimentalAutoDetectLongPolling),this.experimentalLongPollingOptions=sf(null!==(r=e.experimentalLongPollingOptions)&&void 0!==r?r:{}),function(s){if(void 0!==s.timeoutSeconds){if(isNaN(s.timeoutSeconds))throw new v(_.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (must not be NaN)`);if(s.timeoutSeconds<5)throw new v(_.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (minimum allowed value is 5)`);if(s.timeoutSeconds>30)throw new v(_.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&this.experimentalLongPollingOptions.timeoutSeconds===e.experimentalLongPollingOptions.timeoutSeconds&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class Li{constructor(e,t,r,i){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=r,this._app=i,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new hf({}),this._settingsFrozen=!1}get app(){if(!this._app)throw new v(_.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return void 0!==this._terminateTask}_setSettings(e){if(this._settingsFrozen)throw new v(_.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new hf(e),void 0!==e.credentials&&(this._authCredentials=function(r){if(!r)return new Im;switch(r.type){case"firstParty":return new Am(r.sessionIndex||"0",r.iamToken||null,r.authTokenFactory||null);case"provider":return r.client;default:throw new v(_.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){const r=of.get(t);r&&(A("ComponentProvider","Removing Datastore"),of.delete(t),r.terminate())}(this),Promise.resolve()}}function df(n,e,t,r={}){var i;const s=(n=z(n,Li))._getSettings(),o=`${e}:${t}`;if("firestore.googleapis.com"!==s.host&&s.host!==o&&Ue("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),n._setSettings(Object.assign(Object.assign({},s),{host:o,ssl:!1})),r.mockUserToken){let a,u;if("string"==typeof r.mockUserToken)a=r.mockUserToken,u=ve.MOCK_USER;else{a=(0,U.Sg)(r.mockUserToken,null===(i=n._app)||void 0===i?void 0:i.options.projectId);const c=r.mockUserToken.sub||r.mockUserToken.user_id;if(!c)throw new v(_.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");u=new ve(c)}n._authCredentials=new Tm(new hl(a,u))}}class be{constructor(e,t,r){this.converter=t,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new be(this.firestore,e,this._query)}}class ce{constructor(e,t,r){this.converter=t,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new ht(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new ce(this.firestore,e,this._key)}}class ht extends be{constructor(e,t,r){super(e,t,er(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new ce(this.firestore,null,new C(e))}withConverter(e){return new ht(this.firestore,e,this._path)}}function R_(n,e,...t){if(n=(0,U.m9)(n),Zu("collection","path",e),n instanceof Li){const r=K.fromString(e,...t);return cf(r),new ht(n,null,r)}{if(!(n instanceof ce||n instanceof ht))throw new v(_.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(K.fromString(e,...t));return cf(r),new ht(n.firestore,null,r)}}function P_(n,e){if(n=z(n,Li),Zu("collectionGroup","collection id",e),e.indexOf("/")>=0)throw new v(_.INVALID_ARGUMENT,`Invalid collection ID '${e}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new be(n,null,(r=e,new vt(K.emptyPath(),r)));var r}function ff(n,e,...t){if(n=(0,U.m9)(n),1===arguments.length&&(e=fl.newId()),Zu("doc","path",e),n instanceof Li){const r=K.fromString(e,...t);return uf(r),new ce(n,null,new C(r))}{if(!(n instanceof ce||n instanceof ht))throw new v(_.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(K.fromString(e,...t));return uf(r),new ce(n.firestore,n instanceof ht?n.converter:null,new C(r))}}function S_(n,e){return n=(0,U.m9)(n),e=(0,U.m9)(e),(n instanceof ce||n instanceof ht)&&(e instanceof ce||e instanceof ht)&&n.firestore===e.firestore&&n.path===e.path&&n.converter===e.converter}function Ju(n,e){return n=(0,U.m9)(n),e=(0,U.m9)(e),n instanceof be&&e instanceof be&&n.firestore===e.firestore&&_i(n._query,e._query)&&n.converter===e.converter}class V_{constructor(){this.iu=Promise.resolve(),this.su=[],this.ou=!1,this._u=[],this.au=null,this.uu=!1,this.cu=!1,this.lu=[],this.Jo=new qa(this,"async_queue_retry"),this.hu=()=>{const t=to();t&&A("AsyncQueue","Visibility state changed to "+t.visibilityState),this.Jo.Uo()};const e=to();e&&"function"==typeof e.addEventListener&&e.addEventListener("visibilitychange",this.hu)}get isShuttingDown(){return this.ou}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.Pu(),this.Iu(e)}enterRestrictedMode(e){if(!this.ou){this.ou=!0,this.cu=e||!1;const t=to();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.hu)}}enqueue(e){if(this.Pu(),this.ou)return new Promise(()=>{});const t=new ye;return this.Iu(()=>this.ou&&this.cu?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.su.push(e),this.Tu()))}Tu(){var e=this;return(0,y.Z)(function*(){if(0!==e.su.length){try{yield e.su[0](),e.su.shift(),e.Jo.reset()}catch(t){if(!Mt(t))throw t;A("AsyncQueue","Operation failed with retryable error: "+t)}e.su.length>0&&e.Jo.Ko(()=>e.Tu())}})()}Iu(e){const t=this.iu.then(()=>(this.uu=!0,e().catch(r=>{throw this.au=r,this.uu=!1,he("INTERNAL UNHANDLED ERROR: ",function(o){let a=o.message||"";return o.stack&&(a=o.stack.includes(o.message)?o.stack:o.message+"\n"+o.stack),a}(r)),r}).then(r=>(this.uu=!1,r))));return this.iu=t,t}enqueueAfterDelay(e,t,r){this.Pu(),this.lu.indexOf(e)>-1&&(t=0);const i=ou.createAndSchedule(this,e,t,r,s=>this.Eu(s));return this._u.push(i),i}Pu(){this.au&&D()}verifyOperationInProgress(){}du(){var e=this;return(0,y.Z)(function*(){let t;do{t=e.iu,yield t}while(t!==e.iu)})()}Au(e){for(const t of this._u)if(t.timerId===e)return!0;return!1}Ru(e){return this.du().then(()=>{this._u.sort((t,r)=>t.targetTimeMs-r.targetTimeMs);for(const t of this._u)if(t.skipDelay(),"all"!==e&&t.timerId===e)break;return this.du()})}Vu(e){this.lu.push(e)}Eu(e){const t=this._u.indexOf(e);this._u.splice(t,1)}}function Yu(n){return function(t,r){if("object"!=typeof t||null===t)return!1;const i=t;for(const s of["next","error","complete"])if(s in i&&"function"==typeof i[s])return!0;return!1}(n)}class x_{constructor(){this._progressObserver={},this._taskCompletionResolver=new ye,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(e,t,r){this._progressObserver={next:e,error:t,complete:r}}catch(e){return this._taskCompletionResolver.promise.catch(e)}then(e,t){return this._taskCompletionResolver.promise.then(e,t)}_completeWith(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}_failWith(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}_updateProgress(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}}const C_=-1;class te extends Li{constructor(e,t,r,i){super(e,t,r,i),this.type="firestore",this._queue=new V_,this._persistenceKey=i?.name||"[DEFAULT]"}_terminate(){return this._firestoreClient||mf(this),this._firestoreClient.terminate()}}function le(n){return n._firestoreClient||mf(n),n._firestoreClient.verifyNotTerminated(),n._firestoreClient}function mf(n){var e,t,r;const i=n._freezeSettings(),s=(u=(null===(e=n._app)||void 0===e?void 0:e.options.appId)||"",new Xm(n._databaseId,u,n._persistenceKey,(l=i).host,l.ssl,l.experimentalForceLongPolling,l.experimentalAutoDetectLongPolling,sf(l.experimentalLongPollingOptions),l.useFetchStreams));var u,l;n._firestoreClient=new m_(n._authCredentials,n._appCheckCredentials,n._queue,s),null!==(t=i.localCache)&&void 0!==t&&t._offlineComponentProvider&&null!==(r=i.localCache)&&void 0!==r&&r._onlineComponentProvider&&(n._firestoreClient._uninitializedComponentsProvider={_offlineKind:i.localCache.kind,_offline:i.localCache._offlineComponentProvider,_online:i.localCache._onlineComponentProvider})}function D_(n,e){pf(n=z(n,te));const t=le(n);if(t._uninitializedComponentsProvider)throw new v(_.FAILED_PRECONDITION,"SDK cache is already specified.");Ue("enableIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");const r=n._freezeSettings(),i=new Ar;return gf(t,i,new Uu(i,r.cacheSizeBytes,e?.forceOwnership))}function b_(n){pf(n=z(n,te));const e=le(n);if(e._uninitializedComponentsProvider)throw new v(_.FAILED_PRECONDITION,"SDK cache is already specified.");Ue("enableMultiTabIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");const t=n._freezeSettings(),r=new Ar;return gf(e,r,new Zd(r,t.cacheSizeBytes))}function gf(n,e,t){const r=new ye;return n.asyncQueue.enqueue((0,y.Z)(function*(){try{yield oo(n,t),yield zu(n,e),r.resolve()}catch(i){const s=i;if(!Yd(s))throw s;Ue("Error enabling indexeddb cache. Falling back to memory cache: "+s),r.reject(s)}})).then(()=>r.promise)}function N_(n){if(n._initialized&&!n._terminated)throw new v(_.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");const e=new ye;return n._queue.enqueueAndForgetEvenWhileRestricted((0,y.Z)(function*(){try{yield(t=(0,y.Z)(function*(i){if(!ot.D())return Promise.resolve();const s=i+"main";yield ot.delete(s)}),function r(i){return t.apply(this,arguments)})(xa(n._databaseId,n._persistenceKey)),e.resolve()}catch(t){e.reject(t)}var t})),e.promise}function k_(n){return function(t){const r=new ye;return t.asyncQueue.enqueueAndForget((0,y.Z)(function*(){return function Yp(n,e){return Pu.apply(this,arguments)}(yield Wu(t),r)})),r.promise}(le(n=z(n,te)))}function F_(n){return function g_(n){return n.asyncQueue.enqueue((0,y.Z)(function*(){const e=yield Xd(n),t=yield ef(n);return e.setNetworkEnabled(!0),function(i){const s=S(i);return s.M_.delete(0),Mi(s)}(t)}))}(le(n=z(n,te)))}function M_(n){return function p_(n){return n.asyncQueue.enqueue((0,y.Z)(function*(){const e=yield Xd(n),t=yield ef(n);return e.setNetworkEnabled(!1),(r=(0,y.Z)(function*(s){const o=S(s);o.M_.add(0),yield gr(o),o.N_.set("Offline")}),function i(s){return r.apply(this,arguments)})(t);var r}))}(le(n=z(n,te)))}function O_(n,e){const t=le(n=z(n,te)),r=new x_;return function T_(n,e,t,r){const i=function(o,a){let u;return u="string"==typeof o?Eh().encode(o):o,l=function(l,d){if(l instanceof Uint8Array)return Jd(l,d);if(l instanceof ArrayBuffer)return Jd(new Uint8Array(l),d);if(l instanceof ReadableStream)return l.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}(u),new h_(l,a);var l}(t,Fi(e));n.asyncQueue.enqueueAndForget((0,y.Z)(function*(){!function c_(n,e,t){const r=S(n);var i;(i=(0,y.Z)(function*(o,a,u){try{const c=yield a.getMetadata();if(yield function(w,x){const R=S(w),k=de(x.createTime);return R.persistence.runTransaction("hasNewerBundle","readonly",L=>R.Kr.getBundleMetadata(L,x.id)).then(L=>!!L&&L.createTime.compareTo(k)>=0)}(o.localStore,c))return yield a.close(),u._completeWith({taskState:"Success",documentsLoaded:(w=c).totalDocuments,bytesLoaded:w.totalBytes,totalDocuments:w.totalDocuments,totalBytes:w.totalBytes}),Promise.resolve(new Set);u._updateProgress(qd(c));const l=new qp(c,o.localStore,a.serializer);let d=yield a.qa();for(;d;){const p=yield l._a(d);p&&u._updateProgress(p),d=yield a.qa()}const m=yield l.complete();return yield Pt(o,m.ca,void 0),yield function(w,x){const R=S(w);return R.persistence.runTransaction("Save bundle","readwrite",k=>R.Kr.saveBundleMetadata(k,x))}(o.localStore,c),u._completeWith(m.progress),Promise.resolve(m.ua)}catch(c){return Ue("SyncEngine",`Loading bundle failed with ${c}`),u._failWith(c),Promise.resolve(new Set)}var w}),function s(o,a,u){return i.apply(this,arguments)})(r,e,t).then(i=>{r.sharedClientState.notifyBundleLoaded(i)})}(yield Wu(n),i,r)}))}(t,n._databaseId,e,r),r}function L_(n,e){return function E_(n,e){return n.asyncQueue.enqueue((0,y.Z)(function*(){return function(r,i){const s=S(r);return s.persistence.runTransaction("Get named query","readonly",o=>s.Kr.getNamedQuery(o,i))}(yield wr(n),e)}))}(le(n=z(n,te)),e).then(t=>t?new be(n,null,t.query):null)}function pf(n){if(n._initialized||n._terminated)throw new v(_.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}class Ht{constructor(e){this._byteString=e}static fromBase64String(e){try{return new Ht(Ie.fromBase64String(e))}catch(t){throw new v(_.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new Ht(Ie.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}class Zt{constructor(...e){for(let t=0;t<e.length;++t)if(0===e[t].length)throw new v(_.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new re(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class Tn{constructor(e){this._methodName=e}}class co{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new v(_.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new v(_.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return O(this._lat,e._lat)||O(this._long,e._long)}}const q_=/^__.*__$/;class U_{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return null!==this.fieldMask?new wt(e,this.data,this.fieldMask,t,this.fieldTransforms):new sr(e,this.data,t,this.fieldTransforms)}}class _f{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return new wt(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function yf(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw D()}}class lo{constructor(e,t,r,i,s,o){this.settings=e,this.databaseId=t,this.serializer=r,this.ignoreUndefinedProperties=i,void 0===s&&this.mu(),this.fieldTransforms=s||[],this.fieldMask=o||[]}get path(){return this.settings.path}get fu(){return this.settings.fu}gu(e){return new lo(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}pu(e){var t;const r=null===(t=this.path)||void 0===t?void 0:t.child(e),i=this.gu({path:r,yu:!1});return i.wu(e),i}Su(e){var t;const r=null===(t=this.path)||void 0===t?void 0:t.child(e),i=this.gu({path:r,yu:!1});return i.mu(),i}bu(e){return this.gu({path:void 0,yu:!0})}Du(e){return mo(e,this.settings.methodName,this.settings.Cu||!1,this.path,this.settings.vu)}contains(e){return void 0!==this.fieldMask.find(t=>e.isPrefixOf(t))||void 0!==this.fieldTransforms.find(t=>e.isPrefixOf(t.field))}mu(){if(this.path)for(let e=0;e<this.path.length;e++)this.wu(this.path.get(e))}wu(e){if(0===e.length)throw this.Du("Document fields must not be empty");if(yf(this.fu)&&q_.test(e))throw this.Du('Document fields cannot begin and end with "__"')}}class G_{constructor(e,t,r){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=r||Fi(e)}Fu(e,t,r,i=!1){return new lo({fu:e,methodName:t,vu:r,path:re.emptyPath(),yu:!1,Cu:i},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function En(n){const e=n._freezeSettings(),t=Fi(n._databaseId);return new G_(n._databaseId,!!e.ignoreUndefinedProperties,t)}function ho(n,e,t,r,i,s={}){const o=n.Fu(s.merge||s.mergeFields?2:0,e,t,i);sc("Data must be an object, but it was:",o,r);const a=Ef(r,o);let u,c;if(s.merge)u=new Ge(o.fieldMask),c=o.fieldTransforms;else if(s.mergeFields){const l=[];for(const d of s.mergeFields){const m=Ui(e,d,t);if(!o.contains(m))throw new v(_.INVALID_ARGUMENT,`Field '${m}' is specified in your field mask but missing from your input data.`);Af(l,m)||l.push(m)}u=new Ge(l),c=o.fieldTransforms.filter(d=>u.covers(d.field))}else u=null,c=o.fieldTransforms;return new U_(new De(a),u,c)}class qi extends Tn{_toFieldTransform(e){if(2!==e.fu)throw e.Du(1===e.fu?`${this._methodName}() can only appear at the top level of your update data`:`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof qi}}function If(n,e,t){return new lo({fu:3,vu:e.settings.vu,methodName:n._methodName,yu:t},e.databaseId,e.serializer,e.ignoreUndefinedProperties)}class Xu extends Tn{_toFieldTransform(e){return new Ei(e.path,new rr)}isEqual(e){return e instanceof Xu}}class ec extends Tn{constructor(e,t){super(e),this.Mu=t}_toFieldTransform(e){const t=If(this,e,!0),r=this.Mu.map(s=>vn(s,t)),i=new hn(r);return new Ei(e.path,i)}isEqual(e){return e instanceof ec&&(0,U.vZ)(this.Mu,e.Mu)}}class tc extends Tn{constructor(e,t){super(e),this.Mu=t}_toFieldTransform(e){const t=If(this,e,!0),r=this.Mu.map(s=>vn(s,t)),i=new dn(r);return new Ei(e.path,i)}isEqual(e){return e instanceof tc&&(0,U.vZ)(this.Mu,e.Mu)}}class nc extends Tn{constructor(e,t){super(e),this.xu=t}_toFieldTransform(e){const t=new ir(e.serializer,uh(e.serializer,this.xu));return new Ei(e.path,t)}isEqual(e){return e instanceof nc&&this.xu===e.xu}}function rc(n,e,t,r){const i=n.Fu(1,e,t);sc("Data must be an object, but it was:",i,r);const s=[],o=De.empty();Ot(r,(u,c)=>{const l=fo(e,u,t);c=(0,U.m9)(c);const d=i.Su(l);if(c instanceof qi)s.push(l);else{const m=vn(c,d);null!=m&&(s.push(l),o.set(l,m))}});const a=new Ge(s);return new _f(o,a,i.fieldTransforms)}function ic(n,e,t,r,i,s){const o=n.Fu(1,e,t),a=[Ui(e,r,t)],u=[i];if(s.length%2!=0)throw new v(_.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let m=0;m<s.length;m+=2)a.push(Ui(e,s[m])),u.push(s[m+1]);const c=[],l=De.empty();for(let m=a.length-1;m>=0;--m)if(!Af(c,a[m])){const p=a[m];let w=u[m];w=(0,U.m9)(w);const x=o.Su(p);if(w instanceof qi)c.push(p);else{const R=vn(w,x);null!=R&&(c.push(p),l.set(p,R))}}const d=new Ge(c);return new _f(l,d,o.fieldTransforms)}function Tf(n,e,t,r=!1){return vn(t,n.Fu(r?4:3,e))}function vn(n,e){if(vf(n=(0,U.m9)(n)))return sc("Unsupported field value:",e,n),Ef(n,e);if(n instanceof Tn)return function(r,i){if(!yf(i.fu))throw i.Du(`${r._methodName}() can only be used with update() and set()`);if(!i.path)throw i.Du(`${r._methodName}() is not currently supported inside arrays`);const s=r._toFieldTransform(i);s&&i.fieldTransforms.push(s)}(n,e),null;if(void 0===n&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.yu&&4!==e.fu)throw e.Du("Nested arrays are not supported");return function(r,i){const s=[];let o=0;for(const a of r){let u=vn(a,i.bu(o));null==u&&(u={nullValue:"NULL_VALUE"}),s.push(u),o++}return{arrayValue:{values:s}}}(n,e)}return function(r,i){if(null===(r=(0,U.m9)(r)))return{nullValue:"NULL_VALUE"};if("number"==typeof r)return uh(i.serializer,r);if("boolean"==typeof r)return{booleanValue:r};if("string"==typeof r)return{stringValue:r};if(r instanceof Date){const s=se.fromDate(r);return{timestampValue:ar(i.serializer,s)}}if(r instanceof se){const s=new se(r.seconds,1e3*Math.floor(r.nanoseconds/1e3));return{timestampValue:ar(i.serializer,s)}}if(r instanceof co)return{geoPointValue:{latitude:r.latitude,longitude:r.longitude}};if(r instanceof Ht)return{bytesValue:xh(i.serializer,r._byteString)};if(r instanceof ce){const s=i.databaseId,o=r.firestore._databaseId;if(!o.isEqual(s))throw i.Du(`Document reference is for database ${o.projectId}/${o.database} but should be for database ${s.projectId}/${s.database}`);return{referenceValue:fa(r.firestore._databaseId||i.databaseId,r._key.path)}}throw i.Du(`Unsupported field value: ${uo(r)}`)}(n,e)}function Ef(n,e){const t={};return Cl(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):Ot(n,(r,i)=>{const s=vn(i,e.pu(r));null!=s&&(t[r]=s)}),{mapValue:{fields:t}}}function vf(n){return!("object"!=typeof n||null===n||n instanceof Array||n instanceof Date||n instanceof se||n instanceof co||n instanceof Ht||n instanceof ce||n instanceof Tn)}function sc(n,e,t){if(!vf(t)||"object"!=typeof(i=t)||null===i||Object.getPrototypeOf(i)!==Object.prototype&&null!==Object.getPrototypeOf(i)){const r=uo(t);throw e.Du("an object"===r?n+" a custom object":n+" "+r)}var i}function Ui(n,e,t){if((e=(0,U.m9)(e))instanceof Zt)return e._internalPath;if("string"==typeof e)return fo(n,e);throw mo("Field path arguments must be of type string or ",n,!1,void 0,t)}const z_=new RegExp("[~\\*/\\[\\]]");function fo(n,e,t){if(e.search(z_)>=0)throw mo(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new Zt(...e.split("."))._internalPath}catch{throw mo(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function mo(n,e,t,r,i){const s=r&&!r.isEmpty(),o=void 0!==i;let a=`Function ${e}() called with invalid data`;t&&(a+=" (via `toFirestore()`)"),a+=". ";let u="";return(s||o)&&(u+=" (found",s&&(u+=` in field ${r}`),o&&(u+=` in document ${i}`),u+=")"),new v(_.INVALID_ARGUMENT,a+n+u)}function Af(n,e){return n.some(t=>t.isEqual(e))}class Gi{constructor(e,t,r,i,s){this._firestore=e,this._userDataWriter=t,this._key=r,this._document=i,this._converter=s}get id(){return this._key.path.lastSegment()}get ref(){return new ce(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){const e=new K_(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(go("DocumentSnapshot.get",e));if(null!==t)return this._userDataWriter.convertValue(t)}}}class K_ extends Gi{data(){return super.data()}}function go(n,e){return"string"==typeof e?fo(n,e):e instanceof Zt?e._internalPath:e._delegate._internalPath}function wf(n){if("L"===n.limitType&&0===n.explicitOrderBy.length)throw new v(_.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class oc{}class zi extends oc{}function j_(n,e,...t){let r=[];e instanceof oc&&r.push(e),r=r.concat(t),function(s){const o=s.filter(u=>u instanceof Pr).length,a=s.filter(u=>u instanceof Ki).length;if(o>1||o>0&&a>0)throw new v(_.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(r);for(const i of r)n=i._apply(n);return n}class Ki extends zi{constructor(e,t,r){super(),this._field=e,this._op=t,this._value=r,this.type="where"}static _create(e,t,r){return new Ki(e,t,r)}_apply(e){const t=this._parse(e);return Vf(e._query,t),new be(e.firestore,e.converter,sa(e._query,t))}_parse(e){const t=En(e.firestore);return function(s,o,a,u,c,l,d){let m;if(c.isKeyField()){if("array-contains"===l||"array-contains-any"===l)throw new v(_.INVALID_ARGUMENT,`Invalid Query. You can't perform '${l}' queries on documentId().`);if("in"===l||"not-in"===l){Sf(d,l);const p=[];for(const w of d)p.push(Pf(u,s,w));m={arrayValue:{values:p}}}else m=Pf(u,s,d)}else"in"!==l&&"not-in"!==l&&"array-contains-any"!==l||Sf(d,l),m=Tf(a,"where",d,"in"===l||"not-in"===l);return j.create(c,l,m)}(e._query,0,t,e.firestore._databaseId,this._field,this._op,this._value)}}function $_(n,e,t){const r=e,i=go("where",n);return Ki._create(i,r,t)}class Pr extends oc{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new Pr(e,t)}_parse(e){const t=this._queryConstraints.map(r=>r._parse(e)).filter(r=>r.getFilters().length>0);return 1===t.length?t[0]:Z.create(t,this._getOperator())}_apply(e){const t=this._parse(e);return 0===t.getFilters().length?e:(function(i,s){let o=i;const a=s.getFlattenedFilters();for(const u of a)Vf(o,u),o=sa(o,u)}(e._query,t),new be(e.firestore,e.converter,sa(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return"and"===this.type?"and":"or"}}class ac extends zi{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new ac(e,t)}_apply(e){const t=function(i,s,o){if(null!==i.startAt)throw new v(_.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==i.endAt)throw new v(_.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new gi(s,o)}(e._query,this._field,this._direction);return new be(e.firestore,e.converter,function(i,s){const o=i.explicitOrderBy.concat([s]);return new vt(i.path,i.collectionGroup,o,i.filters.slice(),i.limit,i.limitType,i.startAt,i.endAt)}(e._query,t))}}function Q_(n,e="asc"){const t=e,r=go("orderBy",n);return ac._create(r,t)}class po extends zi{constructor(e,t,r){super(),this.type=e,this._limit=t,this._limitType=r}static _create(e,t,r){return new po(e,t,r)}_apply(e){return new be(e.firestore,e.converter,Fs(e._query,this._limit,this._limitType))}}function W_(n){return lf("limit",n),po._create("limit",n,"F")}function H_(n){return lf("limitToLast",n),po._create("limitToLast",n,"L")}class _o extends zi{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new _o(e,t,r)}_apply(e){const t=Rf(e,this.type,this._docOrFields,this._inclusive);return new be(e.firestore,e.converter,(s=t,new vt((i=e._query).path,i.collectionGroup,i.explicitOrderBy.slice(),i.filters.slice(),i.limit,i.limitType,s,i.endAt)));var i,s}}function Z_(...n){return _o._create("startAt",n,!0)}function J_(...n){return _o._create("startAfter",n,!1)}class yo extends zi{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new yo(e,t,r)}_apply(e){const t=Rf(e,this.type,this._docOrFields,this._inclusive);return new be(e.firestore,e.converter,(s=t,new vt((i=e._query).path,i.collectionGroup,i.explicitOrderBy.slice(),i.filters.slice(),i.limit,i.limitType,i.startAt,s)));var i,s}}function Y_(...n){return yo._create("endBefore",n,!1)}function X_(...n){return yo._create("endAt",n,!0)}function Rf(n,e,t,r){if(t[0]=(0,U.m9)(t[0]),t[0]instanceof Gi)return function(s,o,a,u,c){if(!u)throw new v(_.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${a}().`);const l=[];for(const d of tr(s))if(d.field.isKeyField())l.push(cn(o,u.key));else{const m=u.data.field(d.field);if(Vs(m))throw new v(_.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+d.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===m){const p=d.field.canonicalString();throw new v(_.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${p}' (used as the orderBy) does not exist.`)}l.push(m)}return new Gt(l,c)}(n._query,n.firestore._databaseId,e,t[0]._document,r);{const i=En(n.firestore);return function(o,a,u,c,l,d){const m=o.explicitOrderBy;if(l.length>m.length)throw new v(_.INVALID_ARGUMENT,`Too many arguments provided to ${c}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);const p=[];for(let w=0;w<l.length;w++){const x=l[w];if(m[w].field.isKeyField()){if("string"!=typeof x)throw new v(_.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${c}(), but got a ${typeof x}`);if(!ia(o)&&-1!==x.indexOf("/"))throw new v(_.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${c}() must be a plain document ID, but '${x}' contains a slash.`);const R=o.path.child(K.fromString(x));if(!C.isDocumentKey(R))throw new v(_.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${c}() must result in a valid document path, but '${R}' is not because it contains an odd number of segments.`);const k=new C(R);p.push(cn(a,k))}else{const R=Tf(u,c,x);p.push(R)}}return new Gt(p,d)}(n._query,n.firestore._databaseId,i,e,t,r)}}function Pf(n,e,t){if("string"==typeof(t=(0,U.m9)(t))){if(""===t)throw new v(_.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!ia(e)&&-1!==t.indexOf("/"))throw new v(_.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);const r=e.path.child(K.fromString(t));if(!C.isDocumentKey(r))throw new v(_.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return cn(n,new C(r))}if(t instanceof ce)return cn(n,t._key);throw new v(_.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${uo(t)}.`)}function Sf(n,e){if(!Array.isArray(n)||0===n.length)throw new v(_.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function Vf(n,e){const t=function(i,s){for(const o of i)for(const a of o.getFlattenedFilters())if(s.indexOf(a.op)>=0)return a.op;return null}(n.filters,function(i){switch(i){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(null!==t)throw new v(_.INVALID_ARGUMENT,t===e.op?`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`:`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}class uc{convertValue(e,t="none"){switch(qt(e)){case 0:return null;case 1:return e.booleanValue;case 2:return ue(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(Et(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 10:return this.convertObject(e.mapValue,t);default:throw D()}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const r={};return Ot(e,(i,s)=>{r[i]=this.convertValue(s,t)}),r}convertGeoPoint(e){return new co(ue(e.latitude),ue(e.longitude))}convertArray(e,t){return(e.values||[]).map(r=>this.convertValue(r,t))}convertServerTimestamp(e,t){switch(t){case"previous":const r=xs(e);return null==r?null:this.convertValue(r,t);case"estimate":return this.convertTimestamp(hi(e));default:return null}}convertTimestamp(e){const t=Tt(e);return new se(t.seconds,t.nanos)}convertDocumentKey(e,t){const r=K.fromString(e);b(qh(r));const i=new Lt(r.get(1),r.get(3)),s=new C(r.popFirst(5));return i.isEqual(t)||he(`Document ${s} contains a document reference within a different database (${i.projectId}/${i.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),s}}function Io(n,e,t){let r;return r=n?t&&(t.merge||t.mergeFields)?n.toFirestore(e,t):n.toFirestore(e):e,r}class ey extends uc{constructor(e){super(),this.firestore=e}convertBytes(e){return new Ht(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new ce(this.firestore,null,t)}}class An{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class wn extends Gi{constructor(e,t,r,i,s,o){super(e,t,r,i,o),this._firestore=e,this._firestoreImpl=e,this.metadata=s}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new ji(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const r=this._document.data.field(go("DocumentSnapshot.get",e));if(null!==r)return this._userDataWriter.convertValue(r,t.serverTimestamps)}}}class ji extends wn{data(e={}){return super.data(e)}}class Rn{constructor(e,t,r,i){this._firestore=e,this._userDataWriter=t,this._snapshot=i,this.metadata=new An(i.hasPendingWrites,i.fromCache),this.query=r}get docs(){const e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(e,t){this._snapshot.docs.forEach(r=>{e.call(t,new ji(this._firestore,this._userDataWriter,r.key,r,new An(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new v(_.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(i,s){if(i._snapshot.oldDocs.isEmpty()){let o=0;return i._snapshot.docChanges.map(a=>({type:"added",doc:new ji(i._firestore,i._userDataWriter,a.doc.key,a.doc,new An(i._snapshot.mutatedKeys.has(a.doc.key),i._snapshot.fromCache),i.query.converter),oldIndex:-1,newIndex:o++}))}{let o=i._snapshot.oldDocs;return i._snapshot.docChanges.filter(a=>s||3!==a.type).map(a=>{const u=new ji(i._firestore,i._userDataWriter,a.doc.key,a.doc,new An(i._snapshot.mutatedKeys.has(a.doc.key),i._snapshot.fromCache),i.query.converter);let c=-1,l=-1;return 0!==a.type&&(c=o.indexOf(a.doc.key),o=o.delete(a.doc.key)),1!==a.type&&(o=o.add(a.doc),l=o.indexOf(a.doc.key)),{type:ny(a.type),doc:u,oldIndex:c,newIndex:l}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}}function ny(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return D()}}function ry(n,e){return n instanceof wn&&e instanceof wn?n._firestore===e._firestore&&n._key.isEqual(e._key)&&(null===n._document?null===e._document:n._document.isEqual(e._document))&&n._converter===e._converter:n instanceof Rn&&e instanceof Rn&&n._firestore===e._firestore&&Ju(n.query,e.query)&&n.metadata.isEqual(e.metadata)&&n._snapshot.isEqual(e._snapshot)}function iy(n){n=z(n,ce);const e=z(n.firestore,te);return nf(le(e),n._key).then(t=>cc(e,n,t))}class Jt extends uc{constructor(e){super(),this.firestore=e}convertBytes(e){return new Ht(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new ce(this.firestore,null,t)}}function sy(n){n=z(n,ce);const e=z(n.firestore,te),t=le(e),r=new Jt(e);return function __(n,e){const t=new ye;return n.asyncQueue.enqueueAndForget((0,y.Z)(function*(){return(r=(0,y.Z)(function*(s,o,a){try{const u=yield function(l,d){const m=S(l);return m.persistence.runTransaction("read document","readonly",p=>m.localDocuments.getDocument(p,d))}(s,o);u.isFoundDocument()?a.resolve(u):u.isNoDocument()?a.resolve(null):a.reject(new v(_.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(u){const c=Ir(u,`Failed to get document '${o} from cache`);a.reject(c)}}),function i(s,o,a){return r.apply(this,arguments)})(yield wr(n),e,t);var r})),t.promise}(t,n._key).then(i=>new wn(e,r,n._key,i,new An(null!==i&&i.hasLocalMutations,!0),n.converter))}function oy(n){n=z(n,ce);const e=z(n.firestore,te);return nf(le(e),n._key,{source:"server"}).then(t=>cc(e,n,t))}function ay(n){n=z(n,be);const e=z(n.firestore,te),t=le(e),r=new Jt(e);return wf(n._query),rf(t,n._query).then(i=>new Rn(e,r,n,i))}function uy(n){n=z(n,be);const e=z(n.firestore,te),t=le(e),r=new Jt(e);return function y_(n,e){const t=new ye;return n.asyncQueue.enqueueAndForget((0,y.Z)(function*(){return(r=(0,y.Z)(function*(s,o,a){try{const u=yield Js(s,o,!0),c=new zd(o,u.ls),l=c.da(u.documents),d=c.applyChanges(l,!1);a.resolve(d.snapshot)}catch(u){const c=Ir(u,`Failed to execute query '${o} against cache`);a.reject(c)}}),function i(s,o,a){return r.apply(this,arguments)})(yield wr(n),e,t);var r})),t.promise}(t,n._query).then(i=>new Rn(e,r,n,i))}function cy(n){n=z(n,be);const e=z(n.firestore,te),t=le(e),r=new Jt(e);return rf(t,n._query,{source:"server"}).then(i=>new Rn(e,r,n,i))}function ly(n,e,t){n=z(n,ce);const r=z(n.firestore,te),i=Io(n.converter,e,t);return Sr(r,[ho(En(r),"setDoc",n._key,i,null!==n.converter,t).toMutation(n._key,oe.none())])}function hy(n,e,t,...r){n=z(n,ce);const i=z(n.firestore,te),s=En(i);let o;return o="string"==typeof(e=(0,U.m9)(e))||e instanceof Zt?ic(s,"updateDoc",n._key,e,t,r):rc(s,"updateDoc",n._key,e),Sr(i,[o.toMutation(n._key,oe.exists(!0))])}function dy(n){return Sr(z(n.firestore,te),[new or(n._key,oe.none())])}function fy(n,e){const t=z(n.firestore,te),r=ff(n),i=Io(n.converter,e);return Sr(t,[ho(En(n.firestore),"addDoc",r._key,i,null!==n.converter,{}).toMutation(r._key,oe.exists(!1))]).then(()=>r)}function my(n,...e){var t,r,i;n=(0,U.m9)(n);let s={includeMetadataChanges:!1,source:"default"},o=0;"object"!=typeof e[o]||Yu(e[o])||(s=e[o],o++);const a={includeMetadataChanges:s.includeMetadataChanges,source:s.source};if(Yu(e[o])){const d=e[o];e[o]=null===(t=d.next)||void 0===t?void 0:t.bind(d),e[o+1]=null===(r=d.error)||void 0===r?void 0:r.bind(d),e[o+2]=null===(i=d.complete)||void 0===i?void 0:i.bind(d)}let u,c,l;if(n instanceof ce)c=z(n.firestore,te),l=er(n._key.path),u={next:d=>{e[o]&&e[o](cc(c,n,d))},error:e[o+1],complete:e[o+2]};else{const d=z(n,be);c=z(d.firestore,te),l=d._query;const m=new Jt(c);u={next:p=>{e[o]&&e[o](new Rn(c,m,d,p))},error:e[o+1],complete:e[o+2]},wf(n._query)}return function(m,p,w,x){const R=new so(x),k=new fu(p,R,w);return m.asyncQueue.enqueueAndForget((0,y.Z)(function*(){return au(yield Rr(m),k)})),()=>{R.$a(),m.asyncQueue.enqueueAndForget((0,y.Z)(function*(){return cu(yield Rr(m),k)}))}}(le(c),l,a,u)}function gy(n,e){return function I_(n,e){const t=new so(e);return n.asyncQueue.enqueueAndForget((0,y.Z)(function*(){return i=yield Rr(n),s=t,S(i).z_.add(s),void s.next();var i,s})),()=>{t.$a(),n.asyncQueue.enqueueAndForget((0,y.Z)(function*(){return i=yield Rr(n),s=t,void S(i).z_.delete(s);var i,s}))}}(le(n=z(n,te)),Yu(e)?e:{next:e})}function Sr(n,e){return function(r,i){const s=new ye;return r.asyncQueue.enqueueAndForget((0,y.Z)(function*(){return function Wp(n,e,t){return Eu.apply(this,arguments)}(yield Wu(r),i,s)})),s.promise}(le(n),e)}function cc(n,e,t){const r=t.docs.get(e._key),i=new Jt(n);return new wn(n,i,e._key,r,new An(t.hasPendingWrites,t.fromCache),e.converter)}const wy={maxAttempts:5};class Cf{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=En(e)}set(e,t,r){this._verifyNotCommitted();const i=Yt(e,this._firestore),s=Io(i.converter,t,r),o=ho(this._dataReader,"WriteBatch.set",i._key,s,null!==i.converter,r);return this._mutations.push(o.toMutation(i._key,oe.none())),this}update(e,t,r,...i){this._verifyNotCommitted();const s=Yt(e,this._firestore);let o;return o="string"==typeof(t=(0,U.m9)(t))||t instanceof Zt?ic(this._dataReader,"WriteBatch.update",s._key,t,r,i):rc(this._dataReader,"WriteBatch.update",s._key,t),this._mutations.push(o.toMutation(s._key,oe.exists(!0))),this}delete(e){this._verifyNotCommitted();const t=Yt(e,this._firestore);return this._mutations=this._mutations.concat(new or(t._key,oe.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new v(_.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function Yt(n,e){if((n=(0,U.m9)(n)).firestore!==e)throw new v(_.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return n}class Ry extends class{constructor(t,r){this._firestore=t,this._transaction=r,this._dataReader=En(t)}get(t){const r=Yt(t,this._firestore),i=new ey(this._firestore);return this._transaction.lookup([r._key]).then(s=>{if(!s||1!==s.length)return D();const o=s[0];if(o.isFoundDocument())return new Gi(this._firestore,i,o.key,o,r.converter);if(o.isNoDocument())return new Gi(this._firestore,i,r._key,null,r.converter);throw D()})}set(t,r,i){const s=Yt(t,this._firestore),o=Io(s.converter,r,i),a=ho(this._dataReader,"Transaction.set",s._key,o,null!==s.converter,i);return this._transaction.set(s._key,a),this}update(t,r,i,...s){const o=Yt(t,this._firestore);let a;return a="string"==typeof(r=(0,U.m9)(r))||r instanceof Zt?ic(this._dataReader,"Transaction.update",o._key,r,i,s):rc(this._dataReader,"Transaction.update",o._key,r),this._transaction.update(o._key,a),this}delete(t){const r=Yt(t,this._firestore);return this._transaction.delete(r._key),this}}{constructor(e,t){super(e,t),this._firestore=e}get(e){const t=Yt(e,this._firestore),r=new Jt(this._firestore);return super.get(e).then(i=>new wn(this._firestore,r,t._key,i._document,new An(!1,!1),t.converter))}}function Py(n,e,t){n=z(n,te);const r=Object.assign(Object.assign({},wy),t);return function(s){if(s.maxAttempts<1)throw new v(_.INVALID_ARGUMENT,"Max attempts must be at least 1")}(r),function(s,o,a){const u=new ye;return s.asyncQueue.enqueueAndForget((0,y.Z)(function*(){const c=yield function tf(n){return ao(n).then(e=>e.datastore)}(s);new f_(s.asyncQueue,c,a,o,u).Xa()})),u.promise}(le(n),i=>e(new Ry(n,i)),r)}function Sy(){return new qi("deleteField")}function Vy(){return new Xu("serverTimestamp")}function xy(...n){return new ec("arrayUnion",n)}function Cy(...n){return new tc("arrayRemove",n)}function Dy(n){return new nc("increment",n)}!function(e,t=!0){$n=$.SDK_VERSION,(0,$._registerComponent)(new Re.wA("firestore",(r,{instanceIdentifier:i,options:s})=>{const o=r.getProvider("app").getImmediate(),a=new te(new Em(r.getProvider("auth-internal")),new wm(r.getProvider("app-check-internal")),function(c,l){if(!Object.prototype.hasOwnProperty.apply(c.options,["projectId"]))throw new v(_.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Lt(c.options.projectId,l)}(o,i),o);return s=Object.assign({useFetchStreams:t},s),a._setSettings(s),a},"PUBLIC").setMultipleInstances(!0)),(0,$.registerVersion)(ll,"4.6.1",e),(0,$.registerVersion)(ll,"4.6.1","esm2017")}()},2848:(hc,Vr,G)=>{G.d(Vr,{D:()=>xr});var y=G(5619),$=G(5879),Re=G(9862),Pe=G(7104),U=G(872);let xr=(()=>{class me{constructor(Me,M,St){this._HttpClient=Me,this._AngularFirestore=M,this._AuthService=St,this.state=new y.X(!1),this.diseaseName=new y.X(null),this.userToken=localStorage.getItem("token")}addPatient(Me){return this._AngularFirestore.createId(),this._AngularFirestore.collection(`users/${JSON.parse(this.userToken)}/Patients`).add(Me)}getAllPatients(){return this.userToken=localStorage.getItem("token"),this._AngularFirestore.collection(`users/${JSON.parse(this.userToken)}/Patients`).snapshotChanges()}getSpecificPatient(){return this._AngularFirestore.collection(`users/${JSON.parse(this.userToken)}/Patients`)}updateDiseaseProperty(){return this._AngularFirestore.collection(`users/${JSON.parse(this.userToken)}/Patients`)}updatePatientId(){return this._AngularFirestore.collection(`users/${JSON.parse(this.userToken)}/Patients`)}deletePatient(Me){return this._AngularFirestore.doc(`users/${JSON.parse(this.userToken)}/Patients/${Me.id}`).delete()}updatePatient(){return this._AngularFirestore.collection(`users/${JSON.parse(this.userToken)}/Patients`)}newApi(Me="medical"){return this._HttpClient.get(`https://6657d6d45c3617052645ffd9.mockapi.io/health/v1/${Me}`)}static#e=this.\u0275fac=function(M){return new(M||me)($.LFG(Re.eN),$.LFG(Pe.ST),$.LFG(U.e))};static#t=this.\u0275prov=$.Yz7({token:me,factory:me.\u0275fac,providedIn:"root"})}return me})()},7104:(hc,Vr,G)=>{G.d(Vr,{ST:()=>Gr});var y=G(6814),$=G(5879),Re=G(8326),Pe=G(7217),U=G(981),xr=G(6321),me=G(5592),V=G(2459),Me=G(2096),M=G(7921),St=G(9360),Xt=G(8251);function Cr(){return(0,St.e)((E,h)=>{let f,I=!1;E.subscribe((0,Xt.x)(h,P=>{const W=f;f=P,I&&h.next([W,P]),I=!0}))})}var Be=G(7398),Dr=G(6699),Eo=G(3997),$i=G(2181),Pn=(G(6365),G(3106)),T=G(5776),Je=G(9058),vo=G(4537);function Sn(E,h){if(void 0===h)return{merge:!1};if(void 0!==h.mergeFields&&void 0!==h.merge)throw new T.WA("invalid-argument",`Invalid options passed to function ${E}(): You cannot specify both "merge" and "mergeFields".`);return h}function ge(){if(typeof Uint8Array>"u")throw new T.WA("unimplemented","Uint8Arrays are not available in this environment.")}function Wi(){if(!(0,T.Me)())throw new T.WA("unimplemented","Blobs are unavailable in Firestore in this environment.")}class Ye{constructor(h){this._delegate=h}static fromBase64String(h){return Wi(),new Ye(T.Jj.fromBase64String(h))}static fromUint8Array(h){return ge(),new Ye(T.Jj.fromUint8Array(h))}toBase64(){return Wi(),this._delegate.toBase64()}toUint8Array(){return ge(),this._delegate.toUint8Array()}isEqual(h){return this._delegate.isEqual(h._delegate)}toString(){return"Blob(base64: "+this.toBase64()+")"}}function Vt(E){return function Qe(E,h){if("object"!=typeof E||null===E)return!1;const f=E;for(const I of h)if(I in f&&"function"==typeof f[I])return!0;return!1}(E,["next","error","complete"])}class Nr{enableIndexedDbPersistence(h,f){return(0,T.ST)(h._delegate,{forceOwnership:f})}enableMultiTabIndexedDbPersistence(h){return(0,T.fH)(h._delegate)}clearIndexedDbPersistence(h){return(0,T.Fc)(h._delegate)}}class Hi{constructor(h,f,I){this._delegate=f,this._persistenceProvider=I,this.INTERNAL={delete:()=>this.terminate()},h instanceof T.l7||(this._appCompat=h)}get _databaseId(){return this._delegate._databaseId}settings(h){const f=this._delegate._getSettings();!h.merge&&f.host!==h.host&&(0,T.yq)("You are overriding the original host. If you did not intend to override your settings, use {merge: true}."),h.merge&&delete(h=Object.assign(Object.assign({},f),h)).merge,this._delegate._setSettings(h)}useEmulator(h,f,I={}){(0,T.at)(this._delegate,h,f,I)}enableNetwork(){return(0,T.Ix)(this._delegate)}disableNetwork(){return(0,T.TF)(this._delegate)}enablePersistence(h){let f=!1,I=!1;return h&&(f=!!h.synchronizeTabs,I=!!h.experimentalForceOwningTab,(0,T.Wi)("synchronizeTabs",f,"experimentalForceOwningTab",I)),f?this._persistenceProvider.enableMultiTabIndexedDbPersistence(this):this._persistenceProvider.enableIndexedDbPersistence(this,I)}clearPersistence(){return this._persistenceProvider.clearIndexedDbPersistence(this)}terminate(){return this._appCompat&&(this._appCompat._removeServiceInstance("firestore-compat"),this._appCompat._removeServiceInstance("firestore")),this._delegate._delete()}waitForPendingWrites(){return(0,T.Mx)(this._delegate)}onSnapshotsInSync(h){return(0,T.sc)(this._delegate,h)}get app(){if(!this._appCompat)throw new T.WA("failed-precondition","Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._appCompat}collection(h){try{return new We(this,(0,T.hJ)(this._delegate,h))}catch(f){throw Ee(f,"collection()","Firestore.collection()")}}doc(h){try{return new qe(this,(0,T.JU)(this._delegate,h))}catch(f){throw Ee(f,"doc()","Firestore.doc()")}}collectionGroup(h){try{return new pe(this,(0,T.B$)(this._delegate,h))}catch(f){throw Ee(f,"collectionGroup()","Firestore.collectionGroup()")}}runTransaction(h){return(0,T.i3)(this._delegate,f=>h(new kr(this,f)))}batch(){return(0,T.qY)(this._delegate),new xn(new T.PU(this._delegate,h=>(0,T.GL)(this._delegate,h)))}loadBundle(h){return(0,T.Pb)(this._delegate,h)}namedQuery(h){return(0,T.L$)(this._delegate,h).then(f=>f?new pe(this,f):null)}}class Vn extends T.u7{constructor(h){super(),this.firestore=h}convertBytes(h){return new Ye(new T.Jj(h))}convertReference(h){const f=this.convertDocumentKey(h,this.firestore._databaseId);return qe.forKey(f,this.firestore,null)}}class kr{constructor(h,f){this._firestore=h,this._delegate=f,this._userDataWriter=new Vn(h)}get(h){const f=mt(h);return this._delegate.get(f).then(I=>new dt(this._firestore,new T.xU(this._firestore._delegate,this._userDataWriter,I._key,I._document,I.metadata,f.converter)))}set(h,f,I){const P=mt(h);return I?(Sn("Transaction.set",I),this._delegate.set(P,f,I)):this._delegate.set(P,f),this}update(h,f,I,...P){const W=mt(h);return 2===arguments.length?this._delegate.update(W,f):this._delegate.update(W,f,I,...P),this}delete(h){const f=mt(h);return this._delegate.delete(f),this}}class xn{constructor(h){this._delegate=h}set(h,f,I){const P=mt(h);return I?(Sn("WriteBatch.set",I),this._delegate.set(P,f,I)):this._delegate.set(P,f),this}update(h,f,I,...P){const W=mt(h);return 2===arguments.length?this._delegate.update(W,f):this._delegate.update(W,f,I,...P),this}delete(h){const f=mt(h);return this._delegate.delete(f),this}commit(){return this._delegate.commit()}}class nt{constructor(h,f,I){this._firestore=h,this._userDataWriter=f,this._delegate=I}fromFirestore(h,f){const I=new T.$q(this._firestore._delegate,this._userDataWriter,h._key,h._document,h.metadata,null);return this._delegate.fromFirestore(new ft(this._firestore,I),f??{})}toFirestore(h,f){return f?this._delegate.toFirestore(h,f):this._delegate.toFirestore(h)}static getInstance(h,f){const I=nt.INSTANCES;let P=I.get(h);P||(P=new WeakMap,I.set(h,P));let W=P.get(f);return W||(W=new nt(h,new Vn(h),f),P.set(f,W)),W}}nt.INSTANCES=new WeakMap;class qe{constructor(h,f){this.firestore=h,this._delegate=f,this._userDataWriter=new Vn(h)}static forPath(h,f,I){if(h.length%2!=0)throw new T.WA("invalid-argument",`Invalid document reference. Document references must have an even number of segments, but ${h.canonicalString()} has ${h.length}`);return new qe(f,new T.my(f._delegate,I,new T.Ky(h)))}static forKey(h,f,I){return new qe(f,new T.my(f._delegate,I,h))}get id(){return this._delegate.id}get parent(){return new We(this.firestore,this._delegate.parent)}get path(){return this._delegate.path}collection(h){try{return new We(this.firestore,(0,T.hJ)(this._delegate,h))}catch(f){throw Ee(f,"collection()","DocumentReference.collection()")}}isEqual(h){return(h=(0,Je.m9)(h))instanceof T.my&&(0,T.Eo)(this._delegate,h)}set(h,f){f=Sn("DocumentReference.set",f);try{return f?(0,T.pl)(this._delegate,h,f):(0,T.pl)(this._delegate,h)}catch(I){throw Ee(I,"setDoc()","DocumentReference.set()")}}update(h,f,...I){try{return 1===arguments.length?(0,T.r7)(this._delegate,h):(0,T.r7)(this._delegate,h,f,...I)}catch(P){throw Ee(P,"updateDoc()","DocumentReference.update()")}}delete(){return(0,T.oe)(this._delegate)}onSnapshot(...h){const f=Cn(h),I=Dn(h,P=>new dt(this.firestore,new T.xU(this.firestore._delegate,this._userDataWriter,P._key,P._document,P.metadata,this._delegate.converter)));return(0,T.cf)(this._delegate,f,I)}get(h){let f;return f="cache"===h?.source?(0,T.kl)(this._delegate):"server"===h?.source?(0,T.Xk)(this._delegate):(0,T.QT)(this._delegate),f.then(I=>new dt(this.firestore,new T.xU(this.firestore._delegate,this._userDataWriter,I._key,I._document,I.metadata,this._delegate.converter)))}withConverter(h){return new qe(this.firestore,this._delegate.withConverter(h?nt.getInstance(this.firestore,h):null))}}function Ee(E,h,f){return E.message=E.message.replace(h,f),E}function Cn(E){for(const h of E)if("object"==typeof h&&!Vt(h))return h;return{}}function Dn(E,h){var f,I;let P;return P=Vt(E[0])?E[0]:Vt(E[1])?E[1]:"function"==typeof E[0]?{next:E[0],error:E[1],complete:E[2]}:{next:E[1],error:E[2],complete:E[3]},{next:W=>{P.next&&P.next(h(W))},error:null===(f=P.error)||void 0===f?void 0:f.bind(P),complete:null===(I=P.complete)||void 0===I?void 0:I.bind(P)}}class dt{constructor(h,f){this._firestore=h,this._delegate=f}get ref(){return new qe(this._firestore,this._delegate.ref)}get id(){return this._delegate.id}get metadata(){return this._delegate.metadata}get exists(){return this._delegate.exists()}data(h){return this._delegate.data(h)}get(h,f){return this._delegate.get(h,f)}isEqual(h){return(0,T.qK)(this._delegate,h._delegate)}}class ft extends dt{data(h){const f=this._delegate.data(h);return this._delegate._converter||(0,T.K9)(void 0!==f,"Document in a QueryDocumentSnapshot should exist"),f}}class pe{constructor(h,f){this.firestore=h,this._delegate=f,this._userDataWriter=new Vn(h)}where(h,f,I){try{return new pe(this.firestore,(0,T.IO)(this._delegate,(0,T.ar)(h,f,I)))}catch(P){throw Ee(P,/(orderBy|where)\(\)/,"Query.$1()")}}orderBy(h,f){try{return new pe(this.firestore,(0,T.IO)(this._delegate,(0,T.Xo)(h,f)))}catch(I){throw Ee(I,/(orderBy|where)\(\)/,"Query.$1()")}}limit(h){try{return new pe(this.firestore,(0,T.IO)(this._delegate,(0,T.b9)(h)))}catch(f){throw Ee(f,"limit()","Query.limit()")}}limitToLast(h){try{return new pe(this.firestore,(0,T.IO)(this._delegate,(0,T.vh)(h)))}catch(f){throw Ee(f,"limitToLast()","Query.limitToLast()")}}startAt(...h){try{return new pe(this.firestore,(0,T.IO)(this._delegate,(0,T.e0)(...h)))}catch(f){throw Ee(f,"startAt()","Query.startAt()")}}startAfter(...h){try{return new pe(this.firestore,(0,T.IO)(this._delegate,(0,T.TQ)(...h)))}catch(f){throw Ee(f,"startAfter()","Query.startAfter()")}}endBefore(...h){try{return new pe(this.firestore,(0,T.IO)(this._delegate,(0,T.Lx)(...h)))}catch(f){throw Ee(f,"endBefore()","Query.endBefore()")}}endAt(...h){try{return new pe(this.firestore,(0,T.IO)(this._delegate,(0,T.Wu)(...h)))}catch(f){throw Ee(f,"endAt()","Query.endAt()")}}isEqual(h){return(0,T.iE)(this._delegate,h._delegate)}get(h){let f;return f="cache"===h?.source?(0,T.UQ)(this._delegate):"server"===h?.source?(0,T.zN)(this._delegate):(0,T.PL)(this._delegate),f.then(I=>new Fr(this.firestore,new T.W(this.firestore._delegate,this._userDataWriter,this._delegate,I._snapshot)))}onSnapshot(...h){const f=Cn(h),I=Dn(h,P=>new Fr(this.firestore,new T.W(this.firestore._delegate,this._userDataWriter,this._delegate,P._snapshot)));return(0,T.cf)(this._delegate,f,I)}withConverter(h){return new pe(this.firestore,this._delegate.withConverter(h?nt.getInstance(this.firestore,h):null))}}class Zi{constructor(h,f){this._firestore=h,this._delegate=f}get type(){return this._delegate.type}get doc(){return new ft(this._firestore,this._delegate.doc)}get oldIndex(){return this._delegate.oldIndex}get newIndex(){return this._delegate.newIndex}}class Fr{constructor(h,f){this._firestore=h,this._delegate=f}get query(){return new pe(this._firestore,this._delegate.query)}get metadata(){return this._delegate.metadata}get size(){return this._delegate.size}get empty(){return this._delegate.empty}get docs(){return this._delegate.docs.map(h=>new ft(this._firestore,h))}docChanges(h){return this._delegate.docChanges(h).map(f=>new Zi(this._firestore,f))}forEach(h,f){this._delegate.forEach(I=>{h.call(f,new ft(this._firestore,I))})}isEqual(h){return(0,T.qK)(this._delegate,h._delegate)}}class We extends pe{constructor(h,f){super(h,f),this.firestore=h,this._delegate=f}get id(){return this._delegate.id}get path(){return this._delegate.path}get parent(){const h=this._delegate.parent;return h?new qe(this.firestore,h):null}doc(h){try{return new qe(this.firestore,void 0===h?(0,T.JU)(this._delegate):(0,T.JU)(this._delegate,h))}catch(f){throw Ee(f,"doc()","CollectionReference.doc()")}}add(h){return(0,T.ET)(this._delegate,h).then(f=>new qe(this.firestore,f))}isEqual(h){return(0,T.Eo)(this._delegate,h._delegate)}withConverter(h){return new We(this.firestore,this._delegate.withConverter(h?nt.getInstance(this.firestore,h):null))}}function mt(E){return(0,T.Cf)(E,T.my)}class gt{constructor(...h){this._delegate=new T.Lz(...h)}static documentId(){return new gt(T.Xb.keyField().canonicalString())}isEqual(h){return(h=(0,Je.m9)(h))instanceof T.Lz&&this._delegate._internalPath.isEqual(h._internalPath)}}class pt{constructor(h){this._delegate=h}static serverTimestamp(){const h=(0,T.Bt)();return h._methodName="FieldValue.serverTimestamp",new pt(h)}static delete(){const h=(0,T.AK)();return h._methodName="FieldValue.delete",new pt(h)}static arrayUnion(...h){const f=(0,T.vr)(...h);return f._methodName="FieldValue.arrayUnion",new pt(f)}static arrayRemove(...h){const f=(0,T.Ab)(...h);return f._methodName="FieldValue.arrayRemove",new pt(f)}static increment(h){const f=(0,T.nP)(h);return f._methodName="FieldValue.increment",new pt(f)}isEqual(h){return this._delegate.isEqual(h._delegate)}}const Ao={Firestore:Hi,GeoPoint:T.F8,Timestamp:T.EK,Blob:Ye,Transaction:kr,WriteBatch:xn,DocumentReference:qe,DocumentSnapshot:dt,Query:pe,QueryDocumentSnapshot:ft,QuerySnapshot:Fr,CollectionReference:We,FieldPath:gt,FieldValue:pt,setLogLevel:function xt(E){(0,T.Ub)(E)},CACHE_SIZE_UNLIMITED:T.IX};function Or(E,h){return function Ji(E,h=xr.z){return new me.y(f=>{let I;return null!=h?h.schedule(()=>{I=E.onSnapshot({includeMetadataChanges:!0},f)}):I=E.onSnapshot({includeMetadataChanges:!0},f),()=>{I?.()}})}(E,h)}function Ct(E,h){return Or(E,h).pipe((0,Be.U)(f=>({payload:f,type:"query"})))}!function Mr(E){(function bn(E,h){E.INTERNAL.registerComponent(new vo.wA("firestore-compat",f=>{const I=f.getProvider("app-compat").getImmediate(),P=f.getProvider("firestore").getImmediate();return h(I,P)},"PUBLIC").setServiceProps(Object.assign({},Ao)))})(E,(h,f)=>new Hi(h,f,new Nr)),E.registerVersion("@firebase/firestore-compat","0.3.30")}(Pn.Z),G(7142);class Nn{ref;afs;constructor(h,f){this.ref=h,this.afs=f}set(h,f){return this.ref.set(h,f)}update(h){return this.ref.update(h)}delete(){return this.ref.delete()}collection(h,f){const I=this.ref.collection(h),{ref:P,query:W}=Mn(I,f);return new Br(P,W,this.afs)}snapshotChanges(){return function Yi(E,h){return Or(E,h).pipe((0,M.O)(void 0),Cr(),(0,Be.U)(f=>{const[I,P]=f;return P.exists?I?.exists?{payload:P,type:"modified"}:{payload:P,type:"added"}:{payload:P,type:"removed"}}))}(this.ref,this.afs.schedulers.outsideAngular).pipe(Re.iC)}valueChanges(h={}){return this.snapshotChanges().pipe((0,Be.U)(({payload:f})=>h.idField?{...f.data(),[h.idField]:f.id}:f.data()))}get(h){return(0,V.D)(this.ref.get(h)).pipe(Re.iC)}}function Dt(E,h){return Ct(E,h).pipe((0,M.O)(void 0),Cr(),(0,Be.U)(f=>{const[I,P]=f,W=P.payload.docChanges(),Xe=W.map(Ve=>({type:Ve.type,payload:Ve}));return I&&JSON.stringify(I.payload.metadata)!==JSON.stringify(P.payload.metadata)&&P.payload.docs.forEach((Ve,On)=>{const en=W.find(et=>et.doc.ref.isEqual(Ve.ref)),rt=I?.payload.docs.find(et=>et.ref.isEqual(Ve.ref));en&&JSON.stringify(en.doc.metadata)===JSON.stringify(Ve.metadata)||!en&&rt&&JSON.stringify(rt.metadata)===JSON.stringify(Ve.metadata)||Xe.push({type:"modified",payload:{oldIndex:On,newIndex:On,type:"modified",doc:Ve}})}),Xe}))}function kn(E,h,f){return Dt(E,f).pipe((0,Dr.R)((I,P)=>function Lr(E,h,f){return h.forEach(I=>{f.indexOf(I.type)>-1&&(E=function Xi(E,h){switch(h.type){case"added":if(!E[h.newIndex]||!E[h.newIndex].doc.ref.isEqual(h.doc.ref))return Fn(E,h.newIndex,0,h);break;case"modified":if(null==E[h.oldIndex]||E[h.oldIndex].doc.ref.isEqual(h.doc.ref)){if(h.oldIndex!==h.newIndex){const f=E.slice();return f.splice(h.oldIndex,1),f.splice(h.newIndex,0,h),f}return Fn(E,h.newIndex,1,h)}break;case"removed":if(E[h.oldIndex]&&E[h.oldIndex].doc.ref.isEqual(h.doc.ref))return Fn(E,h.oldIndex,1)}return E}(E,I))}),E}(I,P.map(W=>W.payload),h),[]),(0,Eo.x)(),(0,Be.U)(I=>I.map(P=>({type:P.type,payload:P}))))}function Fn(E,h,f,...I){const P=E.slice();return P.splice(h,f,...I),P}function es(E){return(!E||0===E.length)&&(E=["added","removed","modified"]),E}class Br{ref;query;afs;constructor(h,f,I){this.ref=h,this.query=f,this.afs=I}stateChanges(h){let f=Dt(this.query,this.afs.schedulers.outsideAngular);return h&&h.length>0&&(f=f.pipe((0,Be.U)(I=>I.filter(P=>h.indexOf(P.type)>-1)))),f.pipe((0,M.O)(void 0),Cr(),(0,$i.h)(([I,P])=>P.length>0||!I),(0,Be.U)(([,I])=>I),Re.iC)}auditTrail(h){return this.stateChanges(h).pipe((0,Dr.R)((f,I)=>[...f,...I],[]))}snapshotChanges(h){const f=es(h);return kn(this.query,f,this.afs.schedulers.outsideAngular).pipe(Re.iC)}valueChanges(h={}){return Ct(this.query,this.afs.schedulers.outsideAngular).pipe((0,Be.U)(f=>f.payload.docs.map(I=>h.idField?{...I.data(),[h.idField]:I.id}:I.data())),Re.iC)}get(h){return(0,V.D)(this.query.get(h)).pipe(Re.iC)}add(h){return this.ref.add(h)}doc(h){return new Nn(this.ref.doc(h),this.afs)}}class ts{query;afs;constructor(h,f){this.query=h,this.afs=f}stateChanges(h){return h&&0!==h.length?Dt(this.query,this.afs.schedulers.outsideAngular).pipe((0,Be.U)(f=>f.filter(I=>h.indexOf(I.type)>-1)),(0,$i.h)(f=>f.length>0),Re.iC):Dt(this.query,this.afs.schedulers.outsideAngular).pipe(Re.iC)}auditTrail(h){return this.stateChanges(h).pipe((0,Dr.R)((f,I)=>[...f,...I],[]))}snapshotChanges(h){const f=es(h);return kn(this.query,f,this.afs.schedulers.outsideAngular).pipe(Re.iC)}valueChanges(h={}){return Ct(this.query,this.afs.schedulers.outsideAngular).pipe((0,Be.U)(I=>I.payload.docs.map(P=>h.idField?{[h.idField]:P.id,...P.data()}:P.data())),Re.iC)}get(h){return(0,V.D)(this.query.get(h)).pipe(Re.iC)}}const qr=new $.OlP("angularfire2.enableFirestorePersistence"),ns=new $.OlP("angularfire2.firestore.persistenceSettings"),wo=new $.OlP("angularfire2.firestore.settings"),Ur=new $.OlP("angularfire2.firestore.use-emulator");function Mn(E,h=(f=>f)){return{query:h(E),ref:E}}let Gr=(()=>{class E{schedulers;firestore;persistenceEnabled$;constructor(f,I,P,W,Xe,Ve,On,en,rt,et,zr,rs,Ro,Ln,Kr,jr,Po){this.schedulers=On;const Bn=(0,Pe.on)(f,Ve,I),_t=rt;et&&(0,U.nw)(Bn,Ve,zr,Ro,Ln,Kr,rs,jr),[this.firestore,this.persistenceEnabled$]=(0,Pe.cc)(`${Bn.name}.firestore`,"AngularFirestore",Bn.name,()=>{const bt=Ve.runOutsideAngular(()=>Bn.firestore());if(W&&bt.settings(W),_t&&bt.useEmulator(..._t),P&&!(0,y.PM)(Xe)){const is=()=>{try{return(0,V.D)(bt.enablePersistence(en||void 0).then(()=>!0,()=>!1))}catch(ss){return typeof console<"u"&&console.warn(ss),(0,Me.of)(!1)}};return[bt,Ve.runOutsideAngular(is)]}return[bt,(0,Me.of)(!1)]},[W,_t,P])}collection(f,I){let P;P="string"==typeof f?this.firestore.collection(f):f;const{ref:W,query:Xe}=Mn(P,I),Ve=this.schedulers.ngZone.run(()=>W);return new Br(Ve,Xe,this)}collectionGroup(f,I){const P=I||(Xe=>Xe),W=this.firestore.collectionGroup(f);return new ts(P(W),this)}doc(f){let I;I="string"==typeof f?this.firestore.doc(f):f;const P=this.schedulers.ngZone.run(()=>I);return new Nn(P,this)}createId(){return this.firestore.collection("_").doc().id}static \u0275fac=function(I){return new(I||E)($.LFG(Pe.Dh),$.LFG(Pe.xv,8),$.LFG(qr,8),$.LFG(wo,8),$.LFG($.Lbi),$.LFG($.R0b),$.LFG(Re.HU),$.LFG(ns,8),$.LFG(Ur,8),$.LFG(U.zQ,8),$.LFG(U.Qv,8),$.LFG(U.L6,8),$.LFG(U._Q,8),$.LFG(U.rT,8),$.LFG(U.lh,8),$.LFG(U.f7,8),$.LFG(Re.Rf,8))};static \u0275prov=$.Yz7({token:E,factory:E.\u0275fac,providedIn:"any"})}return E})()}}]);