"use strict";(self.webpackChunkgraduation=self.webpackChunkgraduation||[]).push([[823],{6823:(N,u,c)=>{c.r(u),c.d(u,{MedicalRecordsComponent:()=>J});var l=c(6814),p=c(7700),f=c(3387),d=c(95),_=c(4716),v=c(8098),g=c(7680),e=c(5879),x=c(5501),C=c(4186),T=c(6989),h=c(2848),w=c(2425);function Z(o,a){if(1&o){const t=e.EpF();e.TgZ(0,"ngx-dropzone-preview",12),e.NdJ("removed",function(){const r=e.CHM(t).$implicit,s=e.oxw();return e.KtG(s.onRemove(r))}),e.TgZ(1,"ngx-dropzone-label"),e._uU(2),e.qZA()()}if(2&o){const t=a.$implicit;e.Q6J("removable",!0),e.xp6(2),e.AsE("",t.name," (",t.type,")")}}function F(o,a){1&o&&(e.TgZ(0,"span"),e._uU(1,"Analyze"),e.qZA())}function M(o,a){1&o&&(e.TgZ(0,"span"),e._uU(1,"Analyzing image "),e._UZ(2,"i",13),e.qZA())}function y(o,a){if(1&o&&(e.TgZ(0,"h2",14),e._uU(1,"Patient possible disease name is : "),e.TgZ(2,"span",15),e._uU(3),e.qZA()()),2&o){const t=e.oxw();e.xp6(3),e.Oqu(t.prediction)}}const I=function(o){return{width:o}};let A=(()=>{class o{constructor(t,n,i,r,s,m,D){this._DiseaseService=t,this._AngularFireStorage=n,this._RecordsService=i,this._DataService=r,this._MatDialogRef=s,this.data=m,this._ToastrService=D,this.files=[],this.percentage=0,this.loadingFlag=!1,this.sendImageForm=new d.cw({fileup:new d.NI(null,[d.kI.required])})}onSelect(t){console.log(t),this.selectedFiles=t.addedFiles,console.log(this.selectedFiles),this.files.push(t.addedFiles[0]),this.sendImageForm.get("fileup")?.setValue(this.files)}onRemove(t){console.log(t),this.files.splice(this.files.indexOf(t),1)}sendImage(){console.log(this.data),this.loadingFlag=!0;let t=new FormData;t.append("fileup",this.selectedFiles[0]),this.currentSelectedFile=new f.O(this.selectedFiles[0]);const i=this._AngularFireStorage.ref("Uploads/"+this.currentSelectedFile.file.name);i.put(this.selectedFiles[0]).snapshotChanges().pipe((0,_.x)(()=>{i.getDownloadURL().subscribe(s=>{this.currentSelectedFile.image=s,this.currentSelectedFile.name=this.currentSelectedFile.file.name,this.currentSelectedFile.size=this.currentSelectedFile.file.size,this.currentSelectedFile.prediction=this.prediction,this._RecordsService.saveFileMetaData(this.currentSelectedFile,this.data)})})).subscribe({next:s=>{console.log(s),this.percentage=100*s.bytesTransferred/s.totalBytes},error:s=>{console.log(s)}}),this._DiseaseService.diseaseApi(t).subscribe({next:s=>{console.log(s),this.prediction=s.prediction,this._DataService.diseaseName.next(this.prediction),console.log(this.prediction),this.loadingFlag=!1,this._DataService.updateDiseaseProperty().doc(this.data).update({disease:this.prediction}).then(()=>{console.log("Property updated successfully")}).catch(m=>{console.error("Error updating property: ",m)})},error:s=>{console.log(s),this.loadingFlag=!1,this.prediction="Diagnoses Not Avaliable"}}),setTimeout(()=>{this._MatDialogRef.close(!0),this._ToastrService.success("Record added successfully")},3e3)}static#e=this.\u0275fac=function(n){return new(n||o)(e.Y36(x.j),e.Y36(C.Q1),e.Y36(T.$),e.Y36(h.D),e.Y36(p.so),e.Y36(p.WI),e.Y36(w._W))};static#t=this.\u0275cmp=e.Xpm({type:o,selectors:[["app-add-record"]],standalone:!0,features:[e.jDz],decls:18,vars:11,consts:[[1,"main","container","my-3"],[1,"shadow","p-3"],[1,"w-75","mx-auto"],["action","",3,"formGroup","ngSubmit"],[1,"w-100","m-auto",3,"change"],[3,"removable","removed",4,"ngFor","ngForOf"],[1,"progress","mt-3"],["role","progressbar","aria-valuemin","0","aria-valuemax","100",1,"progress-bar","progress-bar-info",3,"ngStyle"],[1,"d-flex","justify-content-center","align-items-center","mt-2"],["type","submit",1,"btn","btn-outline-primary",3,"disabled"],[4,"ngIf"],["class","text-center",4,"ngIf"],[3,"removable","removed"],[1,"fa","fa-spinner","fa-spin"],[1,"text-center"],[1,"text-primary"]],template:function(n,i){1&n&&(e.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"form",3),e.NdJ("ngSubmit",function(){return i.sendImage()}),e.TgZ(4,"div")(5,"ngx-dropzone",4),e.NdJ("change",function(s){return i.onSelect(s)}),e.TgZ(6,"ngx-dropzone-label"),e._uU(7,"Drop your image here"),e.qZA(),e.YNc(8,Z,3,3,"ngx-dropzone-preview",5),e.qZA(),e.TgZ(9,"div",6)(10,"div",7),e._uU(11),e.qZA()()(),e.TgZ(12,"div")(13,"div",8)(14,"button",9),e.YNc(15,F,2,0,"span",10),e.YNc(16,M,3,0,"span",10),e.qZA()(),e.YNc(17,y,4,1,"h2",11),e.qZA()()()()()),2&n&&(e.xp6(3),e.Q6J("formGroup",i.sendImageForm),e.xp6(5),e.Q6J("ngForOf",i.files),e.xp6(2),e.Q6J("ngStyle",e.VKq(9,I,i.percentage+"%")),e.uIk("aria-valuenow",i.percentage),e.xp6(1),e.hij(" ",i.percentage,"% "),e.xp6(3),e.Q6J("disabled",i.sendImageForm.invalid),e.xp6(1),e.Q6J("ngIf",!i.loadingFlag),e.xp6(1),e.Q6J("ngIf",i.loadingFlag),e.xp6(1),e.Q6J("ngIf",i.prediction))},dependencies:[l.ez,l.sg,l.O5,l.PC,v.m,d._Y,d.JL,d.sg,g._f,g.NP,g.dt,g.bB,d.UX,d.u5],styles:["i[_ngcontent-%COMP%]{cursor:pointer}"]})}return o})();var b=c(2577);function R(o,a){if(1&o){const t=e.EpF();e.TgZ(0,"div",7)(1,"div",8)(2,"div",9)(3,"h2",10),e._uU(4),e.qZA(),e.TgZ(5,"span",11),e._uU(6),e.qZA()(),e.TgZ(7,"div"),e._UZ(8,"img",12),e.qZA(),e.TgZ(9,"div",13)(10,"h3"),e._uU(11,"Prediction : "),e.TgZ(12,"span",14),e._uU(13),e.qZA()(),e.TgZ(14,"h3"),e._uU(15,"File attached : "),e.TgZ(16,"span",14),e._uU(17),e.qZA()(),e.TgZ(18,"h3"),e._uU(19,"Date : "),e.TgZ(20,"span",14),e._uU(21),e.ALo(22,"date"),e.qZA()()(),e.TgZ(23,"div")(24,"button",15),e.NdJ("click",function(){const r=e.CHM(t).index,s=e.oxw(2);return e.KtG(s.selectImage(r))}),e._uU(25,"Preview"),e.qZA()()()()}if(2&o){const t=a.$implicit,n=a.index,i=e.oxw(2);let r,s;e.xp6(4),e.Oqu(null==t||null==t.prediction||null==(r=t.prediction.split(" "))||null==(s=r.slice(0,2))?null:s.join(" ")),e.xp6(2),e.Oqu(n+1),e.xp6(2),e.Q6J("src",null==t?null:t.image,e.LSH),e.xp6(5),e.Oqu(null==t?null:t.prediction),e.xp6(4),e.Oqu(null!=t&&t.name?t.name:"uploaded from phone"),e.xp6(4),e.Oqu(e.xi3(22,6,i.date[n],"medium"))}}function S(o,a){if(1&o){const t=e.EpF();e.TgZ(0,"div",3)(1,"button",4),e.NdJ("click",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.open())}),e._uU(2,"Add new record"),e.qZA(),e.TgZ(3,"div",5),e.YNc(4,R,26,9,"div",6),e.qZA()()}if(2&o){const t=e.oxw();e.xp6(4),e.Q6J("ngForOf",t.records)}}function k(o,a){if(1&o){const t=e.EpF();e.TgZ(0,"i",21),e.NdJ("click",function(){e.CHM(t);const i=e.oxw(2);return e.KtG(i.moveLeft())}),e.qZA()}}function O(o,a){if(1&o){const t=e.EpF();e.TgZ(0,"i",22),e.NdJ("click",function(){e.CHM(t);const i=e.oxw(2);return e.KtG(i.moveRight())}),e.qZA()}}function U(o,a){if(1&o){const t=e.EpF();e.TgZ(0,"div",16),e.NdJ("click",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.previewFlag=!1)}),e.TgZ(1,"div",17),e.NdJ("click",function(i){e.CHM(t);const r=e.oxw();return e.KtG(r.stop(i))}),e.YNc(2,k,1,0,"i",18),e._UZ(3,"img",19),e.YNc(4,O,1,0,"i",20),e.qZA()()}if(2&o){const t=e.oxw();e.xp6(2),e.Q6J("ngIf",t.clicked),e.xp6(1),e.Q6J("src",t.imageUrl,e.LSH),e.xp6(1),e.Q6J("ngIf",t.records.length>1)}}function P(o,a){if(1&o){const t=e.EpF();e.TgZ(0,"h2",23),e._uU(1,"There is no medical records yet.."),e.qZA(),e.TgZ(2,"h3",24),e.NdJ("click",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.open())}),e._uU(3,"Click here to scan"),e.qZA()}}let J=(()=>{class o{constructor(t,n,i,r){this._DataService=t,this._ActivatedRoute=n,this._Location=i,this._MatDialog=r,this.patientId="",this.imageUrl="",this.previewFlag=!1,this.imageIndex=0,this.timeStamp=[],this.date=[],this.clicked=!1}keyUp(t){"ArrowLeft"===t.key&&this.moveLeft(),"ArrowRight"===t.key&&this.moveRight(),"Escape"===t.key&&(this.previewFlag=!1)}ngOnInit(){this._ActivatedRoute.paramMap.subscribe({next:t=>{this.patientId=t.get("id")}}),this.getPatientById(this.patientId)}selectImage(t){this.imageIndex=t,console.log(this.imageIndex),console.log(this.records[t].image),this.previewFlag=!0,this.imageUrl=this.records[t].image}moveLeft(){this.imageIndex--,this.imageIndex<0&&(this.imageIndex=this.records.length-1),this.imageUrl=this.records[this.imageIndex].image}moveRight(){this.clicked=!0,this.imageIndex+=1,this.imageIndex==this.records.length&&(this.imageIndex=0),this.imageUrl=this.records[this.imageIndex].image}stop(t){t.stopPropagation()}goBack(){this._Location.back()}getPatientById(t){this._DataService.getSpecificPatient().doc(t).get().subscribe({next:n=>{this.patient=n.data(),this.records=this.patient.scans;for(let i=0;i<this.records.length;i++)this.timeStamp.push(this.records[i].timestamp);console.log(this.timeStamp),this.date=this.convertTimestampsToDates(this.timeStamp),console.log(this.date,"date")},error:n=>{console.log(n)}})}convertTimestampsToDates(t){return t.map(n=>new Date(1e3*n.seconds+n.nanoseconds/1e6))}open(){this._MatDialog.open(A,{width:"800px",data:this.patientId}).afterClosed().subscribe(n=>{1==n&&this.getPatientById(this.patientId),console.log("The dialog was closed")})}static#e=this.\u0275fac=function(n){return new(n||o)(e.Y36(h.D),e.Y36(b.gz),e.Y36(l.Ye),e.Y36(p.uw))};static#t=this.\u0275cmp=e.Xpm({type:o,selectors:[["app-medical-records"]],hostBindings:function(n,i){1&n&&e.NdJ("keyup",function(s){return i.keyUp(s)},!1,e.Jf7)},standalone:!0,features:[e.jDz],decls:4,vars:3,consts:[["class","container  my-4",4,"ngIf","ngIfElse"],["class","image-preview position-fixed top-0 bottom-0 start-0 end-0 d-flex justify-content-center align-items-center",3,"click",4,"ngIf"],["msg",""],[1,"container","my-4"],["type","button",1,"btn","btn-primary","d-block","ms-auto",3,"click"],[1,"row","justify-content-center","g-4","mt-2"],["class","col-md-4",4,"ngFor","ngForOf"],[1,"col-md-4"],[1,"shadow","my-record","p-3","rounded-2","border","d-flex","flex-column","justify-content-between"],[1,"position-relative","mb-2"],[1,"text-center","me-3","text-uppercase"],[1,"rec-num","p-2","rounded-3","position-absolute","top-0","end-0"],["height","200","alt","disease image",1,"w-100","rounded-2",3,"src"],[1,"py-2"],[1,"text-muted"],["type","button",1,"btn","btn-outline-info","d-block","m-auto",3,"click"],[1,"image-preview","position-fixed","top-0","bottom-0","start-0","end-0","d-flex","justify-content-center","align-items-center",3,"click"],[1,"disease-image","position-relative","d-flex",3,"click"],["class","fa fa-arrow-left start-0 fa-2x text-white me-2 my-auto",3,"click",4,"ngIf"],["alt","",1,"w-100",3,"src"],["class","fa fa-arrow-right fa-2x end-0 text-white ms-2 my-auto",3,"click",4,"ngIf"],[1,"fa","fa-arrow-left","start-0","fa-2x","text-white","me-2","my-auto",3,"click"],[1,"fa","fa-arrow-right","fa-2x","end-0","text-white","ms-2","my-auto",3,"click"],[1,"text-center"],[1,"text-center","text-info","clickable",3,"click"]],template:function(n,i){if(1&n&&(e.YNc(0,S,5,1,"div",0),e.YNc(1,U,5,3,"div",1),e.YNc(2,P,4,0,"ng-template",null,2,e.W1O)),2&n){const r=e.MAs(3);e.Q6J("ngIf",i.records)("ngIfElse",r),e.xp6(1),e.Q6J("ngIf",i.previewFlag)}},dependencies:[l.ez,l.sg,l.O5,l.uU,p.Is],styles:[".row[_ngcontent-%COMP%]   .rec-num[_ngcontent-%COMP%]{background-color:var(--main-color);color:#fff;font-weight:500;font-size:1.0625rem}.clickable[_ngcontent-%COMP%]{cursor:pointer;transition:all .2s ease}.clickable[_ngcontent-%COMP%]:hover{color:#004e86!important}.image-preview[_ngcontent-%COMP%]{background-color:#00000080;z-index:3!important}.image-preview[_ngcontent-%COMP%]   .disease-image[_ngcontent-%COMP%]{width:600px}.image-preview[_ngcontent-%COMP%]   .disease-image[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{height:350px}.image-preview[_ngcontent-%COMP%]   .disease-image[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{cursor:pointer;transition:all .2s ease}.image-preview[_ngcontent-%COMP%]   .disease-image[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]:hover{color:var(--tomato)!important}@media screen and (max-width: 768px){.disease-image[_ngcontent-%COMP%]{width:60%!important}}"]})}return o})()}}]);